# impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0
gtd_USA_2$nkill[is.na(gtd_USA_2$nkill)] <- 0
# select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )
gtd_USA_2 <- gtd_USA_2 %>%
select(Date, nkill)
# new dataframe for monthly number of attacks 1970-2020
gtd_yearly_attacks_deaths <- gtd_USA_2 %>%
group_by(year(Date)) %>%
summarise(nkill=sum(nkill),
num_attacks = n())
colnames(gtd_yearly_attacks_deaths)[1] ="Year"
colnames(gtd_yearly_attacks_deaths)[2] ="num_fatal"
colnames(gtd_yearly_attacks_deaths)[3] ="num_attacks"
gtd_yearly_attacks_deaths$Year <- as.Date(paste0(gtd_yearly_attacks_deaths$Year, "-01-01"))
# Fill missing dates (0 attacks for those dates)
gtd_yearly_attacks_deaths <- gtd_yearly_attacks_deaths %>%
complete(Year = seq.Date(min(Year), max(Year), by="year"))
# impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD
gtd_yearly_attacks_deaths[24,2] <- 28
gtd_yearly_attacks_deaths[24,3] <- 21
# CLEAN DHS df
## convert year to date time
dhs$Year <- as.Date(paste0(dhs$Year, "-01-01"))
## subset
dhs <- subset(dhs, select = c(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))
# join with aggregated GTD df
gtd_dhs <- merge(gtd_yearly_attacks_deaths, dhs, by = "Year", all.x = TRUE)
# interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)
gtd_dhs[,4] <- imputeTS::na.interpolation(gtd_dhs[,4])
gtd_dhs[,5] <- imputeTS::na.interpolation(gtd_dhs[,5])
gtd_dhs[,6] <- imputeTS::na.interpolation(gtd_dhs[,6])
# join sipri dataset -> military expenditure as % of GDP
us.gdp <- sipri_gdp %>% filter(Country=='United States of America')
us.gdp <- melt(us.gdp, id.vars = 'Country', variable.name = 'Year', value.name = 'GDP')
nrow(us.gdp)
us.gdp[22:72, 3]
# Filter country_txt==USA
gtd_USA_2 <- gtd %>%
filter(country_txt=="United States")
# drop 33 observations from a total of 3121 observations (if taking for '70)
gtd_USA_2 <- gtd_USA_2[complete.cases(gtd_USA_2$Date),]
# impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0
gtd_USA_2$nkill[is.na(gtd_USA_2$nkill)] <- 0
# select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )
gtd_USA_2 <- gtd_USA_2 %>%
select(Date, nkill)
# new dataframe for monthly number of attacks 1970-2020
gtd_yearly_attacks_deaths <- gtd_USA_2 %>%
group_by(year(Date)) %>%
summarise(nkill=sum(nkill),
num_attacks = n())
colnames(gtd_yearly_attacks_deaths)[1] ="Year"
colnames(gtd_yearly_attacks_deaths)[2] ="num_fatal"
colnames(gtd_yearly_attacks_deaths)[3] ="num_attacks"
gtd_yearly_attacks_deaths$Year <- as.Date(paste0(gtd_yearly_attacks_deaths$Year, "-01-01"))
# Fill missing dates (0 attacks for those dates)
gtd_yearly_attacks_deaths <- gtd_yearly_attacks_deaths %>%
complete(Year = seq.Date(min(Year), max(Year), by="year"))
# impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD
gtd_yearly_attacks_deaths[24,2] <- 28
gtd_yearly_attacks_deaths[24,3] <- 21
# CLEAN DHS df
## convert year to date time
dhs$Year <- as.Date(paste0(dhs$Year, "-01-01"))
## subset
dhs <- subset(dhs, select = c(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))
# join with aggregated GTD df
gtd_dhs <- merge(gtd_yearly_attacks_deaths, dhs, by = "Year", all.x = TRUE)
# interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)
gtd_dhs[,4] <- imputeTS::na.interpolation(gtd_dhs[,4])
gtd_dhs[,5] <- imputeTS::na.interpolation(gtd_dhs[,5])
gtd_dhs[,6] <- imputeTS::na.interpolation(gtd_dhs[,6])
# join sipri dataset -> military expenditure as % of GDP
us.gdp <- sipri_gdp %>% filter(Country=='United States of America')
us.gdp <- melt(us.gdp, id.vars = 'Country', variable.name = 'Year', value.name = 'GDP')
us.gdp <- as.numeric(us.gdp[22:72, 3])
gtd_dhs <- cbind(gtd_dhs, us.gdp)
# Filter country_txt==USA
gtd_USA_2 <- gtd %>%
filter(country_txt=="United States")
# drop 33 observations from a total of 3121 observations (if taking for '70)
gtd_USA_2 <- gtd_USA_2[complete.cases(gtd_USA_2$Date),]
# impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0
gtd_USA_2$nkill[is.na(gtd_USA_2$nkill)] <- 0
# select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )
gtd_USA_2 <- gtd_USA_2 %>%
select(Date, nkill)
# new dataframe for monthly number of attacks 1970-2020
gtd_yearly_attacks_deaths <- gtd_USA_2 %>%
group_by(year(Date)) %>%
summarise(nkill=sum(nkill),
num_attacks = n())
colnames(gtd_yearly_attacks_deaths)[1] ="Year"
colnames(gtd_yearly_attacks_deaths)[2] ="num_fatal"
colnames(gtd_yearly_attacks_deaths)[3] ="num_attacks"
gtd_yearly_attacks_deaths$Year <- as.Date(paste0(gtd_yearly_attacks_deaths$Year, "-01-01"))
# Fill missing dates (0 attacks for those dates)
gtd_yearly_attacks_deaths <- gtd_yearly_attacks_deaths %>%
complete(Year = seq.Date(min(Year), max(Year), by="year"))
# impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD
gtd_yearly_attacks_deaths[24,2] <- 28
gtd_yearly_attacks_deaths[24,3] <- 21
# CLEAN DHS df
## convert year to date time
dhs$Year <- as.Date(paste0(dhs$Year, "-01-01"))
## subset
dhs <- subset(dhs, select = c(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))
# join with aggregated GTD df
gtd_dhs <- merge(gtd_yearly_attacks_deaths, dhs, by = "Year", all.x = TRUE)
# interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)
gtd_dhs[,4] <- imputeTS::na.interpolation(gtd_dhs[,4])
gtd_dhs[,5] <- imputeTS::na.interpolation(gtd_dhs[,5])
gtd_dhs[,6] <- imputeTS::na.interpolation(gtd_dhs[,6])
# join sipri dataset -> military expenditure as % of GDP
us.gdp <- sipri_gdp %>% filter(Country=='United States of America')
us.gdp <- melt(us.gdp, id.vars = 'Country', variable.name = 'Year', value.name = 'GDP')
us.gdp <- as.numeric(us.gdp[22:72, 3])
gtd_dhs_sipri <- cbind(gtd_dhs, us.gdp)
View(gtd_dhs_sipri)
# shift casualties column before attacks due to xreg
# select desired column order (date column first, then casualties, then attacks)
# new_order <- c(1, 3, 2, 4:100)
#
# # reorder columns
# gtd_USA_monthly <- gtd_USA_monthly[, new_order]# create a matrix from the three time series columns
#
# # convert to matrix
# ts_matrix <- as.matrix(gtd_USA_monthly[, 2:100])
#
# # convert the matrix to a time series object with a monthly frequency of 12
# arimax_ts <- ts(ts_matrix, frequency = 12,
#                  start = c(year(gtd_USA_monthly$Date[1]), month(gtd_USA_monthly$Date[1])))
#
# # ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
# (fit <- auto.arima(arimax_ts[,1],
#   xreg=arimax_ts[,2:55]))
ts_matrix <- as.matrix(gtd_dhs_sipri[, 2:7])
# convert the matrix to a time series object with a yearly frequency
arimax_ts <- ts(ts_matrix, frequency = 1,
start = 1970)
# ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
(fit <- auto.arima(arimax_ts[,1],
xreg=arimax_ts[,2:7]))
# Filter country_txt==USA
gtd_USA_2 <- gtd %>%
filter(country_txt=="United States")
# drop 33 observations from a total of 3121 observations (if taking for '70)
gtd_USA_2 <- gtd_USA_2[complete.cases(gtd_USA_2$Date),]
# impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0
gtd_USA_2$nkill[is.na(gtd_USA_2$nkill)] <- 0
# select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )
gtd_USA_2 <- gtd_USA_2 %>%
select(Date, nkill)
# new dataframe for monthly number of attacks 1970-2020
gtd_yearly_attacks_deaths <- gtd_USA_2 %>%
group_by(year(Date)) %>%
summarise(nkill=sum(nkill),
num_attacks = n())
colnames(gtd_yearly_attacks_deaths)[1] ="Year"
colnames(gtd_yearly_attacks_deaths)[2] ="num_fatal"
colnames(gtd_yearly_attacks_deaths)[3] ="num_attacks"
gtd_yearly_attacks_deaths$Year <- as.Date(paste0(gtd_yearly_attacks_deaths$Year, "-01-01"))
# Fill missing dates (0 attacks for those dates)
gtd_yearly_attacks_deaths <- gtd_yearly_attacks_deaths %>%
complete(Year = seq.Date(min(Year), max(Year), by="year"))
# impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD
gtd_yearly_attacks_deaths[24,2] <- 28
gtd_yearly_attacks_deaths[24,3] <- 21
# CLEAN DHS df
## convert year to date time
dhs$Year <- as.Date(paste0(dhs$Year, "-01-01"))
## subset
dhs <- subset(dhs, select = c(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))
# join with aggregated GTD df
gtd_dhs <- merge(gtd_yearly_attacks_deaths, dhs, by = "Year", all.x = TRUE)
# interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)
gtd_dhs[,4] <- imputeTS::na.interpolation(gtd_dhs[,4])
gtd_dhs[,5] <- imputeTS::na.interpolation(gtd_dhs[,5])
gtd_dhs[,6] <- imputeTS::na.interpolation(gtd_dhs[,6])
# join sipri dataset -> military expenditure as % of GDP
us.gdp <- sipri_gdp %>% filter(Country=='United States of America')
us.gdp <- melt(us.gdp, id.vars = 'Country', variable.name = 'Year', value.name = 'GDP')
us.gdp <- as.numeric(us.gdp[22:72, 3])
gtd_dhs_sipri <- cbind(gtd_dhs, us.gdp)
# shift casualties column before attacks due to xreg
# select desired column order (date column first, then casualties, then attacks)
# new_order <- c(1, 3, 2, 4:100)
#
# # reorder columns
# gtd_USA_monthly <- gtd_USA_monthly[, new_order]# create a matrix from the three time series columns
#
# # convert to matrix
# ts_matrix <- as.matrix(gtd_USA_monthly[, 2:100])
#
# # convert the matrix to a time series object with a monthly frequency of 12
# arimax_ts <- ts(ts_matrix, frequency = 12,
#                  start = c(year(gtd_USA_monthly$Date[1]), month(gtd_USA_monthly$Date[1])))
#
# # ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
# (fit <- auto.arima(arimax_ts[,1],
#   xreg=arimax_ts[,2:55]))
ts_matrix <- as.matrix(gtd_dhs_sipri[, 2:7])
# convert the matrix to a time series object with a yearly frequency
arimax_ts <- ts(ts_matrix, frequency = 1,
start = 1970)
# ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
(fit <- auto.arima(arimax_ts[,1],
xreg=arimax_ts[,2:]))
arimax_ts
# Filter country_txt==USA
gtd_USA_2 <- gtd %>%
filter(country_txt=="United States")
# drop 33 observations from a total of 3121 observations (if taking for '70)
gtd_USA_2 <- gtd_USA_2[complete.cases(gtd_USA_2$Date),]
# impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0
gtd_USA_2$nkill[is.na(gtd_USA_2$nkill)] <- 0
# select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )
gtd_USA_2 <- gtd_USA_2 %>%
select(Date, nkill)
# new dataframe for monthly number of attacks 1970-2020
gtd_yearly_attacks_deaths <- gtd_USA_2 %>%
group_by(year(Date)) %>%
summarise(nkill=sum(nkill),
num_attacks = n())
colnames(gtd_yearly_attacks_deaths)[1] ="Year"
colnames(gtd_yearly_attacks_deaths)[2] ="num_fatal"
colnames(gtd_yearly_attacks_deaths)[3] ="num_attacks"
gtd_yearly_attacks_deaths$Year <- as.Date(paste0(gtd_yearly_attacks_deaths$Year, "-01-01"))
# Fill missing dates (0 attacks for those dates)
gtd_yearly_attacks_deaths <- gtd_yearly_attacks_deaths %>%
complete(Year = seq.Date(min(Year), max(Year), by="year"))
# impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD
gtd_yearly_attacks_deaths[24,2] <- 28
gtd_yearly_attacks_deaths[24,3] <- 21
# CLEAN DHS df
## convert year to date time
dhs$Year <- as.Date(paste0(dhs$Year, "-01-01"))
## subset
dhs <- subset(dhs, select = c(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))
# join with aggregated GTD df
gtd_dhs <- merge(gtd_yearly_attacks_deaths, dhs, by = "Year", all.x = TRUE)
# interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)
gtd_dhs[,4] <- imputeTS::na.interpolation(gtd_dhs[,4])
gtd_dhs[,5] <- imputeTS::na.interpolation(gtd_dhs[,5])
gtd_dhs[,6] <- imputeTS::na.interpolation(gtd_dhs[,6])
# join sipri dataset -> military expenditure as % of GDP
us.gdp <- sipri_gdp %>% filter(Country=='United States of America')
us.gdp <- melt(us.gdp, id.vars = 'Country', variable.name = 'Year', value.name = 'GDP')
us.gdp <- as.numeric(us.gdp[22:72, 3])
gtd_dhs_sipri <- cbind(gtd_dhs, us.gdp)
# shift casualties column before attacks due to xreg
# select desired column order (date column first, then casualties, then attacks)
# new_order <- c(1, 3, 2, 4:100)
#
# # reorder columns
# gtd_USA_monthly <- gtd_USA_monthly[, new_order]# create a matrix from the three time series columns
#
# # convert to matrix
# ts_matrix <- as.matrix(gtd_USA_monthly[, 2:100])
#
# # convert the matrix to a time series object with a monthly frequency of 12
# arimax_ts <- ts(ts_matrix, frequency = 12,
#                  start = c(year(gtd_USA_monthly$Date[1]), month(gtd_USA_monthly$Date[1])))
#
# # ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
# (fit <- auto.arima(arimax_ts[,1],
#   xreg=arimax_ts[,2:55]))
ts_matrix <- as.matrix(gtd_dhs_sipri[, 2:7])
# convert the matrix to a time series object with a yearly frequency
arimax_ts <- ts(ts_matrix, frequency = 1,
start = 1970)
# ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
(fit <- auto.arima(arimax_ts[,1],
xreg=arimax_ts[,2:6]))
summary(fit)
# Filter country_txt==USA
gtd_USA_2 <- gtd %>%
filter(country_txt=="United States")
# drop 33 observations from a total of 3121 observations (if taking for '70)
gtd_USA_2 <- gtd_USA_2[complete.cases(gtd_USA_2$Date),]
# impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0
gtd_USA_2$nkill[is.na(gtd_USA_2$nkill)] <- 0
# select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )
gtd_USA_2 <- gtd_USA_2 %>%
select(Date, nkill)
# new dataframe for monthly number of attacks 1970-2020
gtd_yearly_attacks_deaths <- gtd_USA_2 %>%
group_by(year(Date)) %>%
summarise(nkill=sum(nkill),
num_attacks = n())
colnames(gtd_yearly_attacks_deaths)[1] ="Year"
colnames(gtd_yearly_attacks_deaths)[2] ="num_fatal"
colnames(gtd_yearly_attacks_deaths)[3] ="num_attacks"
gtd_yearly_attacks_deaths$Year <- as.Date(paste0(gtd_yearly_attacks_deaths$Year, "-01-01"))
# Fill missing dates (0 attacks for those dates)
gtd_yearly_attacks_deaths <- gtd_yearly_attacks_deaths %>%
complete(Year = seq.Date(min(Year), max(Year), by="year"))
# impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD
gtd_yearly_attacks_deaths[24,2] <- 28
gtd_yearly_attacks_deaths[24,3] <- 21
# CLEAN DHS df
## convert year to date time
dhs$Year <- as.Date(paste0(dhs$Year, "-01-01"))
## subset
dhs <- subset(dhs, select = c(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))
# join with aggregated GTD df
gtd_dhs <- merge(gtd_yearly_attacks_deaths, dhs, by = "Year", all.x = TRUE)
# interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)
gtd_dhs[,4] <- imputeTS::na.interpolation(gtd_dhs[,4])
gtd_dhs[,5] <- imputeTS::na.interpolation(gtd_dhs[,5])
gtd_dhs[,6] <- imputeTS::na.interpolation(gtd_dhs[,6])
# join sipri dataset -> military expenditure as % of GDP
us.gdp <- sipri_gdp %>% filter(Country=='United States of America')
us.gdp <- melt(us.gdp, id.vars = 'Country', variable.name = 'Year', value.name = 'GDP')
us.gdp <- as.numeric(us.gdp[22:72, 3])
gtd_dhs_sipri <- cbind(gtd_dhs, us.gdp) %>% slice(df, -32)
# Filter country_txt==USA
gtd_USA_2 <- gtd %>%
filter(country_txt=="United States")
# drop 33 observations from a total of 3121 observations (if taking for '70)
gtd_USA_2 <- gtd_USA_2[complete.cases(gtd_USA_2$Date),]
# impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0
gtd_USA_2$nkill[is.na(gtd_USA_2$nkill)] <- 0
# select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )
gtd_USA_2 <- gtd_USA_2 %>%
select(Date, nkill)
# new dataframe for monthly number of attacks 1970-2020
gtd_yearly_attacks_deaths <- gtd_USA_2 %>%
group_by(year(Date)) %>%
summarise(nkill=sum(nkill),
num_attacks = n())
colnames(gtd_yearly_attacks_deaths)[1] ="Year"
colnames(gtd_yearly_attacks_deaths)[2] ="num_fatal"
colnames(gtd_yearly_attacks_deaths)[3] ="num_attacks"
gtd_yearly_attacks_deaths$Year <- as.Date(paste0(gtd_yearly_attacks_deaths$Year, "-01-01"))
# Fill missing dates (0 attacks for those dates)
gtd_yearly_attacks_deaths <- gtd_yearly_attacks_deaths %>%
complete(Year = seq.Date(min(Year), max(Year), by="year"))
# impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD
gtd_yearly_attacks_deaths[24,2] <- 28
gtd_yearly_attacks_deaths[24,3] <- 21
# CLEAN DHS df
## convert year to date time
dhs$Year <- as.Date(paste0(dhs$Year, "-01-01"))
## subset
dhs <- subset(dhs, select = c(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))
# join with aggregated GTD df
gtd_dhs <- merge(gtd_yearly_attacks_deaths, dhs, by = "Year", all.x = TRUE)
# interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)
gtd_dhs[,4] <- imputeTS::na.interpolation(gtd_dhs[,4])
gtd_dhs[,5] <- imputeTS::na.interpolation(gtd_dhs[,5])
gtd_dhs[,6] <- imputeTS::na.interpolation(gtd_dhs[,6])
# join sipri dataset -> military expenditure as % of GDP
us.gdp <- sipri_gdp %>% filter(Country=='United States of America')
us.gdp <- melt(us.gdp, id.vars = 'Country', variable.name = 'Year', value.name = 'GDP')
us.gdp <- as.numeric(us.gdp[22:72, 3])
gtd_dhs_sipri <- cbind(gtd_dhs, us.gdp)
gtd_dhs_sipri <- slice(gtd_dhs_sipri, -32)
# shift casualties column before attacks due to xreg
# select desired column order (date column first, then casualties, then attacks)
# new_order <- c(1, 3, 2, 4:100)
#
# # reorder columns
# gtd_USA_monthly <- gtd_USA_monthly[, new_order]# create a matrix from the three time series columns
#
# # convert to matrix
# ts_matrix <- as.matrix(gtd_USA_monthly[, 2:100])
#
# # convert the matrix to a time series object with a monthly frequency of 12
# arimax_ts <- ts(ts_matrix, frequency = 12,
#                  start = c(year(gtd_USA_monthly$Date[1]), month(gtd_USA_monthly$Date[1])))
#
# # ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
# (fit <- auto.arima(arimax_ts[,1],
#   xreg=arimax_ts[,2:55]))
ts_matrix <- as.matrix(gtd_dhs_sipri[, 2:7])
# convert the matrix to a time series object with a yearly frequency
arimax_ts <- ts(ts_matrix, frequency = 1,
start = 1970)
# ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
(fit <- auto.arima(arimax_ts[,1],
xreg=arimax_ts[,2:6]))
summary(fit)
View(gtd_USA_monthly)
# Filter country_txt==USA
gtd_USA_2 <- gtd %>%
filter(country_txt=="United States")
# drop 33 observations from a total of 3121 observations (if taking for '70)
gtd_USA_2 <- gtd_USA_2[complete.cases(gtd_USA_2$Date),]
# impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0
gtd_USA_2$nkill[is.na(gtd_USA_2$nkill)] <- 0
# select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )
gtd_USA_2 <- gtd_USA_2 %>%
select(Date, nkill)
# new dataframe for monthly number of attacks 1970-2020
gtd_yearly_attacks_deaths <- gtd_USA_2 %>%
group_by(year(Date)) %>%
summarise(nkill=sum(nkill),
num_attacks = n())
colnames(gtd_yearly_attacks_deaths)[1] ="Year"
colnames(gtd_yearly_attacks_deaths)[2] ="num_fatal"
colnames(gtd_yearly_attacks_deaths)[3] ="num_attacks"
gtd_yearly_attacks_deaths$Year <- as.Date(paste0(gtd_yearly_attacks_deaths$Year, "-01-01"))
# Fill missing dates (0 attacks for those dates)
gtd_yearly_attacks_deaths <- gtd_yearly_attacks_deaths %>%
complete(Year = seq.Date(min(Year), max(Year), by="year"))
# impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD
gtd_yearly_attacks_deaths[24,2] <- 28
gtd_yearly_attacks_deaths[24,3] <- 21
# CLEAN DHS df
## convert year to date time
dhs$Year <- as.Date(paste0(dhs$Year, "-01-01"))
## subset
dhs <- subset(dhs, select = c(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))
# join with aggregated GTD df
gtd_dhs <- merge(gtd_yearly_attacks_deaths, dhs, by = "Year", all.x = TRUE)
# interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)
gtd_dhs[,4] <- imputeTS::na.interpolation(gtd_dhs[,4])
gtd_dhs[,5] <- imputeTS::na.interpolation(gtd_dhs[,5])
gtd_dhs[,6] <- imputeTS::na.interpolation(gtd_dhs[,6])
# join sipri dataset -> military expenditure as % of GDP
milexp.gdp <- sipri_gdp %>% filter(Country=='United States of America')
milexp.gdp <- melt(milexp.gdp, id.vars = 'Country', variable.name = 'Year', value.name = 'GDP')
milexp.gdp <- as.numeric(milexp.gdp[22:72, 3])
gtd_dhs_sipri <- cbind(gtd_dhs, milexp.gdp)
#gtd_dhs_sipri <- slice(gtd_dhs_sipri, -32) # removing
# Filter country_txt==USA
gtd_USA_2 <- gtd %>%
filter(country_txt=="United States")
# drop 33 observations from a total of 3121 observations (if taking for '70)
gtd_USA_2 <- gtd_USA_2[complete.cases(gtd_USA_2$Date),]
# impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0
gtd_USA_2$nkill[is.na(gtd_USA_2$nkill)] <- 0
# select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )
gtd_USA_2 <- gtd_USA_2 %>%
select(Date, nkill)
# new dataframe for monthly number of attacks 1970-2020
gtd_yearly_attacks_deaths <- gtd_USA_2 %>%
group_by(year(Date)) %>%
summarise(nkill=sum(nkill),
num_attacks = n())
colnames(gtd_yearly_attacks_deaths)[1] ="Year"
colnames(gtd_yearly_attacks_deaths)[2] ="num_fatal"
colnames(gtd_yearly_attacks_deaths)[3] ="num_attacks"
gtd_yearly_attacks_deaths$Year <- as.Date(paste0(gtd_yearly_attacks_deaths$Year, "-01-01"))
# Fill missing dates (0 attacks for those dates)
gtd_yearly_attacks_deaths <- gtd_yearly_attacks_deaths %>%
complete(Year = seq.Date(min(Year), max(Year), by="year"))
# impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD
gtd_yearly_attacks_deaths[24,2] <- 28
gtd_yearly_attacks_deaths[24,3] <- 21
# CLEAN DHS df
## convert year to date time
dhs$Year <- as.Date(paste0(dhs$Year, "-01-01"))
## subset
dhs <- subset(dhs, select = c(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))
# join with aggregated GTD df
gtd_dhs <- merge(gtd_yearly_attacks_deaths, dhs, by = "Year", all.x = TRUE)
# interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)
gtd_dhs[,4] <- imputeTS::na.interpolation(gtd_dhs[,4])
gtd_dhs[,5] <- imputeTS::na.interpolation(gtd_dhs[,5])
gtd_dhs[,6] <- imputeTS::na.interpolation(gtd_dhs[,6])
# join sipri dataset -> military expenditure as % of GDP
milexp.gdp <- sipri_gdp %>% filter(Country=='United States of America')
milexp.gdp <- melt(milexp.gdp, id.vars = 'Country', variable.name = 'Year', value.name = 'GDP')
milexp.gdp <- as.numeric(milexp.gdp[22:72, 3])
gtd_dhs_sipri <- cbind(gtd_dhs, milexp.gdp)
#gtd_dhs_sipri[32,2] <- 10 # removing 3004 number of casualties and 4 attacks (9/11 attacks)
#gtd_dhs_sipri[32,3] <- 43 # removing 3004 number of casualties and 4 attacks (9/11 attacks)
# shift casualties column before attacks due to xreg
# select desired column order (date column first, then casualties, then attacks)
# new_order <- c(1, 3, 2, 4:100)
#
# # reorder columns
# gtd_USA_monthly <- gtd_USA_monthly[, new_order]# create a matrix from the three time series columns
#
# # convert to matrix
# ts_matrix <- as.matrix(gtd_USA_monthly[, 2:100])
#
# # convert the matrix to a time series object with a monthly frequency of 12
# arimax_ts <- ts(ts_matrix, frequency = 12,
#                  start = c(year(gtd_USA_monthly$Date[1]), month(gtd_USA_monthly$Date[1])))
#
# # ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
# (fit <- auto.arima(arimax_ts[,1],
#   xreg=arimax_ts[,2:55]))
ts_matrix <- as.matrix(gtd_dhs_sipri[, 2:7])
# convert the matrix to a time series object with a yearly frequency
arimax_ts <- ts(ts_matrix, frequency = 1,
start = 1970)
# ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories
(fit <- auto.arima(arimax_ts[,1],
xreg=arimax_ts[,2:6]))
gtd_dhs_sipri.ts<-ts(gtd_dhs_sipri,star=1970),frequency = 1)
gtd_dhs_sipri.ts<-ts(gtd_dhs_sipri,star=1970,frequency = 1)
autoplot(gtd_dhs_sipri.ts[,c(2:7)], facets=TRUE) +
xlab("Year") + ylab("") +
ggtitle("GTD, DHS, SIPRI - USA")
VARselect(gtd_dhs_sipri[, c(2:7)], lag.max=10, type="both")
library(vars)
install.packages("vars")
library(vars)
VARselect(gtd_dhs_sipri[, c(2:7)], lag.max=10, type="both")
summary(VAR(gtd_dhs_sipri[, c(2:4)], p=7, type='both'))
VARselect(arimax_ts, lag.max=10, type="both")
summary(VARselect(arimax_ts, lag.max=10, type="both"))
acf(residuals(VARselect(gtd_dhs_sipri[, c(2:7)], p=7, type="both")))
acf(residuals(VAR(gtd_dhs_sipri[, c(2:7)], p=7, type="constant")))
acf(residuals(VAR(gtd_dhs_sipri[, c(2:7)], p=7, type="const")))
plot.ts(usd.hkd)
plot.ts(usdhkd)
library(vars)
