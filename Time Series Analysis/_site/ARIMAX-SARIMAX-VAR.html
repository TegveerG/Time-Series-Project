<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ANLY560 Time Series Project - Tegveer Ghura - ARIMAX/SARIMAX/VAR Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">ARIMAX/SARIMAX/VAR Models</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">ANLY560 Time Series Project - Tegveer Ghura</a> 
        <div class="sidebar-tools-main">
    <a href="https://www.linkedin.com/in/tegveerg/" title="" class="sidebar-tool px-1"><i class="bi bi-linkedin"></i></a>
    <a href="" title="" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-github"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/TegveerG/Time-Series-Project">
          Source Code
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">About Tegveer</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data-Sources.html" class="sidebar-item-text sidebar-link">Data Sources</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data-Visualization.html" class="sidebar-item-text sidebar-link">Data Visualization</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Exploratory-Data-Analysis.html" class="sidebar-item-text sidebar-link">Exploratory Data Analysis</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ARMA-ARIMA-SARIMA.html" class="sidebar-item-text sidebar-link">ARMA/ARIMA/SARIMA Models</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ARIMAX-SARIMAX-VAR.html" class="sidebar-item-text sidebar-link active">ARIMAX/SARIMAX/VAR Models</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Financial-Models.html" class="sidebar-item-text sidebar-link">Financial Time Series Models</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Deep-Learning.html" class="sidebar-item-text sidebar-link">Deep Learning for TS</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Conclusion.html" class="sidebar-item-text sidebar-link">Conclusion</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#Lit" id="toc-Lit" class="nav-link" data-scroll-target="#Lit">Literature Review</a></li>
  <li><a href="#var-model-justification" id="toc-var-model-justification" class="nav-link" data-scroll-target="#var-model-justification">VAR Model Justification</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a></li>
  <li><a href="#building-the-var-model-1970-2020-pre-and-post-911-attacks" id="toc-building-the-var-model-1970-2020-pre-and-post-911-attacks" class="nav-link" data-scroll-target="#building-the-var-model-1970-2020-pre-and-post-911-attacks">Building the VAR Model (1970-2020: Pre and Post-9/11 Attacks)</a>
  <ul class="collapse">
  <li><a href="#time-series-plots" id="toc-time-series-plots" class="nav-link" data-scroll-target="#time-series-plots">Time Series Plots</a></li>
  <li><a href="#pair-plots" id="toc-pair-plots" class="nav-link" data-scroll-target="#pair-plots">Pair Plots</a></li>
  <li><a href="#fitting-var-model" id="toc-fitting-var-model" class="nav-link" data-scroll-target="#fitting-var-model">Fitting VAR Model</a></li>
  <li><a href="#k-fold-cross-validation-and-model-diagnostics" id="toc-k-fold-cross-validation-and-model-diagnostics" class="nav-link" data-scroll-target="#k-fold-cross-validation-and-model-diagnostics">K-Fold Cross Validation and Model Diagnostics</a></li>
  <li><a href="#forecasting-chosen-model-p1" id="toc-forecasting-chosen-model-p1" class="nav-link" data-scroll-target="#forecasting-chosen-model-p1">Forecasting Chosen Model (p=1)</a></li>
  </ul></li>
  <li><a href="#building-the-var-model-2001-2020-post-911-attacks" id="toc-building-the-var-model-2001-2020-post-911-attacks" class="nav-link" data-scroll-target="#building-the-var-model-2001-2020-post-911-attacks">Building the VAR Model (2001-2020: Post-9/11 Attacks)</a>
  <ul class="collapse">
  <li><a href="#time-series-plots-1" id="toc-time-series-plots-1" class="nav-link" data-scroll-target="#time-series-plots-1">Time Series Plots</a></li>
  <li><a href="#pair-plots-1" id="toc-pair-plots-1" class="nav-link" data-scroll-target="#pair-plots-1">Pair Plots</a></li>
  <li><a href="#fitting-var-model-1" id="toc-fitting-var-model-1" class="nav-link" data-scroll-target="#fitting-var-model-1">Fitting VAR Model</a></li>
  <li><a href="#k-fold-cross-validation-and-model-diagnostics-1" id="toc-k-fold-cross-validation-and-model-diagnostics-1" class="nav-link" data-scroll-target="#k-fold-cross-validation-and-model-diagnostics-1">K-Fold Cross Validation and Model Diagnostics</a></li>
  <li><a href="#forecasting-chosen-model-p1-1" id="toc-forecasting-chosen-model-p1-1" class="nav-link" data-scroll-target="#forecasting-chosen-model-p1-1">Forecasting Chosen Model (p=1)</a></li>
  </ul></li>
  <li><a href="#manual-arimax-modeling-1970-2020-pre-and-post-911-attacks" id="toc-manual-arimax-modeling-1970-2020-pre-and-post-911-attacks" class="nav-link" data-scroll-target="#manual-arimax-modeling-1970-2020-pre-and-post-911-attacks">Manual ARIMAX Modeling (1970-2020: Pre and Post-9/11 Attacks)</a>
  <ul class="collapse">
  <li><a href="#regression-summary-and-fitting-arima-to-residuals" id="toc-regression-summary-and-fitting-arima-to-residuals" class="nav-link" data-scroll-target="#regression-summary-and-fitting-arima-to-residuals">Regression Summary and Fitting ARIMA to Residuals</a></li>
  <li><a href="#arima200-or-ar2-forecasting" id="toc-arima200-or-ar2-forecasting" class="nav-link" data-scroll-target="#arima200-or-ar2-forecasting">ARIMA(2,0,0) or AR(2) Forecasting</a></li>
  </ul></li>
  <li><a href="#manual-arimax-modeling-2001-2020-post-911-attacks" id="toc-manual-arimax-modeling-2001-2020-post-911-attacks" class="nav-link" data-scroll-target="#manual-arimax-modeling-2001-2020-post-911-attacks">Manual ARIMAX Modeling (2001-2020: Post-9/11 Attacks)</a>
  <ul class="collapse">
  <li><a href="#regression-summary-and-fitting-arima-to-residuals-1" id="toc-regression-summary-and-fitting-arima-to-residuals-1" class="nav-link" data-scroll-target="#regression-summary-and-fitting-arima-to-residuals-1">Regression Summary and Fitting ARIMA to Residuals</a></li>
  <li><a href="#arima001-or-ma1-forecasting" id="toc-arima001-or-ma1-forecasting" class="nav-link" data-scroll-target="#arima001-or-ma1-forecasting">ARIMA(0,0,1) or MA(1) Forecasting</a></li>
  </ul></li>
  <li><a href="#final-results" id="toc-final-results" class="nav-link" data-scroll-target="#final-results">Final Results</a></li>
  <li><a href="#section-code" id="toc-section-code" class="nav-link" data-scroll-target="#section-code">Section Code</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">ARIMAX/SARIMAX/VAR Models</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In the previous ARIMA/SARIMA modeling section, we analyzed a univariate time series of monthly terrorist attacks in the US that occurred from 1970 to 2020. Although the SARIMA model performed better than the ARIMA model, due to the added seasonal Moving Average term, we can gauge our understanding of the monthly terrorist attacks better by including <strong>endogenous variables</strong>! Endogenous variables are those that are determined within the system being studied and are influenced by other variables in the system. These variables are typically modeled as being interdependent and are affected by changes in the values of other variables. In the case of terrorist attacks and casualties suffered from them, potential endogenous variables could include USA military expenditure, non-immigrant admissions data, and the performance of major weapons contracts, including Lockheed Martin, Boeing, and Raytheon Technologies. With the help of a literature review, it can be reinforced thoroughly and plausibly that the aforementioned endogenous variables have, in fact, not only been employed but also found to have effects related to terrorism in prior research.</p>
</section>
<section id="Lit" class="level2">
<h2 class="anchored" data-anchor-id="Lit">Literature Review</h2>
<p>The Stimson Study Group’s Report on Counterterrorism Spending <span class="citation" data-cites="stimson2018counterterroism">(<a href="#ref-stimson2018counterterroism" role="doc-biblioref">Counterterrorism Spending and Center 2018</a>)</span> in the post-9/11 era provides valuable insights into the amount of resources the United States devotes to counterterrorism efforts. The report found that the US government spent over USD2.8 trillion on counterterrorism efforts from 2002 to 2017, which represents a significant portion of the country’s overall military budget during that period. Specifically, the report notes that counterterrorism spending accounted for 17% to 23% of the US defense budget each year between 2002 and 2017. Hartung (2021) <span class="citation" data-cites="hartung_2021">(<a href="#ref-hartung_2021" role="doc-biblioref">Hartung 2021</a>)</span> found that the “Global War on Terror”, which emerged in the early 2000s as a result of the 9/11 attacks, had a significant impact on the political environment, resulting in a surge in the Pentagon’s budget, the largest component of the US military budget. This increased funding was largely directed towards <strong>military contractors, Lockheed Martin, Boeing, General Dynamics, Raytheon Technologies, and Northrop Grumman</strong>, who were enlisted to aid in the efforts. Since Fiscal Year 2001, the total expenditures of the Pentagon for all purposes have surpassed USD14.1 trillion (measured in 2021 dollars). Out of this sum, USD4.4 trillion was used for weapons procurement and research and development (R&amp;D), which mainly benefited corporate contractors. <strong>The rest of the funds were utilized for</strong> paying and providing benefits to military and civilian personnel and other expenses, necessary for <strong>operating and maintaining the United States military</strong>. Congressional Research Service (CRS) estimates that in FY2020, the spending for contractors grew to $420 billion - well over half of the total Pentagon budget. Therefore, the biggest financial beneficiaries of the post-9/11 military spending surge have been the aforementioned weapons contractors.</p>
<p>Furthermore, several papers have discussed and analyzed the relation between military spending or counterterrorism efforts with transnational terrorism prior to the 9/11 attacks. Li and Schaub (2004) <span class="citation" data-cites="LiandSchaub2004">(<a href="#ref-LiandSchaub2004" role="doc-biblioref">Li and Schaub 2004</a>)</span> employed <em>GOVCAPABILITY</em>, a control variable in their Pooled Time-Series Analysis , that comprised military manpower and military expenditures for 112 countries from 1975 to 1997. Because the variable captured state military and economic strength, it represented a proxy that the government could use for combating terrorism. Gaibulloev, K., Sandler, T., &amp; Sul, D. (2014) <span class="citation" data-cites="gaibulloev_sandler_sul_2014">(<a href="#ref-gaibulloev_sandler_sul_2014" role="doc-biblioref">Gaibulloev, Sandler, and Sul 2014</a>)</span> challenged extant literature about terrorism and its impact on economic growth that suffered from Nickell Bias, a type of bias that arises in statistical models when the independent variable is measured with error, and cross-sectional dependence, a statistical issue that arises in panel data analysis when the individual units (e.g., countries or firms) in the panel are not completely independent of one another. They mentioned that cross-sectional dependence is apt to affect other variables, such as democracy, threat, <strong>military spending</strong>, and financial measures. However, when Nickell bias and cross-sectional dependence are addressed, terrorism has no influence whatsoever on economic growth.</p>
<p>Therefore, the perused literature about counterterrorism and military spending underscores the importance of counterterrorism efforts, including funding weapons contractors, in shaping the country’s military spending priorities, particularly in the wake of the 9/11 terrorist attacks. By highlighting the amount of resources devoted to counterterrorism, these reports and papers help us understand how the overall US budget and military budget are allocated and the policy decisions that drive those allocations. However, it might also possible that during the VAR model building phase of this section, we find that military spending may not be a significant indicator of the number of casualties stemming from terrorist attacks in the Global Terrorism Database™ (GTD) <span class="citation" data-cites="GTD">(<a href="#ref-GTD" role="doc-biblioref"><span>“Codebook Methodology Inclusion Criteria and Variables - UMD,”</span> n.d.</a>)</span>.</p>
<p>Secondly, Nowrasteh (2019) <span class="citation" data-cites="nowrasteh_2019">(<a href="#ref-nowrasteh_2019" role="doc-biblioref">Nowrasteh 2019</a>)</span> found, by carefully analyzing the GTD, that the chance of being murdered by a tourist on a B visa, the most common tourist visa, is about 1 in 4.1 million per year. Compared to foreign‐born terrorists, the chance of being murdered by a native‐born terrorist is about 1 in 28 million per year. Moreover, there were 192 foreign‐born terrorists, relative to the 788 native-born terrorists, who planned, attempted, or carried out attacks on U.S. soil from 1975 through 2017. Through a cost-benefit risk analysis, it was also found that the combined human, property, business, and economic costs of terrorism from 1975 through 2017 are estimated at USD216.58 billion. Spread over 43 years, the average annual cost of terrorism is USD5.04 billion, which is about one‐hundredth the minimum estimated yearly benefit of USD553.9 billion from immigration and tourism. <strong>Therefore, foreign‐born terrorism on U.S. soil is a low‐probability event that imposes high costs on its victims, despite relatively small risks.</strong></p>
</section>
<section id="var-model-justification" class="level2">
<h2 class="anchored" data-anchor-id="var-model-justification">VAR Model Justification</h2>
<p>Using a VAR model over an ARIMAX model for this research has a multitude of benefits, including:</p>
<ul>
<li><p>Simultaneous modeling of multivariate time series: VAR allows for the simultaneous modeling of multiple endogenous variables, whereas ARIMAX (Autoregressive Integrated Moving Average with Explanatory Variables) can only model one dependent variable at a time. This means that VAR can capture the complex relationships between multiple variables that may be influencing each other.</p></li>
<li><p>Better handling of lags: VAR can handle multiple lags in the data more efficiently than ARIMAX. This is important in the case of studying the impact of terrorist attacks, as the effects of a single attack may persist over a longer period of time and may have delayed impacts on different variables.</p></li>
<li><p>More robust to missing data: VAR can handle missing data more effectively than ARIMAX, as it does not require the same level of complete data in order to estimate the model parameters. This is particularly relevant in the case of studying the impact of terrorist attacks, as data may be missing or incomplete for certain variables in certain time periods.</p></li>
<li><p>Better captures dynamic relationships: VAR is better suited for capturing the dynamic relationships between variables over time, whereas ARIMAX can only capture the static relationships between variables at a particular point in time. This is important in the case of studying the impact of terrorist attacks, as the relationships between variables may change over time due to factors such as changes in government policies or public opinion.</p></li>
<li><p>No clear seasonality: Another reason why the VAR model is justified is that there may not be a clear seasonality pattern in the data related to terrorist attacks. This means that traditional time-series models may not be effective in capturing the complex relationships between the variables. The VAR model, on the other hand, does not rely on a specific seasonal pattern and can account for the complex relationships between variables without requiring seasonal adjustments. Moreover, the data that will be analyzed is aggregated yearly from 1970 to 2020, which makes it more difficult to identify and capture seasonal patterns. Yearly data may also be influenced by other factors that are not related to seasonality, such as long-term trends or cyclical patterns, that occur over longer periods of time. This can make it more challenging to distinguish between seasonal effects and other underlying factors that may be driving the data.</p></li>
<li><p>Non-linearity: The relationships between variables in the case of terrorist attacks may not be linear, and traditional linear models may not be able to capture the non-linear effects. The VAR model is capable of modeling non-linear relationships between variables and can account for the complex interactions that may exist between them.</p></li>
</ul>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<p>Given the discussed Literature Review above, we shall divide our analysis into two segments, with VAR and ARIMAX models applied to both. <strong>The first segment shall forecast the number of terrorist attacks in the US using all the data available, from 1970-2020, and the second segment shall forecast the number of terrorist attacks in the US using only Post-9/11 attacks data, from 2001-2020.</strong> The reason 2001 is included is to ensure that the analysis captures the full impact of the 9/11 attacks, immediately before and after it, on terrorist activity in the US.</p>
<p>Another important differentiator between both VAR models and ARIMAX models is that only the ARIMAX models shall account for all variables collected for the project, including Non-Immigrant Entrants data from the Department of Homeland Security. This is because, as per the literature review, tourism, which is generalized to foreign-born terrorists in this analysis, does not seem to have a significant impact on the likelihood of terrorist attacks on U.S. soil, compared to overall US Military Expenditure. Therefore, this section will help us prove whether the non-immigration variables have a significant effect on the yearly number of terrorist attacks in the US.</p>
<p>Following graphs shall help make sense of the roadmap that follows in this analysis:</p>
<p><img src="multivariate_seg1.png" class="img-fluid"></p>
<p><br>
&nbsp;</p>
<center>
<em>Multivariate Analysis (VAR and ARIMAX) Segment 1 Flow Chart</em>
</center>
<p><br>
&nbsp;</p>
<p><img src="multivariate_seg2.png" class="img-fluid"></p>
<p><br>
&nbsp;</p>
<center>
<em>Multivariate Analysis (VAR and ARIMAX) Segment 2 Flow Chart</em>
</center>
<p><br>
&nbsp;</p>
</section>
<section id="building-the-var-model-1970-2020-pre-and-post-911-attacks" class="level2">
<h2 class="anchored" data-anchor-id="building-the-var-model-1970-2020-pre-and-post-911-attacks">Building the VAR Model (1970-2020: Pre and Post-9/11 Attacks)</h2>
<section id="time-series-plots" class="level3">
<h3 class="anchored" data-anchor-id="time-series-plots">Time Series Plots</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(var_ts , <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/tsplots-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="pair-plots" class="level3">
<h3 class="anchored" data-anchor-id="pair-plots">Pair Plots</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create scatterplot matrix using plotly</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(var_ts),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"splom"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">diagonal =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">FALSE</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimensions =</span> <span class="fu">list</span>(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"# Attacks"</span>, <span class="at">values =</span> <span class="sc">~</span>num_attacks),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"B-2 Visa"</span>, <span class="at">values =</span> <span class="sc">~</span>Pleasure),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"B-1 Visa"</span>, <span class="at">values =</span> <span class="sc">~</span>Business),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"F-1 Visa"</span>, <span class="at">values =</span> <span class="sc">~</span>Students),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Military Exp"</span>, <span class="at">values =</span> <span class="sc">~</span>milexp.gdp),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"RTX"</span>, <span class="at">values =</span> <span class="sc">~</span>RTX)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">hovermode =</span> <span class="st">"x"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># customize layout</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Scatterplot Matrix of VAR Model Variables (Pre and Post-9/11)"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># display plot</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-75fe2d6713e39eb4e312" style="width:100%;height:928px;"></div>
<script type="application/json" data-for="htmlwidget-75fe2d6713e39eb4e312">{"x":{"visdat":{"759e7da08a34":["function () ","plotlyVisDat"]},"cur_data":"759e7da08a34","attrs":{"759e7da08a34":{"diagonal":{"visible":false},"dimensions":[{"label":"# Attacks","values":{}},{"label":"B-2 Visa","values":{}},{"label":"B-1 Visa","values":{}},{"label":"F-1 Visa","values":{}},{"label":"Military Exp","values":{}},{"label":"RTX","values":{}}],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"splom"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"hovermode":"x","title":"Scatterplot Matrix of VAR Model Variables (Pre and Post-9/11)","xaxis":{"title":""},"yaxis":{"title":""},"showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"diagonal":{"visible":false},"dimensions":[{"label":"# Attacks","values":[464,246,65,58,92,149,105,129,86,69,66,70,77,44,63,40,49,33,26,41,31,31,31,21,54,57,35,42,31,51,42,47,33,35,9,20,6,11,18,12,16,9,20,20,29,41,68,66,76,72,103]},{"label":"B-2 Visa","values":[9515170,9515170,9515170,9515170,9515170,9515170,9515170,9515170,9515170,9515170,9515170,9515170,8788525,8061880,7335235,6608590,7985088.5,9361587,10738085.5,12114584,13418328,14618065,16440997,16918351,17154834,17611536,19110004,14312587,9515170,23643561,22335763.6666667,21027966.3333333,19720169,19981833,22653699,23701858,24788438,27486177,29442168,27800027,35131310,40578964,42025488,48346018,59784922,61017237,61029117,61600219,64819854,64864687,28731613]},{"label":"B-1 Visa","values":[1135422,1135422,1135422,1135422,1135422,1135422,1135422,1135422,1135422,1135422,1135422,1135422,1300771.25,1466120.5,1631469.75,1796819,1985794,2174769,2363744,2552719,2661338,2616335,2788069,2961092,3164099,3275336,3770326,4077931,4385536,4554517,4486074.33333333,4417631.66666667,4349189,4198988,4576783,4684164,5030779,5418884,5603668,4390888,5205980,5694809,5705106,6299533,7734191,8008659,8290712,8456038,8967224,9059770,4209153]},{"label":"F-1 Visa","values":[240805,240805,240805,240805,240805,240805,240805,240805,240805,240805,240805,240805,244871,248937,253003,257069,276402.25,295735.5,315068.75,334402,326264,343238,368686,370620,394001,364220,426903,512711.5,598520,641760,699953,741921,687506,662966,656373,663919,740724,841673,917373,951964,1595078,1788962,1653576,1669225,1837664,1990661,1991940,1940171,1957852,1907176,918442]},{"label":"Military Exp","values":[0.0803274358404085,0.0694306960936061,0.0651975692434716,0.058938705911674,0.0595411119676015,0.0562267909613336,0.0519107142902555,0.0515561735127125,0.0494308724791688,0.0495199153527265,0.0515353746651636,0.0564654125624258,0.0681405709441284,0.0632114425976717,0.0623641652963897,0.064532192046686,0.0662652265789842,0.0642027402288488,0.060712777020948,0.0587120600804653,0.0560517529438794,0.0488342939776313,0.0497046680768284,0.0460435029507644,0.042152646751779,0.038602457917389,0.0355498220635218,0.0340556224418855,0.0320155849896996,0.0308567678324746,0.0311224214697679,0.0312380980266703,0.0344761809928778,0.0382716104473623,0.0401631273640692,0.0409003487632585,0.0404162723678969,0.040796550810522,0.0446382735629989,0.0488559968011478,0.0492264167706996,0.0484017399490274,0.0447740121867267,0.0404667887867098,0.0369589465026568,0.0347784516633609,0.0341346420823965,0.0330938753223376,0.0331115856059771,0.0342619487015821,0.0371788506411202]},{"label":"RTX","values":[0.136338,0.125117,0.118484,0.111851,0.165332,0.245645,0.427321,0.468292666666667,0.509264333333333,0.550236,0.816227,0.585846,0.83992,1.000784,1.161648,1.437608,1.556818,1.182128,1.408983,1.635838,1.862693,2.194056,1.999997,2.664417,3.823936,4.983455,6.142974,6.861032,10.402697,12.579849,12.7098845,12.83992,12.490478,19.409138,21.493515,25.4813576666667,29.4692003333333,33.457043,23.925997,31.86618,37.020096,38.7639105,40.507725,57.465115,59.322578,50.751015,53.9815306666667,57.2120463333333,60.442562,86.929314,67.844963]}],"type":"splom","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri_rtx &lt;- subset(gtd_dhs_sipri_rtx, select=-c(Business, Pleasure, Students))</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert df back to matrix</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ts_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(gtd_dhs_sipri_rtx[, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the matrix to a time series object with a yearly frequency</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>var_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(ts_matrix, <span class="at">frequency =</span> <span class="dv">1</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="dv">1970</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># split into train and test sets</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">29830</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>train_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(var_ts), <span class="fl">0.9</span> <span class="sc">*</span> <span class="fu">nrow</span>(var_ts))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> var_ts[train_idx, ]</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> var_ts[<span class="sc">-</span>train_idx, ]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Lasso regression model with cross-validation</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># cv_fit &lt;- cv.glmnet(train[, 2], train[, 1], alpha = 1)</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # Extract selected variables</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># cv_fits &lt;- as.data.frame(as.matrix(coef(cv_fit)))</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># to_include &lt;- rownames(cv_fits)[cv_fits$s1 != 0]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fitting-var-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-var-model">Fitting VAR Model</h3>
<p>Here we use the <code>VARselect()</code> function to find the best <code>p</code> to fit <code>VAR(p)</code>. We will choose a maximum lag of 10 and check which <code>p</code> value returns lowest AIC.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(var_result <span class="ot">&lt;-</span> <span class="fu">VARselect</span>(var_ts, <span class="at">lag.max =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"both"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
    10     10      1     10 

$criteria
                  1            2            3            4            5
AIC(n) 6.218555e+01 6.221758e+01 6.247328e+01 6.263055e+01 6.268341e+01
HQ(n)  6.241384e+01 6.258284e+01 6.297552e+01 6.326976e+01 6.345959e+01
SC(n)  6.281247e+01 6.322065e+01 6.385250e+01 6.438592e+01 6.481493e+01
FPE(n) 1.019603e+27 1.065015e+27 1.410394e+27 1.727137e+27 1.960066e+27
                  6            7            8            9           10
AIC(n) 6.243987e+01 6.271077e+01 6.289237e+01 6.233062e+01 6.031548e+01
HQ(n)  6.335303e+01 6.376089e+01 6.407947e+01 6.365469e+01 6.177652e+01
SC(n)  6.494754e+01 6.559458e+01 6.615234e+01 6.596673e+01 6.432774e+01
FPE(n) 1.719961e+27 2.666183e+27 4.086231e+27 3.345728e+27 7.729491e+26</code></pre>
</div>
</div>
<p>Now, we will fit VAR(1), VAR(2), and VAR(3):</p>
<p>VAR(1) output:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">"both"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: num_attacks, Pleasure, Business 
Deterministic variables: both 
Sample size: 50 
Log Likelihood: -1772.497 
Roots of the characteristic polynomial:
0.8827 0.5279 0.2543
Call:
VAR(y = var_ts, p = 1, type = "both")


Estimation results for equation num_attacks: 
============================================ 
num_attacks = num_attacks.l1 + Pleasure.l1 + Business.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
num_attacks.l1  3.087e-01  5.832e-02   5.294 3.44e-06 ***
Pleasure.l1     8.347e-07  5.901e-07   1.415 0.164038    
Business.l1     1.238e-05  7.894e-06   1.568 0.123817    
const           6.014e+01  1.069e+01   5.625 1.12e-06 ***
trend          -3.400e+00  9.520e-01  -3.571 0.000861 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 20.62 on 45 degrees of freedom
Multiple R-Squared: 0.7746, Adjusted R-squared: 0.7545 
F-statistic: 38.66 on 4 and 45 DF,  p-value: 5.101e-14 


Estimation results for equation Pleasure: 
========================================= 
Pleasure = num_attacks.l1 + Pleasure.l1 + Business.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
num_attacks.l1  7.069e+03  1.681e+04   0.421   0.6760    
Pleasure.l1     1.027e+00  1.700e-01   6.039 2.73e-07 ***
Business.l1    -3.886e+00  2.275e+00  -1.708   0.0945 .  
const          -1.624e+06  3.081e+06  -0.527   0.6007    
trend           5.757e+05  2.744e+05   2.098   0.0415 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 5941000 on 45 degrees of freedom
Multiple R-Squared: 0.8944, Adjusted R-squared: 0.885 
F-statistic: 95.26 on 4 and 45 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation Business: 
========================================= 
Business = num_attacks.l1 + Pleasure.l1 + Business.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)  
num_attacks.l1  7.075e+02  2.103e+03   0.336   0.7381  
Pleasure.l1     2.125e-02  2.128e-02   0.999   0.3232  
Business.l1     3.292e-01  2.847e-01   1.157   0.2535  
const          -8.672e+04  3.855e+05  -0.225   0.8230  
trend           7.894e+04  3.433e+04   2.299   0.0262 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 743400 on 45 degrees of freedom
Multiple R-Squared: 0.9077, Adjusted R-squared: 0.8995 
F-statistic: 110.6 on 4 and 45 DF,  p-value: &lt; 2.2e-16 



Covariance matrix of residuals:
            num_attacks   Pleasure   Business
num_attacks         425 -1.755e+07 -2.952e+06
Pleasure      -17552819  3.530e+13  3.916e+12
Business       -2952322  3.916e+12  5.527e+11

Correlation matrix of residuals:
            num_attacks Pleasure Business
num_attacks      1.0000  -0.1433  -0.1926
Pleasure        -0.1433   1.0000   0.8865
Business        -0.1926   0.8865   1.0000</code></pre>
</div>
</div>
<p>VAR(2) output:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">"both"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: num_attacks, Pleasure, Business 
Deterministic variables: both 
Sample size: 49 
Log Likelihood: -1719.76 
Roots of the characteristic polynomial:
0.8629 0.7233 0.7233 0.4716 0.4716 0.03415
Call:
VAR(y = var_ts, p = 2, type = "both")


Estimation results for equation num_attacks: 
============================================ 
num_attacks = num_attacks.l1 + Pleasure.l1 + Business.l1 + num_attacks.l2 + Pleasure.l2 + Business.l2 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
num_attacks.l1  2.669e-01  1.141e-01   2.338 0.024333 *  
Pleasure.l1     1.513e-07  8.588e-07   0.176 0.861004    
Business.l1     6.099e-06  8.841e-06   0.690 0.494203    
num_attacks.l2 -2.348e-01  5.596e-02  -4.196 0.000142 ***
Pleasure.l2     1.114e-06  9.178e-07   1.214 0.231616    
Business.l2     1.446e-05  8.930e-06   1.619 0.113127    
const           9.813e+01  1.136e+01   8.642 8.86e-11 ***
trend          -5.585e+00  8.663e-01  -6.447 1.00e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 15.33 on 41 degrees of freedom
Multiple R-Squared: 0.7942, Adjusted R-squared: 0.7591 
F-statistic:  22.6 on 7 and 41 DF,  p-value: 3.428e-12 


Estimation results for equation Pleasure: 
========================================= 
Pleasure = num_attacks.l1 + Pleasure.l1 + Business.l1 + num_attacks.l2 + Pleasure.l2 + Business.l2 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)   
num_attacks.l1 -1.154e+04  4.545e+04  -0.254  0.80090   
Pleasure.l1     1.086e+00  3.419e-01   3.175  0.00284 **
Business.l1    -1.374e+00  3.520e+00  -0.390  0.69825   
num_attacks.l2  1.184e+04  2.228e+04   0.531  0.59808   
Pleasure.l2    -5.633e-02  3.654e-01  -0.154  0.87827   
Business.l2    -2.950e+00  3.556e+00  -0.830  0.41156   
const          -1.615e+06  4.521e+06  -0.357  0.72284   
trend           6.223e+05  3.449e+05   1.804  0.07856 . 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 6103000 on 41 degrees of freedom
Multiple R-Squared: 0.8972, Adjusted R-squared: 0.8797 
F-statistic: 51.13 on 7 and 41 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation Business: 
========================================= 
Business = num_attacks.l1 + Pleasure.l1 + Business.l1 + num_attacks.l2 + Pleasure.l2 + Business.l2 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)  
num_attacks.l1 -4.733e+02  5.638e+03  -0.084   0.9335  
Pleasure.l1     2.071e-02  4.242e-02   0.488   0.6279  
Business.l1     7.792e-01  4.367e-01   1.784   0.0818 .
num_attacks.l2  1.007e+03  2.764e+03   0.364   0.7175  
Pleasure.l2     1.762e-03  4.534e-02   0.039   0.9692  
Business.l2    -5.502e-01  4.411e-01  -1.247   0.2194  
const          -1.522e+05  5.609e+05  -0.271   0.7875  
trend           9.085e+04  4.279e+04   2.123   0.0398 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 757100 on 41 degrees of freedom
Multiple R-Squared: 0.9105, Adjusted R-squared: 0.8952 
F-statistic: 59.57 on 7 and 41 DF,  p-value: &lt; 2.2e-16 



Covariance matrix of residuals:
            num_attacks   Pleasure   Business
num_attacks   2.349e+02 -1.161e+07 -2.274e+06
Pleasure     -1.161e+07  3.725e+13  4.082e+12
Business     -2.274e+06  4.082e+12  5.732e+11

Correlation matrix of residuals:
            num_attacks Pleasure Business
num_attacks      1.0000  -0.1242  -0.1960
Pleasure        -0.1242   1.0000   0.8834
Business        -0.1960   0.8834   1.0000</code></pre>
</div>
</div>
<p>VAR(3) output:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">"both"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: num_attacks, Pleasure, Business 
Deterministic variables: both 
Sample size: 48 
Log Likelihood: -1677.209 
Roots of the characteristic polynomial:
0.9075 0.8361 0.8361 0.6494 0.5669 0.5669 0.4691 0.4691 0.1478
Call:
VAR(y = var_ts, p = 3, type = "both")


Estimation results for equation num_attacks: 
============================================ 
num_attacks = num_attacks.l1 + Pleasure.l1 + Business.l1 + num_attacks.l2 + Pleasure.l2 + Business.l2 + num_attacks.l3 + Pleasure.l3 + Business.l3 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
num_attacks.l1  3.398e-02  1.467e-01   0.232   0.8181    
Pleasure.l1     5.179e-07  7.826e-07   0.662   0.5122    
Business.l1     7.377e-06  8.045e-06   0.917   0.3651    
num_attacks.l2  8.679e-02  1.103e-01   0.787   0.4364    
Pleasure.l2     5.680e-07  1.068e-06   0.532   0.5979    
Business.l2     1.079e-05  1.039e-05   1.038   0.3060    
num_attacks.l3 -2.066e-01  6.179e-02  -3.343   0.0019 ** 
Pleasure.l3     2.518e-07  8.479e-07   0.297   0.7682    
Business.l3     1.001e-05  8.376e-06   1.195   0.2396    
const           1.190e+02  1.888e+01   6.302 2.45e-07 ***
trend          -7.099e+00  1.179e+00  -6.020 5.91e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 13.74 on 37 degrees of freedom
Multiple R-Squared:  0.85,  Adjusted R-squared: 0.8094 
F-statistic: 20.96 on 10 and 37 DF,  p-value: 2.511e-12 


Estimation results for equation Pleasure: 
========================================= 
Pleasure = num_attacks.l1 + Pleasure.l1 + Business.l1 + num_attacks.l2 + Pleasure.l2 + Business.l2 + num_attacks.l3 + Pleasure.l3 + Business.l3 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)   
num_attacks.l1 -3.438e+04  6.741e+04  -0.510  0.61304   
Pleasure.l1     1.084e+00  3.595e-01   3.014  0.00464 **
Business.l1    -1.803e+00  3.696e+00  -0.488  0.62850   
num_attacks.l2 -1.503e+04  5.067e+04  -0.297  0.76846   
Pleasure.l2    -2.556e-01  4.904e-01  -0.521  0.60541   
Business.l2    -2.352e+00  4.773e+00  -0.493  0.62507   
num_attacks.l3  4.440e+03  2.839e+04   0.156  0.87656   
Pleasure.l3     3.296e-01  3.895e-01   0.846  0.40291   
Business.l3    -3.226e-01  3.848e+00  -0.084  0.93364   
const           2.443e+06  8.674e+06   0.282  0.77980   
trend           4.864e+05  5.418e+05   0.898  0.37513   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 6311000 on 37 degrees of freedom
Multiple R-Squared: 0.8995, Adjusted R-squared: 0.8724 
F-statistic: 33.12 on 10 and 37 DF,  p-value: 1.864e-15 


Estimation results for equation Business: 
========================================= 
Business = num_attacks.l1 + Pleasure.l1 + Business.l1 + num_attacks.l2 + Pleasure.l2 + Business.l2 + num_attacks.l3 + Pleasure.l3 + Business.l3 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)
num_attacks.l1 -7.995e+02  8.425e+03  -0.095    0.925
Pleasure.l1     1.900e-02  4.493e-02   0.423    0.675
Business.l1     7.341e-01  4.618e-01   1.590    0.120
num_attacks.l2 -2.755e+03  6.332e+03  -0.435    0.666
Pleasure.l2    -1.137e-02  6.129e-02  -0.186    0.854
Business.l2    -4.329e-01  5.965e-01  -0.726    0.473
num_attacks.l3  1.477e+03  3.548e+03   0.416    0.680
Pleasure.l3     2.425e-02  4.868e-02   0.498    0.621
Business.l3    -1.421e-01  4.809e-01  -0.296    0.769
const           1.754e+04  1.084e+06   0.016    0.987
trend           9.116e+04  6.771e+04   1.346    0.186


Residual standard error: 788700 on 37 degrees of freedom
Multiple R-Squared: 0.9098, Adjusted R-squared: 0.8855 
F-statistic: 37.34 on 10 and 37 DF,  p-value: 2.617e-16 



Covariance matrix of residuals:
            num_attacks   Pleasure   Business
num_attacks   1.887e+02 -1.040e+07 -1.886e+06
Pleasure     -1.040e+07  3.983e+13  4.403e+12
Business     -1.886e+06  4.403e+12  6.221e+11

Correlation matrix of residuals:
            num_attacks Pleasure Business
num_attacks      1.0000  -0.1199  -0.1741
Pleasure        -0.1199   1.0000   0.8845
Business        -0.1741   0.8845   1.0000</code></pre>
</div>
</div>
</section>
<section id="k-fold-cross-validation-and-model-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="k-fold-cross-validation-and-model-diagnostics">K-Fold Cross Validation and Model Diagnostics</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of folds for cross-validation</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the p values to test</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into k folds</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>cv_folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(var_ts)), <span class="at">breaks =</span> k, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors to store RMSE and AIC values for each p value</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>rmse_vec <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(p_values))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>aic_vec <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(p_values))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over p values and perform cross-validation</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(p_values)) {</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p_values[i]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  rmse_cv <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  aic_cv <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the data into training and testing sets</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    train <span class="ot">&lt;-</span> var_ts[cv_folds <span class="sc">!=</span> j, ]</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    test <span class="ot">&lt;-</span> var_ts[cv_folds <span class="sc">==</span> j, ]</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the VAR model with the current p value</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    var_fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(train, <span class="at">p =</span> p)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make predictions for the testing set</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(var_fit, <span class="at">n.ahead =</span> <span class="fu">nrow</span>(test))<span class="sc">$</span>fcst</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate RMSE and AIC for the current fold</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    rmse_cv[j] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((pred<span class="sc">$</span>num_attacks <span class="sc">-</span> test[,<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    aic_cv[j] <span class="ot">&lt;-</span> <span class="fu">AIC</span>(var_fit)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the mean RMSE and AIC across all folds for the current p value</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  rmse_vec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rmse_cv)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  aic_vec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(aic_cv)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table of RMSE and AIC values for each p value</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(p_values, rmse_vec, aic_vec)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results table</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(results_table, <span class="at">format =</span> <span class="st">"markdown"</span>, </span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"P Values"</span>, <span class="st">"Mean RMSE (5 Folds)"</span>, <span class="st">"Mean AIC (5 Folds)"</span>), <span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: center;">P Values</th>
<th style="text-align: center;">Mean RMSE (5 Folds)</th>
<th style="text-align: center;">Mean AIC (5 Folds)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">69.41</td>
<td style="text-align: center;">2839.88</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">95.77</td>
<td style="text-align: center;">2768.59</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">90.21</td>
<td style="text-align: center;">2702.07</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The <code>VAR(1)</code> model outputs the lowest Mean RMSE of 69.405026 attacks from the 5-fold cross validation. However, it has the highest AIC score. Because test set performance is best and it is the simplest model, we shall choose the <code>VAR(1)</code> model as the best option.</p>
</section>
<section id="forecasting-chosen-model-p1" class="level3">
<h3 class="anchored" data-anchor-id="forecasting-chosen-model-p1">Forecasting Chosen Model (p=1)</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>final_var <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p =</span> <span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">fit.pr =</span> <span class="fu">predict</span>(final_var, <span class="at">n.ahead =</span> <span class="dv">5</span>, <span class="at">ci =</span> <span class="fl">0.95</span>)) <span class="co"># 5 years ahead </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$num_attacks
         fcst      lower    upper       CI
[1,] 74.99198 29.7166120 120.2674 45.27537
[2,] 62.51771 12.3013333 112.7341 50.21637
[3,] 56.71276  4.5370981 108.8884 52.17566
[4,] 53.80558  0.3106907 107.3005 53.49489
[5,] 52.18705 -2.3286201 106.7027 54.51567

$Pleasure
         fcst    lower    upper       CI
[1,] 28008600 15940797 40076403 12067803
[2,] 27732679 11205503 44259856 16527177
[3,] 27655150  8102498 47207803 19552652
[4,] 27668361  5880296 49456426 21788065
[5,] 27724860  4218078 51231642 23506782

$Business
        fcst   lower   upper      CI
[1,] 4142849 2619394 5666304 1523455
[2,] 4141639 2055830 6227448 2085809
[3,] 4166222 1698565 6633879 2467657
[4,] 4200017 1450247 6949786 2749770
[5,] 4236079 1269647 7202511 2966432</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fanchart</span>(fit.pr) <span class="co"># plot prediction + error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/forc2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The above plot showcases the forecasts for each variable present in the <code>VAR(1)</code> model, <code>Number of Yearly Attacks</code>, <code>US Military Expenditure as a % of US GDP</code>, and Closing Price of <code>Raytheon Technologies Stock</code>. The predicted forecast, from the years 2021 to 2025, for <code>Number of Yearly Attacks</code> is a good sign for the US due to the decreasing and plateauing trend, although the actual observations from 2015 onward suggest an increasing trend. The same forecast trend is discerned for <code>US Military Expenditure as a % of US GDP</code>, with <code>Raytheon Technologies Stock</code> being the only variable with a predicted increasing trend.</p>
<p>Let us visualize more closely the forecasts for the <code>Number of Yearly Attacks</code> from 2021 to 2025, corresponding to the VAR(1) model fitted on all years (1970-2020):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create df of attack forecasts</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df_fvar_attack <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fit.pr<span class="sc">$</span>fcst<span class="sc">$</span>num_attacks)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add year column</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>df_fvar_attack<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>(var_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>df_fvar_attack, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>fcst, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Forecast"</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span><span class="st">"Confidence Interval"</span>), <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"VAR(1) Forecasts for Number of Yearly Attacks from 2021 to 2025"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Number of Terrorist Attacks"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="st">""</span>, <span class="at">fill=</span><span class="st">""</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Data Sources: Global Terrorism Database, SIPRI Military Expenditure Database, Yahoo Finance"</span>) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span><span class="ot">=</span><span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"95% Confidence Interval"</span><span class="ot">=</span><span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption.position =</span> <span class="st">"plot"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/forcattacks2-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplotly(var_plot)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="building-the-var-model-2001-2020-post-911-attacks" class="level2">
<h2 class="anchored" data-anchor-id="building-the-var-model-2001-2020-post-911-attacks">Building the VAR Model (2001-2020: Post-9/11 Attacks)</h2>
<section id="time-series-plots-1" class="level3">
<h3 class="anchored" data-anchor-id="time-series-plots-1">Time Series Plots</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(var_ts , <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/tsplots2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="pair-plots-1" class="level3">
<h3 class="anchored" data-anchor-id="pair-plots-1">Pair Plots</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create scatterplot matrix using plotly</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(var_ts), </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"splom"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">diagonal =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">FALSE</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimensions =</span> <span class="fu">list</span>(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"# Attacks"</span>, <span class="at">values =</span> <span class="sc">~</span>num_attacks),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Military Exp"</span>, <span class="at">values =</span> <span class="sc">~</span>milexp.gdp),</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"RTX"</span>, <span class="at">values =</span> <span class="sc">~</span>RTX),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"LMT"</span>, <span class="at">values =</span> <span class="sc">~</span>LMT)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">hovermode =</span> <span class="st">"x"</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Scatterplot Matrix of VAR Model Variables (Post-9/11)"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># display plot</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ba226fd8a0e78da18f98" style="width:100%;height:928px;"></div>
<script type="application/json" data-for="htmlwidget-ba226fd8a0e78da18f98">{"x":{"visdat":{"759e7122c943":["function () ","plotlyVisDat"]},"cur_data":"759e7122c943","attrs":{"759e7122c943":{"diagonal":{"visible":false},"dimensions":[{"label":"# Attacks","values":{}},{"label":"Military Exp","values":{}},{"label":"RTX","values":{}},{"label":"LMT","values":{}}],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"splom"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"hovermode":"x","title":"Scatterplot Matrix of VAR Model Variables (Post-9/11)","xaxis":{"title":""},"yaxis":{"title":""},"showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"diagonal":{"visible":false},"dimensions":[{"label":"# Attacks","values":[47,33,35,9,20,6,11,18,12,16,9,20,20,29,41,68,66,76,72,103]},{"label":"Military Exp","values":[0.0312380980266703,0.0344761809928778,0.0382716104473623,0.0401631273640692,0.0409003487632585,0.0404162723678969,0.040796550810522,0.0446382735629989,0.0488559968011478,0.0492264167706996,0.0484017399490274,0.0447740121867267,0.0404667887867098,0.0369589465026568,0.0347784516633609,0.0341346420823965,0.0330938753223376,0.0331115856059771,0.0342619487015821,0.0371788506411202]},{"label":"RTX","values":[12.83992,12.490478,19.409138,21.493515,25.4813576666667,29.4692003333333,33.457043,23.925997,31.86618,37.020096,38.7639105,40.507725,57.465115,59.322578,50.751015,53.9815306666667,57.2120463333333,60.442562,86.929314,67.844963]},{"label":"LMT","values":[26.779816,33.390778,30.08082,33.08585,43.9624303333333,54.8390106666667,65.715591,53.519119,49.459442,47.561493,58.0871695,68.612846,115.347717,154.290466,179.261841,197.47376,215.685679,233.897598,356.802948,333.634521]}],"type":"splom","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="fitting-var-model-1" class="level3">
<h3 class="anchored" data-anchor-id="fitting-var-model-1">Fitting VAR Model</h3>
<p>Here we use the <code>VARselect()</code> function to find the best <code>p</code> to fit <code>VAR(p)</code>. We will choose a maximum lag of 10 and check which <code>p</code> value returns lowest AIC.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(var_result <span class="ot">&lt;-</span> <span class="fu">VARselect</span>(var_ts, <span class="at">lag.max =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"both"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
     2      2      2      3 

$criteria
                1    2    3    4    5    6    7    8    9   10
AIC(n) -2.0240586 -Inf -Inf -Inf -Inf -Inf -Inf -Inf -Inf -Inf
HQ(n)  -2.8207028 -Inf -Inf -Inf -Inf -Inf -Inf -Inf -Inf -Inf
SC(n)  -1.2978543 -Inf -Inf -Inf -Inf -Inf -Inf -Inf -Inf -Inf
FPE(n)  0.2783486  NaN    0    0    0    0    0    0    0    0</code></pre>
</div>
</div>
<p>Now, we will fit VAR(1), VAR(2), and VAR(3):</p>
<p>VAR(1) output:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">"both"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: num_attacks, milexp.gdp, RTX, LMT 
Deterministic variables: both 
Sample size: 19 
Log Likelihood: -88.384 
Roots of the characteristic polynomial:
0.9729 0.9729 0.294 0.294
Call:
VAR(y = var_ts, p = 1, type = "both")


Estimation results for equation num_attacks: 
============================================ 
num_attacks = num_attacks.l1 + milexp.gdp.l1 + RTX.l1 + LMT.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)   
num_attacks.l1  1.595e-02  2.081e-01   0.077  0.94006   
milexp.gdp.l1  -1.081e+03  6.258e+02  -1.728  0.10764   
RTX.l1         -7.065e-01  4.474e-01  -1.579  0.13830   
LMT.l1          3.208e-01  9.775e-02   3.282  0.00595 **
const           5.678e+01  2.649e+01   2.144  0.05155 . 
trend           1.292e+00  1.110e+00   1.164  0.26544   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 7.386 on 13 degrees of freedom
Multiple R-Squared: 0.9508, Adjusted R-squared: 0.9319 
F-statistic: 50.28 on 5 and 13 DF,  p-value: 4.759e-08 


Estimation results for equation milexp.gdp: 
=========================================== 
milexp.gdp = num_attacks.l1 + milexp.gdp.l1 + RTX.l1 + LMT.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
num_attacks.l1 -1.634e-05  4.514e-05  -0.362  0.72313    
milexp.gdp.l1   1.173e+00  1.357e-01   8.642 9.51e-07 ***
RTX.l1         -2.367e-04  9.703e-05  -2.439  0.02982 *  
LMT.l1          7.978e-05  2.120e-05   3.763  0.00237 ** 
const           8.972e-05  5.745e-03   0.016  0.98778    
trend          -4.702e-04  2.407e-04  -1.953  0.07269 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 0.001602 on 13 degrees of freedom
Multiple R-Squared: 0.9358, Adjusted R-squared: 0.9111 
F-statistic: 37.88 on 5 and 13 DF,  p-value: 2.648e-07 


Estimation results for equation RTX: 
==================================== 
RTX = num_attacks.l1 + milexp.gdp.l1 + RTX.l1 + LMT.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)   
num_attacks.l1    0.15927    0.20253   0.786  0.44574   
milexp.gdp.l1  -237.75906  609.01223  -0.390  0.70256   
RTX.l1            0.25639    0.43534   0.589  0.56599   
LMT.l1           -0.09915    0.09512  -1.042  0.31625   
const             9.74924   25.77580   0.378  0.71136   
trend             3.40135    1.08011   3.149  0.00769 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 7.187 on 13 degrees of freedom
Multiple R-Squared: 0.901,  Adjusted R-squared: 0.8629 
F-statistic: 23.66 on 5 and 13 DF,  p-value: 4.196e-06 


Estimation results for equation LMT: 
==================================== 
LMT = num_attacks.l1 + milexp.gdp.l1 + RTX.l1 + LMT.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)  
num_attacks.l1     0.6765     0.7228   0.936   0.3664  
milexp.gdp.l1  -2954.0655  2173.5506  -1.359   0.1972  
RTX.l1             0.6736     1.5537   0.434   0.6717  
LMT.l1             0.2730     0.3395   0.804   0.4358  
const             71.2471    91.9932   0.774   0.4525  
trend              8.2020     3.8549   2.128   0.0531 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 25.65 on 13 degrees of freedom
Multiple R-Squared: 0.9554, Adjusted R-squared: 0.9382 
F-statistic: 55.66 on 5 and 13 DF,  p-value: 2.549e-08 



Covariance matrix of residuals:
            num_attacks milexp.gdp        RTX        LMT
num_attacks    54.55371 -2.410e-03 -14.602526 -62.659252
milexp.gdp     -0.00241  2.566e-06  -0.002115  -0.001013
RTX           -14.60253 -2.115e-03  51.659389 167.723385
LMT           -62.65925 -1.013e-03 167.723385 658.016441

Correlation matrix of residuals:
            num_attacks milexp.gdp     RTX      LMT
num_attacks      1.0000   -0.20366 -0.2751 -0.33072
milexp.gdp      -0.2037    1.00000 -0.1837 -0.02465
RTX             -0.2751   -0.18367  1.0000  0.90971
LMT             -0.3307   -0.02465  0.9097  1.00000</code></pre>
</div>
</div>
<p>VAR(2) output:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">"both"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: num_attacks, milexp.gdp, RTX, LMT 
Deterministic variables: both 
Sample size: 18 
Log Likelihood: -53.372 
Roots of the characteristic polynomial:
 1.02 1.006 1.006 0.9265 0.7296 0.7296 0.7047 0.7047
Call:
VAR(y = var_ts, p = 2, type = "both")


Estimation results for equation num_attacks: 
============================================ 
num_attacks = num_attacks.l1 + milexp.gdp.l1 + RTX.l1 + LMT.l1 + num_attacks.l2 + milexp.gdp.l2 + RTX.l2 + LMT.l2 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)  
num_attacks.l1 -2.451e-01  2.616e-01  -0.937   0.3762  
milexp.gdp.l1  -5.577e+02  1.109e+03  -0.503   0.6287  
RTX.l1         -1.690e+00  6.322e-01  -2.673   0.0282 *
LMT.l1          5.662e-01  1.757e-01   3.223   0.0122 *
num_attacks.l2  3.234e-01  1.772e-01   1.825   0.1055  
milexp.gdp.l2  -1.465e+03  1.851e+03  -0.791   0.4516  
RTX.l2          5.994e-02  5.480e-01   0.109   0.9156  
LMT.l2         -5.252e-01  2.400e-01  -2.188   0.0601 .
const           8.362e+01  4.723e+01   1.770   0.1146  
trend           7.212e+00  3.296e+00   2.188   0.0601 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 5.75 on 8 degrees of freedom
Multiple R-Squared: 0.9817, Adjusted R-squared: 0.961 
F-statistic: 47.57 on 9 and 8 DF,  p-value: 5.404e-06 


Estimation results for equation milexp.gdp: 
=========================================== 
milexp.gdp = num_attacks.l1 + milexp.gdp.l1 + RTX.l1 + LMT.l1 + num_attacks.l2 + milexp.gdp.l2 + RTX.l2 + LMT.l2 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
num_attacks.l1 -5.792e-05  6.941e-05  -0.835 0.428209    
milexp.gdp.l1   1.632e+00  2.943e-01   5.546 0.000544 ***
RTX.l1          1.623e-05  1.677e-04   0.097 0.925291    
LMT.l1          7.586e-06  4.661e-05   0.163 0.874752    
num_attacks.l2 -3.381e-05  4.702e-05  -0.719 0.492632    
milexp.gdp.l2  -8.161e-01  4.912e-01  -1.662 0.135177    
RTX.l2          2.335e-05  1.454e-04   0.161 0.876379    
LMT.l2          3.700e-05  6.368e-05   0.581 0.577191    
const           9.377e-03  1.253e-02   0.748 0.475719    
trend          -4.351e-04  8.745e-04  -0.498 0.632216    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 0.001526 on 8 degrees of freedom
Multiple R-Squared: 0.962,  Adjusted R-squared: 0.9193 
F-statistic: 22.51 on 9 and 8 DF,  p-value: 9.392e-05 


Estimation results for equation RTX: 
==================================== 
RTX = num_attacks.l1 + milexp.gdp.l1 + RTX.l1 + LMT.l1 + num_attacks.l2 + milexp.gdp.l2 + RTX.l2 + LMT.l2 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)
num_attacks.l1  8.974e-02  3.673e-01   0.244    0.813
milexp.gdp.l1  -1.526e+03  1.558e+03  -0.979    0.356
RTX.l1         -5.968e-02  8.877e-01  -0.067    0.948
LMT.l1         -3.363e-02  2.467e-01  -0.136    0.895
num_attacks.l2  1.332e-01  2.488e-01   0.535    0.607
milexp.gdp.l2   1.441e+03  2.599e+03   0.554    0.595
RTX.l2         -4.760e-01  7.694e-01  -0.619    0.553
LMT.l2         -2.567e-03  3.370e-01  -0.008    0.994
const           1.431e+01  6.632e+01   0.216    0.835
trend           4.414e+00  4.628e+00   0.954    0.368


Residual standard error: 8.074 on 8 degrees of freedom
Multiple R-Squared: 0.9106, Adjusted R-squared:  0.81 
F-statistic: 9.053 on 9 and 8 DF,  p-value: 0.002481 


Estimation results for equation LMT: 
==================================== 
LMT = num_attacks.l1 + milexp.gdp.l1 + RTX.l1 + LMT.l1 + num_attacks.l2 + milexp.gdp.l2 + RTX.l2 + LMT.l2 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)
num_attacks.l1  6.302e-01  1.391e+00   0.453    0.662
milexp.gdp.l1  -5.311e+03  5.897e+03  -0.901    0.394
RTX.l1          1.946e+00  3.361e+00   0.579    0.578
LMT.l1         -1.831e-01  9.339e-01  -0.196    0.849
num_attacks.l2  6.553e-01  9.422e-01   0.696    0.506
milexp.gdp.l2   5.310e+03  9.841e+03   0.540    0.604
RTX.l2          5.094e-02  2.913e+00   0.017    0.986
LMT.l2          8.553e-01  1.276e+00   0.670    0.522
const          -3.930e+01  2.511e+02  -0.157    0.880
trend          -1.058e+00  1.752e+01  -0.060    0.953


Residual standard error: 30.57 on 8 degrees of freedom
Multiple R-Squared: 0.9592, Adjusted R-squared: 0.9134 
F-statistic: 20.91 on 9 and 8 DF,  p-value: 0.0001238 



Covariance matrix of residuals:
            num_attacks milexp.gdp        RTX        LMT
num_attacks   3.306e+01 -3.772e-04 -29.554209 -90.060020
milexp.gdp   -3.772e-04  2.327e-06   0.000433   0.002229
RTX          -2.955e+01  4.330e-04  65.182414 239.325047
LMT          -9.006e+01  2.229e-03 239.325047 934.380096

Correlation matrix of residuals:
            num_attacks milexp.gdp      RTX      LMT
num_attacks      1.0000   -0.04300 -0.63666 -0.51242
milexp.gdp      -0.0430    1.00000  0.03515  0.04781
RTX             -0.6367    0.03515  1.00000  0.96975
LMT             -0.5124    0.04781  0.96975  1.00000</code></pre>
</div>
</div>
<p>VAR(3) output: <code>System is computationally singular!</code></p>
</section>
<section id="k-fold-cross-validation-and-model-diagnostics-1" class="level3">
<h3 class="anchored" data-anchor-id="k-fold-cross-validation-and-model-diagnostics-1">K-Fold Cross Validation and Model Diagnostics</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of folds for cross-validation</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the p values to test</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into k folds</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>cv_folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(var_ts)), <span class="at">breaks =</span> k, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors to store RMSE and AIC values for each p value</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>rmse_vec <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(p_values))</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>aic_vec <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(p_values))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over p values and perform cross-validation</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(p_values)) {</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p_values[i]</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  rmse_cv <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  aic_cv <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the data into training and testing sets</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    train <span class="ot">&lt;-</span> var_ts[cv_folds <span class="sc">!=</span> j, ]</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    test <span class="ot">&lt;-</span> var_ts[cv_folds <span class="sc">==</span> j, ]</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the VAR model with the current p value</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    var_fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(train, <span class="at">p =</span> p)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make predictions for the testing set</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(var_fit, <span class="at">n.ahead =</span> <span class="fu">nrow</span>(test))<span class="sc">$</span>fcst</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate RMSE and AIC for the current fold</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    rmse_cv[j] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((pred<span class="sc">$</span>num_attacks <span class="sc">-</span> test[,<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    aic_cv[j] <span class="ot">&lt;-</span> <span class="fu">AIC</span>(var_fit)</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the mean RMSE and AIC across all folds for the current p value</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>  rmse_vec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rmse_cv)</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>  aic_vec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(aic_cv)</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table of RMSE and AIC values for each p value</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(p_values, rmse_vec, aic_vec)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results table</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(results_table, <span class="at">format =</span> <span class="st">"markdown"</span>, </span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"P Values"</span>, <span class="st">"Mean RMSE (5 Folds)"</span>, <span class="st">"Mean AIC (5 Folds)"</span>), <span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: center;">P Values</th>
<th style="text-align: center;">Mean RMSE (5 Folds)</th>
<th style="text-align: center;">Mean AIC (5 Folds)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">71.52</td>
<td style="text-align: center;">185.30</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">99.81</td>
<td style="text-align: center;">146.72</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The <code>VAR(1)</code> model outputs the lowest Mean RMSE of 71.5162107 attacks from the 5-fold cross validation. However, it has the highest AIC score. Because predictive performance is best and it is the simplest model, we shall choose the <code>VAR(1)</code> model as the best option.</p>
</section>
<section id="forecasting-chosen-model-p1-1" class="level3">
<h3 class="anchored" data-anchor-id="forecasting-chosen-model-p1-1">Forecasting Chosen Model (p=1)</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>final_var <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p =</span> <span class="dv">1</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">fit.pr =</span> <span class="fu">predict</span>(final_var, <span class="at">n.ahead =</span> <span class="dv">5</span>, <span class="at">ci =</span> <span class="fl">0.95</span>)) <span class="co"># 5 years ahead </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$num_attacks
         fcst    lower    upper       CI
[1,] 106.4884 91.82993 121.1468 14.65844
[2,] 105.5359 86.41872 124.6530 19.11715
[3,] 109.0562 81.39160 136.7209 27.66465
[4,] 118.1089 80.57594 155.6418 37.53294
[5,] 131.7816 85.56976 177.9934 46.21181

$milexp.gdp
           fcst      lower      upper          CI
[1,] 0.04196277 0.03852185 0.04540369 0.003440920
[2,] 0.04459493 0.03773271 0.05145715 0.006862220
[3,] 0.04512609 0.03559814 0.05465405 0.009527953
[4,] 0.04433390 0.03338255 0.05528525 0.010951351
[5,] 0.04302182 0.03156563 0.05447801 0.011456190

$RTX
         fcst    lower    upper       CI
[1,]  78.4456 60.42230  96.4689 18.02330
[2,]  92.8866 69.53195 116.2413 23.35465
[3,] 106.4325 80.56025 132.3048 25.87226
[4,] 118.4094 90.38182 146.4371 28.02763
[5,] 129.3340 98.88812 159.7798 30.44585

$LMT
         fcst    lower    upper        CI
[1,] 353.1119 296.8575 409.3663  56.25441
[2,] 388.1265 301.4405 474.8124  86.68600
[3,] 432.9755 319.8177 546.1334 113.15783
[4,] 485.3377 348.8489 621.8265 136.48881
[5,] 543.6910 385.6157 701.7663 158.07532</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fanchart</span>(fit.pr) <span class="co"># plot prediction + error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/forc-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The above plot showcases the forecasts for each variable present in the <code>VAR(1)</code> model, <code>Number of Yearly Attacks</code>, <code>US Military Expenditure as a % of US GDP</code>, and Closing Price of <code>Raytheon Technologies Stock</code>. The predicted forecast, from the years 2021 to 2025, for <code>Number of Yearly Attacks</code> is a good sign for the US due to the decreasing and plateauing trend, although the latest observations from 2015 onwards suggest an increasing trend. The same forecasted trend is discerned for <code>US Military Expenditure as a % of US GDP</code>, with <code>Raytheon Technologies Stock</code> being the only variable with a predicted increasing trend.</p>
<p>Let us visualize more closely the forecasts for the <code>Number of Yearly Attacks</code> from 2021 to 2025, corresponding to the VAR(1) model fitted on 9/11 and post-9/11 years (2001-2020):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create df of attack forecasts</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>df_fvar_attack <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fit.pr<span class="sc">$</span>fcst<span class="sc">$</span>num_attacks)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add year column</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>df_fvar_attack<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>(var_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>df_fvar_attack, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>fcst, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Forecast"</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span><span class="st">"Confidence Interval"</span>), <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"VAR(1) Forecasts for Number of Yearly Attacks from 2021 to 2025"</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Number of Terrorist Attacks"</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="st">""</span>, <span class="at">fill=</span><span class="st">""</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Data Sources: Global Terrorism Database, SIPRI Military Expenditure Database, Yahoo Finance"</span>) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span><span class="ot">=</span><span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"95% Confidence Interval"</span><span class="ot">=</span><span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption.position =</span> <span class="st">"plot"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/forcattacks-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplotly(var_plot)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="manual-arimax-modeling-1970-2020-pre-and-post-911-attacks" class="level2">
<h2 class="anchored" data-anchor-id="manual-arimax-modeling-1970-2020-pre-and-post-911-attacks">Manual ARIMAX Modeling (1970-2020: Pre and Post-9/11 Attacks)</h2>
<p>The ARIMAX model being analyzed in this section is:</p>
<center>
Number of yearly terrorist attacks in the US ~ Number of yearly B-1 visa entrants + Number of yearly B-2 visa entrants + Number of yearly F-1 visa entrants + Yearly US Military Expenditure as Percentage of US GDP + Raytheon Technologies’ Last Yearly Closing Price
</center>
<p><br>
&nbsp;</p>
<p>Its output is as follows:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(country_txt<span class="sc">==</span><span class="st">"United States"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># drop 33 observations from a total of 3121 observations (if taking for '70)</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd_USA_2[<span class="fu">complete.cases</span>(gtd_USA_2<span class="sc">$</span>Date),]</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>gtd_USA_2<span class="sc">$</span>nkill[<span class="fu">is.na</span>(gtd_USA_2<span class="sc">$</span>nkill)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(gtd_USA_2, <span class="at">select=</span><span class="fu">c</span>(Date, nkill))</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co"># new dataframe for monthly number of attacks 1970-2020</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_USA_2 <span class="sc">%&gt;%</span> </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(<span class="fu">year</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise</span>(<span class="at">nkill=</span><span class="fu">sum</span>(nkill),</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                            <span class="at">num_attacks =</span> <span class="fu">n</span>())</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">1</span>] <span class="ot">=</span><span class="st">"Year"</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">2</span>] <span class="ot">=</span><span class="st">"num_fatal"</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">3</span>] <span class="ot">=</span><span class="st">"num_attacks"</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(gtd_yearly_attacks_deaths<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates (0 attacks for those dates)</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_yearly_attacks_deaths <span class="sc">%&gt;%</span> </span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co"># impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">28</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">21</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="co"># CLEAN DHS df</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="do">## convert year to date time</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>dhs<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(dhs<span class="sc">$</span>Year, <span class="st">"-12-31"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="do">## subset</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>dhs <span class="ot">&lt;-</span> <span class="fu">subset</span>(dhs, <span class="at">select =</span> <span class="fu">c</span>(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="co"># join with aggregated GTD df </span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>gtd_dhs <span class="ot">&lt;-</span> <span class="fu">merge</span>(gtd_yearly_attacks_deaths, dhs, <span class="at">by =</span> <span class="st">"Year"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">4</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">4</span>])</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">5</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">5</span>])</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">6</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">6</span>])</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="co"># join sipri dataset -&gt; military expenditure as % of GDP</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> sipri_gdp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">'United States of America'</span>)</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">melt</span>(milexp.gdp, <span class="at">id.vars =</span> <span class="st">'Country'</span>, <span class="at">variable.name =</span> <span class="st">'Year'</span>, <span class="at">value.name =</span> <span class="st">'GDP'</span>) </span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(milexp.gdp[<span class="dv">22</span><span class="sc">:</span><span class="dv">72</span>, <span class="dv">3</span>])</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs, milexp.gdp) </span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,2] &lt;- 10 # subtracting 3004 number of casualties (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,3] &lt;- 43 # subtracting 4 attacks (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting Raytheon Tech Stock Price (only one active since 70's)</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.warning4.0"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.yahoo.warning"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"RTX"</span>)</span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tickers){</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(i,</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"1970-01-01"</span>,</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2021-12-31"</span>)}</span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(RTX<span class="sc">$</span>RTX.Adjusted)</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rtx,<span class="fu">rownames</span>(rtx))</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rtx) <span class="ot">&lt;-</span> <span class="fu">append</span>(tickers,<span class="st">'Dates'</span>)</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>rtx<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(rtx<span class="sc">$</span>Dates,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx <span class="sc">%&gt;%</span> </span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">format</span>(date, <span class="st">"%m-%d"</span>) <span class="sc">==</span> <span class="st">"12-31"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">Year=</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">RTX =</span> <span class="fu">last</span>(RTX))</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(rtx_yearly<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates </span></span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx_yearly <span class="sc">%&gt;%</span> </span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>RTX <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(rtx_yearly<span class="sc">$</span>RTX)</span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a><span class="co"># final join to create final VAR dataset</span></span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs_sipri, rtx_yearly<span class="sc">$</span>RTX) </span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a><span class="co"># rename cols</span></span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_dhs_sipri_rtx)[<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Pleasure"</span>, <span class="st">"Business"</span>, <span class="st">"RTX"</span>)</span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a><span class="co"># convert df to matrix</span></span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a>ts_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(gtd_dhs_sipri_rtx[, <span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the matrix to a time series object with a yearly frequency </span></span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>var_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(ts_matrix, <span class="at">frequency =</span> <span class="dv">1</span>,</span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="dv">1970</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="regression-summary-and-fitting-arima-to-residuals" class="level3">
<h3 class="anchored" data-anchor-id="regression-summary-and-fitting-arima-to-residuals">Regression Summary and Fitting ARIMA to Residuals</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fit.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(num_attacks <span class="sc">~</span> . <span class="sc">-</span> num_fatal, <span class="at">data =</span>var_ts)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = num_attacks ~ . - num_fatal, data = var_ts)

Residuals:
   Min     1Q Median     3Q    Max 
-58.34 -38.63 -18.22  28.38 310.69 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept) -4.073e+01  8.203e+01  -0.497   0.6219  
Pleasure     4.791e-06  2.642e-06   1.813   0.0764 .
Business    -1.831e-05  1.605e-05  -1.141   0.2599  
Students    -8.834e-05  6.736e-05  -1.311   0.1964  
milexp.gdp   2.371e+03  1.216e+03   1.950   0.0574 .
RTX          5.734e-01  1.076e+00   0.533   0.5968  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 62.47 on 45 degrees of freedom
Multiple R-squared:  0.299, Adjusted R-squared:  0.2211 
F-statistic: 3.839 on 5 and 45 DF,  p-value: 0.005556</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>res.fit<span class="ot">&lt;-</span><span class="fu">ts</span>(<span class="fu">residuals</span>(fit.reg),<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-01"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="do">############## Then look at the residuals ############</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>res.fit <span class="sc">%&gt;%</span> <span class="fu">ggtsdisplay</span>() <span class="co"># no need to difference</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/fitregcval-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#q=1,3 Q=1 , p=1,2, P=1,2</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#write a funtion</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>SARIMA.c<span class="ot">=</span><span class="cf">function</span>(p1,p2,q1,q2,P1,P2,Q1,Q2,d1,d2,data){</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  d<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  D<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  s<span class="ot">=</span><span class="dv">12</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">9</span><span class="sc">*</span><span class="dv">44</span>),<span class="at">nrow=</span><span class="dv">44</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> p1<span class="sc">:</span>p2)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(q <span class="cf">in</span> q1<span class="sc">:</span>q2)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(P <span class="cf">in</span> P1<span class="sc">:</span>P2)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(Q <span class="cf">in</span> Q1<span class="sc">:</span>Q2)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(d <span class="cf">in</span> d1<span class="sc">:</span>d2)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(p<span class="sc">+</span>d<span class="sc">+</span>q<span class="sc">+</span>P<span class="sc">+</span>D<span class="sc">+</span>Q<span class="sc">&lt;=</span><span class="dv">8</span>)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>            model<span class="ot">&lt;-</span> <span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>),<span class="at">seasonal=</span><span class="fu">c</span>(P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>))</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>            ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>,P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>            i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print(i)</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(temp)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"P"</span>,<span class="st">"D"</span>,<span class="st">"Q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>  temp</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="do">##q=1,3 Q=0 p=1,2 P=0 d=0</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>output<span class="ot">=</span><span class="fu">SARIMA.c</span>(<span class="at">p1=</span><span class="dv">1</span>,<span class="at">p2=</span><span class="dv">3</span>,<span class="at">q1=</span><span class="dv">1</span>,<span class="at">q2=</span><span class="dv">4</span>,<span class="at">P1=</span><span class="dv">1</span>,<span class="at">P2=</span><span class="dv">3</span>,<span class="at">Q1=</span><span class="dv">1</span>,<span class="at">Q2=</span><span class="dv">2</span>,<span class="at">d1=</span><span class="dv">0</span>,<span class="at">d2=</span><span class="dv">0</span>,<span class="at">data=</span>res.fit)</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q P D Q      AIC      BIC     AICc
1  0 0 0 0 0 0 564.0890 567.9527 564.3390
2  0 0 0 0 0 1 564.0890 567.9527 564.3390
3  0 0 0 1 0 0 564.0890 567.9527 564.3390
4  0 0 0 1 0 1 564.0890 567.9527 564.3390
5  0 0 0 2 0 0 564.0890 567.9527 564.3390
6  0 0 0 2 0 1 564.0890 567.9527 564.3390
7  0 0 1 0 0 0 536.4054 542.2008 536.9160
8  0 0 1 0 0 1 536.4054 542.2008 536.9160
9  0 0 1 1 0 0 536.4054 542.2008 536.9160
10 0 0 1 1 0 1 536.4054 542.2008 536.9160
11 0 0 1 2 0 0 536.4054 542.2008 536.9160
12 0 0 1 2 0 1 536.4054 542.2008 536.9160
13 0 0 2 0 0 0 529.5765 537.3038 530.4461
14 0 0 2 0 0 1 529.5765 537.3038 530.4461
15 0 0 2 1 0 0 529.5765 537.3038 530.4461
16 0 0 2 1 0 1 529.5765 537.3038 530.4461
17 0 0 2 2 0 0 529.5765 537.3038 530.4461
18 0 0 3 0 0 0 525.4438 535.1029 526.7771
19 0 0 3 0 0 1 525.4438 535.1029 526.7771
20 0 0 3 1 0 0 525.4438 535.1029 526.7771
21 1 0 0 0 0 0 535.4053 541.2008 535.9160
22 1 0 0 0 0 1 535.4053 541.2008 535.9160
23 1 0 0 1 0 0 535.4053 541.2008 535.9160
24 1 0 0 1 0 1 535.4053 541.2008 535.9160
25 1 0 0 2 0 0 535.4053 541.2008 535.9160
26 1 0 0 2 0 1 535.4053 541.2008 535.9160
27 1 0 1 0 0 0 528.7138 536.4411 529.5834
28 1 0 1 0 0 1 528.7138 536.4411 529.5834
29 1 0 1 1 0 0 528.7138 536.4411 529.5834
30 1 0 1 1 0 1 528.7138 536.4411 529.5834
31 1 0 1 2 0 0 528.7138 536.4411 529.5834
32 1 0 2 0 0 0 525.8292 535.4883 527.1625
33 1 0 2 0 0 1 525.8292 535.4883 527.1625
34 1 0 2 1 0 0 525.8292 535.4883 527.1625
35 1 0 3 0 0 0 527.4145 539.0055 529.3236
36 2 0 0 0 0 0 525.9075 533.6348 526.7771
37 2 0 0 0 0 1 525.9075 533.6348 526.7771
38 2 0 0 1 0 0 525.9075 533.6348 526.7771
39 2 0 0 1 0 1 525.9075 533.6348 526.7771
40 2 0 0 2 0 0 525.9075 533.6348 526.7771
41 2 0 1 0 0 0 527.8172 537.4764 529.1506
42 2 0 1 0 0 1 527.8172 537.4764 529.1506
43 2 0 1 1 0 0 527.8172 537.4764 529.1506
44 2 0 2 0 0 0 527.3804 538.9713 529.2895</code></pre>
</div>
</div>
</section>
<section id="arima200-or-ar2-forecasting" class="level3">
<h3 class="anchored" data-anchor-id="arima200-or-ar2-forecasting">ARIMA(2,0,0) or AR(2) Forecasting</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AIC),] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q P D Q      AIC      BIC     AICc
18 0 0 3 0 0 0 525.4438 535.1029 526.7771</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>BIC),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q P D Q      AIC      BIC     AICc
36 2 0 0 0 0 0 525.9075 533.6348 526.7771</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AICc),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q P D Q      AIC      BIC     AICc
36 2 0 0 0 0 0 525.9075 533.6348 526.7771</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>model_outputar2 <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">sarima</span>(res.fit, <span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/fcast2-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(model_outputar2[<span class="dv">30</span><span class="sc">:</span><span class="dv">62</span>], model_outputar2[<span class="fu">length</span>(model_outputar2)], <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged
$fit

Call:
arima(x = xdata, order = c(p, d, q), seasonal = list(order = c(P, D, Q), period = S), 
    xreg = xmean, include.mean = FALSE, transform.pars = trans, fixed = fixed, 
    optim.control = list(trace = trc, REPORT = 1, reltol = tol))

Coefficients:
         ar1      ar2    xmean
      1.3542  -0.6186  13.0780
s.e.  0.1634   0.1684  22.8472

sigma^2 estimated as 1443:  log likelihood = -258.95,  aic = 525.91

$degrees_of_freedom
[1] 48

$ttable
      Estimate      SE t.value p.value
ar1     1.3542  0.1634  8.2894  0.0000
ar2    -0.6186  0.1684 -3.6727  0.0006
xmean  13.0780 22.8472  0.5724  0.5697

$AIC
[1] 10.31191

$AICc
[1] 10.32192

$BIC
[1] 10.46343</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>arimaModel_1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(res.fit, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>forecast1<span class="ot">=</span><span class="fu">predict</span>(arimaModel_1, <span class="dv">5</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create df with fcast preds and +-1.96 SE for 95% CI Bands</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>farimax_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="dv">2021</span><span class="sc">:</span><span class="dv">2025</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fcst =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> forecast1<span class="sc">$</span>se),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> forecast1<span class="sc">$</span>se)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(forecast1$pred, main = "ARIMA(2,0,0) Forecast For 5 Years", xlab = "Time", ylab = "Values", col = "red")</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>(arimax_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>farimax_df, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>fcst, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Forecast"</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span><span class="st">"Confidence Interval"</span>), <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"ARIMA(2,0,0) Forecasts for Number of Yearly Attacks from 2021 to 2025"</span>,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Number of Terrorist Attacks"</span>,</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="st">""</span>, <span class="at">fill=</span><span class="st">""</span>,</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Data Sources: Global Terrorism Database, Department of Homeland Security, SIPRI Military Expenditure Database, Yahoo Finance"</span>) <span class="sc">+</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span><span class="ot">=</span><span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"95% Confidence Interval"</span><span class="ot">=</span><span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption.position =</span> <span class="st">"plot"</span>, <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/fcast2-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="manual-arimax-modeling-2001-2020-post-911-attacks" class="level2">
<h2 class="anchored" data-anchor-id="manual-arimax-modeling-2001-2020-post-911-attacks">Manual ARIMAX Modeling (2001-2020: Post-9/11 Attacks)</h2>
<p>The ARIMAX model being analyzed in this section is:</p>
<center>
Number of yearly terrorist attacks in the US ~ Number of yearly B-1 visa entrants + Number of yearly B-2 visa entrants + Number of yearly F-1 visa entrants + Yearly US Military Expenditure as Percentage of US GDP + Raytheon Technologies’ Last Yearly Closing Price + Lockheed Martin’s Last Yearly Closing Price
</center>
<p><br>
&nbsp;</p>
<p>Its output is as follows:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(country_txt<span class="sc">==</span><span class="st">"United States"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># drop 33 observations from a total of 3121 observations (if taking for '70)</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd_USA_2[<span class="fu">complete.cases</span>(gtd_USA_2<span class="sc">$</span>Date),]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>gtd_USA_2<span class="sc">$</span>nkill[<span class="fu">is.na</span>(gtd_USA_2<span class="sc">$</span>nkill)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co"># select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(gtd_USA_2, <span class="at">select=</span><span class="fu">c</span>(Date, nkill))</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co"># new dataframe for monthly number of attacks 1970-2020</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_USA_2 <span class="sc">%&gt;%</span> </span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(<span class="fu">year</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise</span>(<span class="at">nkill=</span><span class="fu">sum</span>(nkill),</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>                            <span class="at">num_attacks =</span> <span class="fu">n</span>())</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">1</span>] <span class="ot">=</span><span class="st">"Year"</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">2</span>] <span class="ot">=</span><span class="st">"num_fatal"</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">3</span>] <span class="ot">=</span><span class="st">"num_attacks"</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(gtd_yearly_attacks_deaths<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates (0 attacks for those dates)</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_yearly_attacks_deaths <span class="sc">%&gt;%</span> </span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="co"># impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">28</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">21</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="co"># CLEAN DHS df</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="do">## convert year to date time</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>dhs<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(dhs<span class="sc">$</span>Year, <span class="st">"-12-31"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="do">## subset</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>dhs <span class="ot">&lt;-</span> <span class="fu">subset</span>(dhs, <span class="at">select =</span> <span class="fu">c</span>(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="co"># join with aggregated GTD df </span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>gtd_dhs <span class="ot">&lt;-</span> <span class="fu">merge</span>(gtd_yearly_attacks_deaths, dhs, <span class="at">by =</span> <span class="st">"Year"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)</span></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">4</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">4</span>])</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">5</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">5</span>])</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">6</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">6</span>])</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a><span class="co"># join sipri dataset -&gt; military expenditure as % of GDP</span></span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> sipri_gdp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">'United States of America'</span>)</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">melt</span>(milexp.gdp, <span class="at">id.vars =</span> <span class="st">'Country'</span>, <span class="at">variable.name =</span> <span class="st">'Year'</span>, <span class="at">value.name =</span> <span class="st">'GDP'</span>) </span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(milexp.gdp[<span class="dv">22</span><span class="sc">:</span><span class="dv">72</span>, <span class="dv">3</span>])</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs, milexp.gdp) </span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,2] &lt;- 10 # subtracting 3004 number of casualties (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,3] &lt;- 43 # subtracting 4 attacks (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting Raytheon Tech Stock Price (only one active since 70's)</span></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.warning4.0"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.yahoo.warning"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"RTX"</span>)</span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tickers){</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(i,</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"1970-01-01"</span>,</span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2021-12-31"</span>)}</span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(RTX<span class="sc">$</span>RTX.Adjusted)</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rtx,<span class="fu">rownames</span>(rtx))</span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rtx) <span class="ot">&lt;-</span> <span class="fu">append</span>(tickers,<span class="st">'Dates'</span>)</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a>rtx<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(rtx<span class="sc">$</span>Dates,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx <span class="sc">%&gt;%</span> </span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">format</span>(date, <span class="st">"%m-%d"</span>) <span class="sc">==</span> <span class="st">"12-31"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">Year=</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">RTX =</span> <span class="fu">last</span>(RTX))</span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(rtx_yearly<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates </span></span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx_yearly <span class="sc">%&gt;%</span> </span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>RTX <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(rtx_yearly<span class="sc">$</span>RTX)</span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a><span class="co"># join </span></span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs_sipri, rtx_yearly<span class="sc">$</span>RTX) </span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a><span class="co"># LMT </span></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"LMT"</span>)</span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tickers){</span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(i,</span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"2001-09-11"</span>,</span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2021-12-31"</span>)}</span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a>lmt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(LMT<span class="sc">$</span>LMT.Adjusted)</span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a>lmt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(lmt,<span class="fu">rownames</span>(lmt))</span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lmt) <span class="ot">&lt;-</span> <span class="fu">append</span>(tickers,<span class="st">'Dates'</span>)</span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a>lmt<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(lmt<span class="sc">$</span>Dates,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a>lmt_yearly <span class="ot">&lt;-</span> lmt <span class="sc">%&gt;%</span> </span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">format</span>(date, <span class="st">"%m-%d"</span>) <span class="sc">==</span> <span class="st">"12-31"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">Year=</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">LMT =</span> <span class="fu">last</span>(LMT))</span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a>lmt_yearly<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(lmt_yearly<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates </span></span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a>lmt_yearly <span class="ot">&lt;-</span> lmt_yearly <span class="sc">%&gt;%</span> </span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a>lmt_yearly<span class="sc">$</span>LMT <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(lmt_yearly<span class="sc">$</span>LMT)</span>
<span id="cb48-119"><a href="#cb48-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-120"><a href="#cb48-120" aria-hidden="true" tabindex="-1"></a><span class="co"># filter gtd_hds_sipri_rtx</span></span>
<span id="cb48-121"><a href="#cb48-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-122"><a href="#cb48-122" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx <span class="ot">&lt;-</span> gtd_dhs_sipri_rtx <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">32</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb48-123"><a href="#cb48-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-124"><a href="#cb48-124" aria-hidden="true" tabindex="-1"></a><span class="co"># final join to create final arimax dataset</span></span>
<span id="cb48-125"><a href="#cb48-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-126"><a href="#cb48-126" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx_lmt <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs_sipri_rtx, lmt_yearly<span class="sc">$</span>LMT) </span>
<span id="cb48-127"><a href="#cb48-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-128"><a href="#cb48-128" aria-hidden="true" tabindex="-1"></a><span class="co"># rename cols</span></span>
<span id="cb48-129"><a href="#cb48-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-130"><a href="#cb48-130" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_dhs_sipri_rtx_lmt)[<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">9</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Pleasure"</span>, <span class="st">"Business"</span>, <span class="st">"RTX"</span>, <span class="st">"LMT"</span>)</span>
<span id="cb48-131"><a href="#cb48-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-132"><a href="#cb48-132" aria-hidden="true" tabindex="-1"></a><span class="co"># convert df to matrix</span></span>
<span id="cb48-133"><a href="#cb48-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-134"><a href="#cb48-134" aria-hidden="true" tabindex="-1"></a>ts_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(gtd_dhs_sipri_rtx_lmt[, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>])</span>
<span id="cb48-135"><a href="#cb48-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-136"><a href="#cb48-136" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the matrix to a time series object with a yearly frequency </span></span>
<span id="cb48-137"><a href="#cb48-137" aria-hidden="true" tabindex="-1"></a>var_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(ts_matrix, <span class="at">frequency =</span> <span class="dv">1</span>,</span>
<span id="cb48-138"><a href="#cb48-138" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="dv">2001</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="regression-summary-and-fitting-arima-to-residuals-1" class="level3">
<h3 class="anchored" data-anchor-id="regression-summary-and-fitting-arima-to-residuals-1">Regression Summary and Fitting ARIMA to Residuals</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fit.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(num_attacks <span class="sc">~</span> . <span class="sc">-</span> num_fatal, <span class="at">data =</span> var_ts)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = num_attacks ~ . - num_fatal, data = var_ts)

Residuals:
    Min      1Q  Median      3Q     Max 
-17.810  -5.474   1.472   4.598  12.926 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.076e+02  2.997e+01   3.591  0.00329 ** 
Pleasure     1.516e-07  1.311e-06   0.116  0.90970    
Business    -8.943e-06  7.019e-06  -1.274  0.22496    
Students     2.584e-05  1.892e-05   1.366  0.19506    
milexp.gdp  -1.339e+03  6.769e+02  -1.978  0.06955 .  
RTX         -1.423e+00  5.071e-01  -2.807  0.01482 *  
LMT          4.516e-01  7.941e-02   5.687 7.46e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.824 on 13 degrees of freedom
Multiple R-squared:  0.9305,    Adjusted R-squared:  0.8984 
F-statistic:    29 on 6 and 13 DF,  p-value: 8.375e-07</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>res.fit<span class="ot">&lt;-</span><span class="fu">ts</span>(<span class="fu">residuals</span>(fit.reg),<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-01"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="do">############## Then look at the residuals ############</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>res.fit <span class="sc">%&gt;%</span> <span class="fu">ggtsdisplay</span>() <span class="co"># no need to difference</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/regres-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#q=1,3 Q=1 , p=1,2, P=1,2</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">#write a funtion</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>SARIMA.c<span class="ot">=</span><span class="cf">function</span>(p1,p2,q1,q2,P1,P2,Q1,Q2,d1,d2,data){</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  d<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  D<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  s<span class="ot">=</span><span class="dv">12</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">9</span><span class="sc">*</span><span class="dv">44</span>),<span class="at">nrow=</span><span class="dv">44</span>)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> p1<span class="sc">:</span>p2)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(q <span class="cf">in</span> q1<span class="sc">:</span>q2)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(P <span class="cf">in</span> P1<span class="sc">:</span>P2)</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(Q <span class="cf">in</span> Q1<span class="sc">:</span>Q2)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(d <span class="cf">in</span> d1<span class="sc">:</span>d2)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(p<span class="sc">+</span>d<span class="sc">+</span>q<span class="sc">+</span>P<span class="sc">+</span>D<span class="sc">+</span>Q<span class="sc">&lt;=</span><span class="dv">8</span>)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>            model<span class="ot">&lt;-</span> <span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>),<span class="at">seasonal=</span><span class="fu">c</span>(P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>))</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>            ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>,P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>            i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print(i)</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(temp)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"P"</span>,<span class="st">"D"</span>,<span class="st">"Q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>  temp</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="do">##q=1,2 Q=0 , p=1,2 P=0 d=0</span></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>output<span class="ot">=</span><span class="fu">SARIMA.c</span>(<span class="at">p1=</span><span class="dv">1</span>,<span class="at">p2=</span><span class="dv">3</span>,<span class="at">q1=</span><span class="dv">1</span>,<span class="at">q2=</span><span class="dv">4</span>,<span class="at">P1=</span><span class="dv">1</span>,<span class="at">P2=</span><span class="dv">3</span>,<span class="at">Q1=</span><span class="dv">1</span>,<span class="at">Q2=</span><span class="dv">2</span>,<span class="at">d1=</span><span class="dv">0</span>,<span class="at">d2=</span><span class="dv">0</span>,<span class="at">data=</span>res.fit)</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q P D Q      AIC      BIC     AICc
1  0 0 0 0 0 0 139.2404 141.2318 139.9463
2  0 0 0 0 0 1 139.2404 141.2318 139.9463
3  0 0 0 1 0 0 139.2404 141.2318 139.9463
4  0 0 0 1 0 1 139.2404 141.2318 139.9463
5  0 0 0 2 0 0 139.2404 141.2318 139.9463
6  0 0 0 2 0 1 139.2404 141.2318 139.9463
7  0 0 1 0 0 0 134.8791 137.8663 136.3791
8  0 0 1 0 0 1 134.8791 137.8663 136.3791
9  0 0 1 1 0 0 134.8791 137.8663 136.3791
10 0 0 1 1 0 1 134.8791 137.8663 136.3791
11 0 0 1 2 0 0 134.8791 137.8663 136.3791
12 0 0 1 2 0 1 134.8791 137.8663 136.3791
13 0 0 2 0 0 0 135.9981 139.9810 138.6647
14 0 0 2 0 0 1 135.9981 139.9810 138.6647
15 0 0 2 1 0 0 135.9981 139.9810 138.6647
16 0 0 2 1 0 1 135.9981 139.9810 138.6647
17 0 0 2 2 0 0 135.9981 139.9810 138.6647
18 0 0 3 0 0 0 135.7986 140.7772 140.0843
19 0 0 3 0 0 1 135.7986 140.7772 140.0843
20 0 0 3 1 0 0 135.7986 140.7772 140.0843
21 1 0 0 0 0 0 138.0040 140.9912 139.5040
22 1 0 0 0 0 1 138.0040 140.9912 139.5040
23 1 0 0 1 0 0 138.0040 140.9912 139.5040
24 1 0 0 1 0 1 138.0040 140.9912 139.5040
25 1 0 0 2 0 0 138.0040 140.9912 139.5040
26 1 0 0 2 0 1 138.0040 140.9912 139.5040
27 1 0 1 0 0 0 135.7757 139.7587 138.4424
28 1 0 1 0 0 1 135.7757 139.7587 138.4424
29 1 0 1 1 0 0 135.7757 139.7587 138.4424
30 1 0 1 1 0 1 135.7757 139.7587 138.4424
31 1 0 1 2 0 0 135.7757 139.7587 138.4424
32 1 0 2 0 0 0 137.7740 142.7527 142.0597
33 1 0 2 0 0 1 137.7740 142.7527 142.0597
34 1 0 2 1 0 0 137.7740 142.7527 142.0597
35 1 0 3 0 0 0 135.0720 141.0464 141.5336
36 2 0 0 0 0 0 139.9897 143.9726 142.6564
37 2 0 0 0 0 1 139.9897 143.9726 142.6564
38 2 0 0 1 0 0 139.9897 143.9726 142.6564
39 2 0 0 1 0 1 139.9897 143.9726 142.6564
40 2 0 0 2 0 0 139.9897 143.9726 142.6564
41 2 0 1 0 0 0 141.0728 146.0514 145.3585
42 2 0 1 0 0 1 141.0728 146.0514 145.3585
43 2 0 1 1 0 0 141.0728 146.0514 145.3585
44 2 0 2 0 0 0 138.4103 144.3847 144.8719</code></pre>
</div>
</div>
</section>
<section id="arima001-or-ma1-forecasting" class="level3">
<h3 class="anchored" data-anchor-id="arima001-or-ma1-forecasting">ARIMA(0,0,1) or MA(1) Forecasting</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AIC),] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q P D Q      AIC      BIC     AICc
7 0 0 1 0 0 0 134.8791 137.8663 136.3791</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>BIC),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q P D Q      AIC      BIC     AICc
7 0 0 1 0 0 0 134.8791 137.8663 136.3791</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AICc),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q P D Q      AIC      BIC     AICc
7 0 0 1 0 0 0 134.8791 137.8663 136.3791</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>model_outputma2 <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">sarima</span>(res.fit, <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/fcast-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(model_outputma2[<span class="dv">115</span><span class="sc">:</span><span class="dv">143</span>], model_outputma2[<span class="fu">length</span>(model_outputar2)], <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged
$fit

Call:
arima(x = xdata, order = c(p, d, q), seasonal = list(order = c(P, D, Q), period = S), 
    xreg = xmean, include.mean = FALSE, transform.pars = trans, fixed = fixed, 
    optim.control = list(trace = trc, REPORT = 1, reltol = tol))

Coefficients:
          ma1    xmean
      -1.0000  -0.2769
s.e.   0.1542   0.2027

sigma^2 estimated as 31.62:  log likelihood = -64.44,  aic = 134.88

$degrees_of_freedom
[1] 18

$ttable
      Estimate     SE t.value p.value
ma1    -1.0000 0.1542 -6.4859  0.0000
xmean  -0.2769 0.2027 -1.3662  0.1887

$AIC
[1] 6.743957

$AICc
[1] 6.779251

iter  62 value 1.578778</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>arimaModel_1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(res.fit, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>forecast1<span class="ot">=</span><span class="fu">predict</span>(arimaModel_1, <span class="dv">5</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create df with fcast preds and +-1.96 SE for 95% CI Bands</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>farimax_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="dv">2021</span><span class="sc">:</span><span class="dv">2025</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fcst =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred),</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> forecast1<span class="sc">$</span>se),</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> forecast1<span class="sc">$</span>se)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(forecast1$pred, main = "ARIMA(2,0,0) Forecast For 5 Years", xlab = "Time", ylab = "Values", col = "red")</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>(arimax_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>farimax_df, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>fcst, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Forecast"</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span><span class="st">"Confidence Interval"</span>), <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"ARIMA(0,0,1) Forecasts for Number of Yearly Attacks from 2021 to 2025"</span>,</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Number of Terrorist Attacks"</span>,</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="st">""</span>, <span class="at">fill=</span><span class="st">""</span>,</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Data Sources: Global Terrorism Database, Department of Homeland Security, SIPRI Military Expenditure Database, Yahoo Finance"</span>) <span class="sc">+</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span><span class="ot">=</span><span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"95% Confidence Interval"</span><span class="ot">=</span><span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption.position =</span> <span class="st">"plot"</span>, <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ARIMAX-SARIMAX-VAR_files/figure-html/fcast-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="final-results" class="level2">
<h2 class="anchored" data-anchor-id="final-results">Final Results</h2>
<p>The VAR(1) Model trained on Post-9/11 Attacks data is the best performing model in terms of the predicted forecast. It is the only model that took into account the latter observations in its prediction and predicted based on that increasing trend. Our hypothesis that non-immigrants do not significantly affect the number of yearly terrorist attacks in the US is, therefore, proven through the above analyses.</p>
<p>The ARIMAX model trained on all the years performed significantly worse than the ARIMAX model trained on only Post-9/11 Attacks years. In fact, when adding in Lockheed Martin’s stock price in segment 2 of the analysis (Post-9/11 Attacks), <span class="math inline">\(Adjusted.R^2\)</span> increases by more than 60% from segment 1 of the analysis, which includes all years (1970-2020) and not Lockheed Martin’s stock price! Although that is the case, none of the predicted forecasts from the ARIMAX models are not as convincing as the VAR models. Moreover, in the ARIMAX models, all the non-immigration variables collected from DHS are non-significant, apart from Pleasure or B-2 Visa entrants in segment 1 (all years included) of the analysis.</p>
<p>In summary, the years prior to the 9/11 Attacks have little to no effect on the forecasts for 2021 to 2025. To gain more accurate forecasts from the VAR model, it is imperative to focus on data post-9/11. The variables that do imply high correlation (determining causation is out of scope of this analysis) to forecasting the yearly number of terrorist attacks in the US are US Military Expenditure both directly on armed forces and weapons contractors, Lockheed Martin and Raytheon Technologies.</p>
</section>
<section id="section-code" class="level2">
<h2 class="anchored" data-anchor-id="section-code">Section Code</h2>
<p><strong>Code for this section can be found <a href="https://github.com/TegveerG/Time-Series-Project/blob/main/Time%20Series%20Analysis/ARIMAX-SARIMAX-VAR.qmd">here</a></strong></p>


<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-GTD" class="csl-entry" role="doc-biblioentry">
<span>“Codebook Methodology Inclusion Criteria and Variables - UMD.”</span> n.d. <em>Global Terrorism Database</em>. University of Maryland. <a href="https://www.start.umd.edu/gtd/downloads/Codebook.pdf">https://www.start.umd.edu/gtd/downloads/Codebook.pdf</a>.
</div>
<div id="ref-stimson2018counterterroism" class="csl-entry" role="doc-biblioentry">
Counterterrorism Spending, Stimson Study Group on, and Henry L. Stimson Center. 2018. <em>Counterterroism Spending: Protecting America While Promoting Efficiencies and Accountability</em>. Stimson. <a href="https://books.google.com/books?id=GQRCzgEACAAJ">https://books.google.com/books?id=GQRCzgEACAAJ</a>.
</div>
<div id="ref-gaibulloev_sandler_sul_2014" class="csl-entry" role="doc-biblioentry">
Gaibulloev, Khusrav, Todd Sandler, and Donggyu Sul. 2014. <span>“Dynamic Panel Analysis Under Cross-Sectional Dependence.”</span> <em>Political Analysis</em> 22 (2): 258–73. <a href="https://doi.org/10.1093/pan/mpt029">https://doi.org/10.1093/pan/mpt029</a>.
</div>
<div id="ref-hartung_2021" class="csl-entry" role="doc-biblioentry">
Hartung, William D. 2021. <span>“Profits of War: Corporate Beneficiaries of the Post-9/11 Pentagon Spending Surge.”</span> <em>Costs of War</em>. Watson Institute for International; Public Affairs, Brown University. <a href="https://watson.brown.edu/costsofwar/files/cow/imce/papers/2021/Profits%20of%20War_Hartung_Costs%20of%20War_Sept%2013%2C%202021.pdf">https://watson.brown.edu/costsofwar/files/cow/imce/papers/2021/Profits%20of%20War_Hartung_Costs%20of%20War_Sept%2013%2C%202021.pdf</a>.
</div>
<div id="ref-LiandSchaub2004" class="csl-entry" role="doc-biblioentry">
Li, Quan, and Drew Schaub. 2004. <span>“Economic Globalization and Transnational Terrorism: A Pooled Time-Series Analysis.”</span> <em>The Journal of Conflict Resolution</em> 48 (2): 230–58. <a href="http://www.jstor.org/stable/3176252">http://www.jstor.org/stable/3176252</a>.
</div>
<div id="ref-nowrasteh_2019" class="csl-entry" role="doc-biblioentry">
Nowrasteh, Alex. 2019. <span>“Terrorists by Immigration Status and Nationality: A Risk Analysis, 1975–2017.”</span> <em>Cato.org</em>. Cato Institute. <a href="https://www.cato.org/publications/policy-analysis/terrorists-immigration-status-nationality-risk-analysis-1975-2017#foreign-born-terrorism-risk-for-visas-issued-by-category">https://www.cato.org/publications/policy-analysis/terrorists-immigration-status-nationality-risk-analysis-1975-2017#foreign-born-terrorism-risk-for-visas-issued-by-category</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb64" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "ARIMAX/SARIMAX/VAR Models"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> bibliography.bib</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>In the previous ARIMA/SARIMA modeling section, we analyzed a univariate time series of monthly terrorist attacks in the US that occurred from 1970 to 2020. Although the SARIMA model performed better than the ARIMA model, due to the added seasonal Moving Average term, we can gauge our understanding of the monthly terrorist attacks better by including __endogenous variables__! Endogenous variables are those that are determined within the system being studied and are influenced by other variables in the system. These variables are typically modeled as being interdependent and are affected by changes in the values of other variables. In the case of terrorist attacks and casualties suffered from them, potential endogenous variables could include USA military expenditure, non-immigrant admissions data, and the performance of major weapons contracts, including Lockheed Martin, Boeing, and Raytheon Technologies. With the help of a literature review, it can be reinforced thoroughly and plausibly that the aforementioned endogenous variables have, in fact, not only been employed but also found to have effects related to terrorism in prior research.</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## Literature Review {#Lit}</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>The Stimson Study Group's Report on Counterterrorism Spending <span class="co">[</span><span class="ot">@stimson2018counterterroism</span><span class="co">]</span> in the post-9/11 era provides valuable insights into the amount of resources the United States devotes to counterterrorism efforts. The report found that the US government spent over USD2.8 trillion on counterterrorism efforts from 2002 to 2017, which represents a significant portion of the country's overall military budget during that period. Specifically, the report notes that counterterrorism spending accounted for 17% to 23% of the US defense budget each year between 2002 and 2017. Hartung (2021) <span class="co">[</span><span class="ot">@hartung_2021</span><span class="co">]</span> found that the "Global War on Terror", which emerged in the early 2000s as a result of the 9/11 attacks, had a significant impact on the political environment, resulting in a surge in the Pentagon's budget, the largest component of the US military budget. This increased funding was largely directed towards __military contractors, Lockheed Martin, Boeing, General Dynamics, Raytheon Technologies, and Northrop Grumman__, who were enlisted to aid in the efforts. Since Fiscal Year 2001, the total expenditures of the Pentagon for all purposes have surpassed USD14.1 trillion (measured in 2021 dollars). Out of this sum, USD4.4 trillion was used for weapons procurement and research and development (R&amp;D), which mainly benefited corporate contractors. __The rest of the funds were utilized for__ paying and providing benefits to military and civilian personnel and other expenses, necessary for __operating and maintaining the United States military__. Congressional Research Service (CRS) estimates that in FY2020, the spending for contractors grew to \$420 billion - well over half of the total Pentagon budget. Therefore, the biggest financial beneficiaries of the post-9/11 military spending surge have been the aforementioned weapons contractors.</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>Furthermore, several papers have discussed and analyzed the relation between military spending or counterterrorism efforts with transnational terrorism prior to the 9/11 attacks. Li and Schaub (2004) <span class="co">[</span><span class="ot">@LiandSchaub2004</span><span class="co">]</span> employed *GOVCAPABILITY*, a control variable in their Pooled Time-Series Analysis , that comprised military manpower and military expenditures for 112 countries from 1975 to 1997. Because the variable captured state military and economic strength, it represented a proxy that the government could use for combating terrorism. Gaibulloev, K., Sandler, T., &amp; Sul, D. (2014) <span class="co">[</span><span class="ot">@gaibulloev_sandler_sul_2014</span><span class="co">]</span> challenged extant literature about terrorism and its impact on economic growth that suffered from Nickell Bias, a type of bias that arises in statistical models when the independent variable is measured with error, and cross-sectional dependence, a statistical issue that arises in panel data analysis when the individual units (e.g., countries or firms) in the panel are not completely independent of one another. They mentioned that cross-sectional dependence is apt to affect other variables, such as democracy, threat, __military spending__, and financial measures. However, when Nickell bias and cross-sectional dependence are addressed, terrorism has no influence whatsoever on economic growth.</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>Therefore, the perused literature about counterterrorism and military spending underscores the importance of counterterrorism efforts, including funding weapons contractors, in shaping the country's military spending priorities, particularly in the wake of the 9/11 terrorist attacks. By highlighting the amount of resources devoted to counterterrorism, these reports and papers help us understand how the overall US budget and military budget are allocated and the policy decisions that drive those allocations. However, it might also possible that during the VAR model building phase of this section, we find that military spending may not be a significant indicator of the number of casualties stemming from terrorist attacks in the Global Terrorism Database™ (GTD) <span class="co">[</span><span class="ot">@GTD</span><span class="co">]</span>.</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>Secondly, Nowrasteh (2019) <span class="co">[</span><span class="ot">@nowrasteh_2019</span><span class="co">]</span> found, by carefully analyzing the GTD, that the chance of being murdered by a tourist on a B visa, the most common tourist visa, is about 1 in 4.1 million per year. Compared to foreign‐born terrorists, the chance of being murdered by a native‐born terrorist is about 1 in 28 million per year. Moreover, there were 192 foreign‐born terrorists, relative to the 788 native-born terrorists, who planned, attempted, or carried out attacks on U.S. soil from 1975 through 2017. Through a cost-benefit risk analysis, it was also found that the combined human, property, business, and economic costs of terrorism from 1975 through 2017 are estimated at USD216.58 billion. Spread over 43 years, the average annual cost of terrorism is USD5.04 billion, which is about one‐hundredth the minimum estimated yearly benefit of USD553.9 billion from immigration and tourism. __Therefore, foreign‐born terrorism on U.S. soil is a low‐probability event that imposes high costs on its victims, despite relatively small risks.__</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a><span class="fu">## VAR Model Justification</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>Using a VAR model over an ARIMAX model for this research has a multitude of benefits, including:</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Simultaneous modeling of multivariate time series: VAR allows for the simultaneous modeling of multiple endogenous variables, whereas ARIMAX (Autoregressive Integrated Moving Average with Explanatory Variables) can only model one dependent variable at a time. This means that VAR can capture the complex relationships between multiple variables that may be influencing each other.</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Better handling of lags: VAR can handle multiple lags in the data more efficiently than ARIMAX. This is important in the case of studying the impact of terrorist attacks, as the effects of a single attack may persist over a longer period of time and may have delayed impacts on different variables.</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>More robust to missing data: VAR can handle missing data more effectively than ARIMAX, as it does not require the same level of complete data in order to estimate the model parameters. This is particularly relevant in the case of studying the impact of terrorist attacks, as data may be missing or incomplete for certain variables in certain time periods.</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Better captures dynamic relationships: VAR is better suited for capturing the dynamic relationships between variables over time, whereas ARIMAX can only capture the static relationships between variables at a particular point in time. This is important in the case of studying the impact of terrorist attacks, as the relationships between variables may change over time due to factors such as changes in government policies or public opinion.</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>No clear seasonality: Another reason why the VAR model is justified is that there may not be a clear seasonality pattern in the data related to terrorist attacks. This means that traditional time-series models may not be effective in capturing the complex relationships between the variables. The VAR model, on the other hand, does not rely on a specific seasonal pattern and can account for the complex relationships between variables without requiring seasonal adjustments. Moreover, the data that will be analyzed is aggregated yearly from 1970 to 2020, which makes it more difficult to identify and capture seasonal patterns. Yearly data may also be influenced by other factors that are not related to seasonality, such as long-term trends or cyclical patterns, that occur over longer periods of time. This can make it more challenging to distinguish between seasonal effects and other underlying factors that may be driving the data.</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Non-linearity: The relationships between variables in the case of terrorist attacks may not be linear, and traditional linear models may not be able to capture the non-linear effects. The VAR model is capable of modeling non-linear relationships between variables and can account for the complex interactions that may exist between them.</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Methodology</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>Given the discussed Literature Review above, we shall divide our analysis into two segments, with VAR and ARIMAX models applied to both. __The first segment shall forecast the number of terrorist attacks in the US using all the data available, from 1970-2020, and the second segment shall forecast the number of terrorist attacks in the US using only Post-9/11 attacks data, from 2001-2020.__ The reason 2001 is included is to ensure that the analysis captures the full impact of the 9/11 attacks, immediately before and after it, on terrorist activity in the US.</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>Another important differentiator between both VAR models and ARIMAX models is that only the ARIMAX models shall account for all variables collected for the project, including Non-Immigrant Entrants data from the Department of Homeland Security. This is because, as per the literature review, tourism, which is generalized to foreign-born terrorists in this analysis, does not seem to have a significant impact on the likelihood of terrorist attacks on U.S. soil, compared to overall US Military Expenditure. Therefore, this section will help us prove whether the non-immigration variables have a significant effect on the yearly number of terrorist attacks in the US.</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>Following graphs shall help make sense of the roadmap that follows in this analysis:</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a><span class="al">![](multivariate_seg1.png)</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;&lt;em&gt;</span>Multivariate Analysis (VAR and ARIMAX) Segment 1 Flow Chart<span class="kw">&lt;/em&gt;&lt;/center&gt;</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a><span class="al">![](multivariate_seg2.png)</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;&lt;em&gt;</span>Multivariate Analysis (VAR and ARIMAX) Segment 2 Flow Chart<span class="kw">&lt;/em&gt;&lt;/center&gt;</span></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span></span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a><span class="fu">## Building the VAR Model (1970-2020: Pre and Post-9/11 Attacks)</span></span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,include=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flipbookr)</span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(astsa) </span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fma)</span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TSstudio)</span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(padr)</span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vars)</span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load,include=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true" tabindex="-1"></a>gtd <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"../Data/gtd.xlsx"</span>)</span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true" tabindex="-1"></a>sipri_gdp <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"../Data/SIPRI_GDP.xlsx"</span>)</span>
<span id="cb64-102"><a href="#cb64-102" aria-hidden="true" tabindex="-1"></a>sipri_region <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"../Data/SIPRI_Region.xlsx"</span>)</span>
<span id="cb64-103"><a href="#cb64-103" aria-hidden="true" tabindex="-1"></a>dhs <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xls</span>(<span class="st">"../Data/DHS_98_21.xls"</span>)</span>
<span id="cb64-104"><a href="#cb64-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-105"><a href="#cb64-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-106"><a href="#cb64-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r createdate,include=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-107"><a href="#cb64-107" aria-hidden="true" tabindex="-1"></a><span class="co"># if the exact day/month of the event is unknown, this is recorded as “0”</span></span>
<span id="cb64-108"><a href="#cb64-108" aria-hidden="true" tabindex="-1"></a>gtd<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">with</span>(gtd,<span class="fu">paste</span>(iyear,imonth,iday,<span class="at">sep=</span><span class="st">"-"</span>)),<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-109"><a href="#cb64-109" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd$Year &lt;- year(gtd$Date)</span></span>
<span id="cb64-110"><a href="#cb64-110" aria-hidden="true" tabindex="-1"></a><span class="co"># results in 891 NAs total, 33 of which correspond to country_txt==USA</span></span>
<span id="cb64-111"><a href="#cb64-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-112"><a href="#cb64-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-113"><a href="#cb64-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filterUS,include=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-114"><a href="#cb64-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter country_txt==USA</span></span>
<span id="cb64-115"><a href="#cb64-115" aria-hidden="true" tabindex="-1"></a>gtd_USA <span class="ot">&lt;-</span> gtd <span class="sc">%&gt;%</span></span>
<span id="cb64-116"><a href="#cb64-116" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(country_txt<span class="sc">==</span><span class="st">"United States"</span>)</span>
<span id="cb64-117"><a href="#cb64-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-118"><a href="#cb64-118" aria-hidden="true" tabindex="-1"></a><span class="co"># drop 33 observations from a total of 3121 observations (if taking for '70)</span></span>
<span id="cb64-119"><a href="#cb64-119" aria-hidden="true" tabindex="-1"></a>gtd_USA <span class="ot">&lt;-</span> gtd_USA[<span class="fu">complete.cases</span>(gtd_USA<span class="sc">$</span>Date),]</span>
<span id="cb64-120"><a href="#cb64-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-121"><a href="#cb64-121" aria-hidden="true" tabindex="-1"></a><span class="co"># impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0</span></span>
<span id="cb64-122"><a href="#cb64-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-123"><a href="#cb64-123" aria-hidden="true" tabindex="-1"></a>gtd_USA<span class="sc">$</span>nkill[<span class="fu">is.na</span>(gtd_USA<span class="sc">$</span>nkill)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb64-124"><a href="#cb64-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-125"><a href="#cb64-125" aria-hidden="true" tabindex="-1"></a><span class="co"># select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )</span></span>
<span id="cb64-126"><a href="#cb64-126" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA &lt;- gtd_USA %&gt;%</span></span>
<span id="cb64-127"><a href="#cb64-127" aria-hidden="true" tabindex="-1"></a><span class="co">#               dplyr::select(Date, provstate, attacktype1_txt,</span></span>
<span id="cb64-128"><a href="#cb64-128" aria-hidden="true" tabindex="-1"></a><span class="co">#                       targtype1_txt, nkill, weaptype1_txt)</span></span>
<span id="cb64-129"><a href="#cb64-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-130"><a href="#cb64-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-131"><a href="#cb64-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{r monthlyagg,include=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-132"><a href="#cb64-132" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fastDummies)</span>
<span id="cb64-133"><a href="#cb64-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-134"><a href="#cb64-134" aria-hidden="true" tabindex="-1"></a><span class="co"># new dataframe for monthly number of attacks 1970-2020, with categorical variables encoded</span></span>
<span id="cb64-135"><a href="#cb64-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-136"><a href="#cb64-136" aria-hidden="true" tabindex="-1"></a>gtd_USA_monthly <span class="ot">&lt;-</span> gtd_USA <span class="sc">%&gt;%</span></span>
<span id="cb64-137"><a href="#cb64-137" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Date, provstate, attacktype1_txt, targtype1_txt, nkill, weaptype1_txt) <span class="sc">%&gt;%</span></span>
<span id="cb64-138"><a href="#cb64-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dummy_cols</span>() <span class="sc">%&gt;%</span> <span class="co"># convert categorical variables to dummies</span></span>
<span id="cb64-139"><a href="#cb64-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">year</span>(Date), <span class="fu">month</span>(Date)) <span class="sc">%&gt;%</span></span>
<span id="cb64-140"><a href="#cb64-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_attacks =</span> <span class="fu">n</span>(),</span>
<span id="cb64-141"><a href="#cb64-141" aria-hidden="true" tabindex="-1"></a>            <span class="at">num_casualties =</span> <span class="fu">sum</span>(nkill),</span>
<span id="cb64-142"><a href="#cb64-142" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"provstate_"</span>), sum),</span>
<span id="cb64-143"><a href="#cb64-143" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"attacktype1_txt_"</span>), sum),</span>
<span id="cb64-144"><a href="#cb64-144" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"targtype1_txt_"</span>), sum),</span>
<span id="cb64-145"><a href="#cb64-145" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"weaptype1_txt_"</span>), sum))</span>
<span id="cb64-146"><a href="#cb64-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-147"><a href="#cb64-147" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_USA_monthly)[<span class="dv">1</span>] <span class="ot">=</span><span class="st">"Year"</span></span>
<span id="cb64-148"><a href="#cb64-148" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_USA_monthly)[<span class="dv">2</span>] <span class="ot">=</span><span class="st">"Month"</span></span>
<span id="cb64-149"><a href="#cb64-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-150"><a href="#cb64-150" aria-hidden="true" tabindex="-1"></a>gtd_USA_monthly<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(gtd_USA_monthly<span class="sc">$</span>Year, <span class="st">"-"</span>, gtd_USA_monthly<span class="sc">$</span>Month, <span class="st">"-01"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-151"><a href="#cb64-151" aria-hidden="true" tabindex="-1"></a>gtd_USA_monthly <span class="ot">&lt;-</span> <span class="fu">subset</span>(gtd_USA_monthly, <span class="at">select=</span><span class="sc">-</span><span class="fu">c</span>(Year, Month)) <span class="co"># 0 NAs</span></span>
<span id="cb64-152"><a href="#cb64-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-153"><a href="#cb64-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates (NAs introduced) -&gt; adding 90 previously missing months more</span></span>
<span id="cb64-154"><a href="#cb64-154" aria-hidden="true" tabindex="-1"></a>gtd_USA_monthly <span class="ot">&lt;-</span> gtd_USA_monthly <span class="sc">%&gt;%</span></span>
<span id="cb64-155"><a href="#cb64-155" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Date), <span class="fu">max</span>(Date), <span class="at">by=</span><span class="st">"month"</span>))</span>
<span id="cb64-156"><a href="#cb64-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-157"><a href="#cb64-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-158"><a href="#cb64-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r interpolateactual, message=FALSE, warning=FALSE, include=FALSE}</span></span>
<span id="cb64-159"><a href="#cb64-159" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolating all columns except date</span></span>
<span id="cb64-160"><a href="#cb64-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-161"><a href="#cb64-161" aria-hidden="true" tabindex="-1"></a><span class="co"># fill in NAs with 0 for all years except 1993 for all columns but Date</span></span>
<span id="cb64-162"><a href="#cb64-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-163"><a href="#cb64-163" aria-hidden="true" tabindex="-1"></a><span class="do">## create a vector of column names, excluding the first column</span></span>
<span id="cb64-164"><a href="#cb64-164" aria-hidden="true" tabindex="-1"></a><span class="co"># col_names &lt;- names(gtd_USA_monthly)[-1]</span></span>
<span id="cb64-165"><a href="#cb64-165" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-166"><a href="#cb64-166" aria-hidden="true" tabindex="-1"></a><span class="co"># # # loop over each column (except date) and replace NAs with 0 for all years except 1993</span></span>
<span id="cb64-167"><a href="#cb64-167" aria-hidden="true" tabindex="-1"></a><span class="co"># for (col_name in col_names) {</span></span>
<span id="cb64-168"><a href="#cb64-168" aria-hidden="true" tabindex="-1"></a><span class="co">#   gtd_USA_monthly[[col_name]] &lt;- ifelse(year(gtd_USA_monthly$Date) != 1993 &amp; is.na(gtd_USA_monthly[[col_name]]), 0, gtd_USA_monthly[[col_name]])</span></span>
<span id="cb64-169"><a href="#cb64-169" aria-hidden="true" tabindex="-1"></a><span class="co">#  }</span></span>
<span id="cb64-170"><a href="#cb64-170" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-171"><a href="#cb64-171" aria-hidden="true" tabindex="-1"></a><span class="co"># # # impute num_attacks</span></span>
<span id="cb64-172"><a href="#cb64-172" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly$num_attacks[277:288] &lt;- c(1, 2, 3, 4, 2, 1, 3, 2, 2, 3, 2, 3)</span></span>
<span id="cb64-173"><a href="#cb64-173" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-174"><a href="#cb64-174" aria-hidden="true" tabindex="-1"></a><span class="co"># # # impute num_casualties</span></span>
<span id="cb64-175"><a href="#cb64-175" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly$num_casualties[277:288] &lt;- c(1, 6, 3, 1, 1, 0, 2, 2, 1, 0, 1, 3)</span></span>
<span id="cb64-176"><a href="#cb64-176" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-177"><a href="#cb64-177" aria-hidden="true" tabindex="-1"></a><span class="co"># # # impute counts for categorical variables</span></span>
<span id="cb64-178"><a href="#cb64-178" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-179"><a href="#cb64-179" aria-hidden="true" tabindex="-1"></a><span class="co"># # # January: on January 25, 1993, Mir Aimal Kasi, a Pakistani citizen, conducted an armed assault near the entrance of CIA HQs in Virginia</span></span>
<span id="cb64-180"><a href="#cb64-180" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[277, 4:57] &lt;- list(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0)</span></span>
<span id="cb64-181"><a href="#cb64-181" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[277, 58:66] &lt;- list(1, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-182"><a href="#cb64-182" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[277, 67:88] &lt;- list(0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-183"><a href="#cb64-183" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[277, 89:100] &lt;- list(0, 0, 0, 0, 1, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-184"><a href="#cb64-184" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-185"><a href="#cb64-185" aria-hidden="true" tabindex="-1"></a><span class="co"># # # February: The bombing of the New York City World Trade Center on feb 26, 1993, by Ramzi Yousef and his conspirators killed six people</span></span>
<span id="cb64-186"><a href="#cb64-186" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[278, 4:57] &lt;- list(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-187"><a href="#cb64-187" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[278, 58:66] &lt;- list(1, 0, 1, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-188"><a href="#cb64-188" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[278, 67:88] &lt;- list(0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-189"><a href="#cb64-189" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[278, 89:100] &lt;- list(0, 0, 1, 0, 1, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-190"><a href="#cb64-190" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-191"><a href="#cb64-191" aria-hidden="true" tabindex="-1"></a><span class="co"># # # March - Dec random imputation based on total attacks monthly</span></span>
<span id="cb64-192"><a href="#cb64-192" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-193"><a href="#cb64-193" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[279, 4:57] &lt;- list(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-194"><a href="#cb64-194" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[279, 58:66] &lt;- list(1, 0, 1, 0, 0, 1, 0, 0, 0)</span></span>
<span id="cb64-195"><a href="#cb64-195" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[279, 67:88] &lt;- list(0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-196"><a href="#cb64-196" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[279, 89:100] &lt;- list(0, 0, 1, 0, 1, 0, 1, 0, 0,0,0,0)</span></span>
<span id="cb64-197"><a href="#cb64-197" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-198"><a href="#cb64-198" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[280, 4:57] &lt;- list(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-199"><a href="#cb64-199" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[280, 58:66] &lt;- list(2, 0, 1, 0, 0, 1, 0, 0, 0)</span></span>
<span id="cb64-200"><a href="#cb64-200" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[280, 67:88] &lt;- list(0, 0, 2, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-201"><a href="#cb64-201" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[280, 89:100] &lt;- list(0, 0, 2, 0, 1, 0, 1, 0, 0,0,0,0)</span></span>
<span id="cb64-202"><a href="#cb64-202" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-203"><a href="#cb64-203" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[281, 4:57] &lt;- list(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-204"><a href="#cb64-204" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[281, 58:66] &lt;- list(1, 0, 1, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-205"><a href="#cb64-205" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[281, 67:88] &lt;- list(0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-206"><a href="#cb64-206" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[281, 89:100] &lt;- list(0, 0, 1, 0, 1, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-207"><a href="#cb64-207" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-208"><a href="#cb64-208" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[282, 4:57] &lt;- list(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0)</span></span>
<span id="cb64-209"><a href="#cb64-209" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[282, 58:66] &lt;- list(1, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-210"><a href="#cb64-210" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[282, 67:88] &lt;- list(0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-211"><a href="#cb64-211" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[282, 89:100] &lt;- list(0, 0, 0, 0, 1, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-212"><a href="#cb64-212" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-213"><a href="#cb64-213" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[283, 4:57] &lt;- list(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-214"><a href="#cb64-214" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[283, 58:66] &lt;- list(1, 0, 1, 0, 0, 1, 0, 0, 0)</span></span>
<span id="cb64-215"><a href="#cb64-215" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[283, 67:88] &lt;- list(0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-216"><a href="#cb64-216" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[283, 89:100] &lt;- list(0, 0, 1, 0, 1, 0, 1, 0, 0,0,0,0)</span></span>
<span id="cb64-217"><a href="#cb64-217" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-218"><a href="#cb64-218" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[284, 4:57] &lt;- list(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-219"><a href="#cb64-219" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[284, 58:66] &lt;- list(1, 0, 1, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-220"><a href="#cb64-220" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[284, 67:88] &lt;- list(0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-221"><a href="#cb64-221" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[284, 89:100] &lt;- list(0, 0, 1, 0, 1, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-222"><a href="#cb64-222" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-223"><a href="#cb64-223" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[285, 4:57] &lt;- list(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-224"><a href="#cb64-224" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[285, 58:66] &lt;- list(1, 0, 1, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-225"><a href="#cb64-225" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[285, 67:88] &lt;- list(0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-226"><a href="#cb64-226" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[285, 89:100] &lt;- list(0, 0, 1, 0, 1, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-227"><a href="#cb64-227" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-228"><a href="#cb64-228" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[286, 4:57] &lt;- list(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-229"><a href="#cb64-229" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[286, 58:66] &lt;- list(1, 0, 1, 0, 0, 1, 0, 0, 0)</span></span>
<span id="cb64-230"><a href="#cb64-230" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[286, 67:88] &lt;- list(0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-231"><a href="#cb64-231" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[286, 89:100] &lt;- list(0, 0, 1, 0, 1, 0, 1, 0, 0,0,0,0)</span></span>
<span id="cb64-232"><a href="#cb64-232" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-233"><a href="#cb64-233" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[287, 4:57] &lt;- list(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-234"><a href="#cb64-234" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[287, 58:66] &lt;- list(1, 0, 1, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-235"><a href="#cb64-235" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[287, 67:88] &lt;- list(0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-236"><a href="#cb64-236" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[287, 89:100] &lt;- list(0, 0, 1, 0, 1, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-237"><a href="#cb64-237" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb64-238"><a href="#cb64-238" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[288, 4:57] &lt;- list(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)</span></span>
<span id="cb64-239"><a href="#cb64-239" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[288, 58:66] &lt;- list(1, 0, 1, 0, 0, 1, 0, 0, 0)</span></span>
<span id="cb64-240"><a href="#cb64-240" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[288, 67:88] &lt;- list(0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0,0,0)</span></span>
<span id="cb64-241"><a href="#cb64-241" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly[288, 89:100] &lt;- list(0, 0, 1, 0, 1, 0, 1, 0, 0,0,0,0)</span></span>
<span id="cb64-242"><a href="#cb64-242" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-243"><a href="#cb64-243" aria-hidden="true" tabindex="-1"></a><span class="co"># # # convert all variables to numeric except date</span></span>
<span id="cb64-244"><a href="#cb64-244" aria-hidden="true" tabindex="-1"></a><span class="co">#  gtd_USA_monthly[,2:100] &lt;- lapply(gtd_USA_monthly[,2:100], as.numeric)</span></span>
<span id="cb64-245"><a href="#cb64-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-246"><a href="#cb64-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-247"><a href="#cb64-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r autoarimaarimax, message=FALSE, warning=FALSE, include=FALSE}</span></span>
<span id="cb64-248"><a href="#cb64-248" aria-hidden="true" tabindex="-1"></a><span class="co"># shift casualties column before attacks due to xreg</span></span>
<span id="cb64-249"><a href="#cb64-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-250"><a href="#cb64-250" aria-hidden="true" tabindex="-1"></a><span class="co">#select desired column order (date column first, then casualties, then attacks)</span></span>
<span id="cb64-251"><a href="#cb64-251" aria-hidden="true" tabindex="-1"></a><span class="co"># new_order &lt;- c(1, 3, 2, 4:100)</span></span>
<span id="cb64-252"><a href="#cb64-252" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-253"><a href="#cb64-253" aria-hidden="true" tabindex="-1"></a><span class="co"># # reorder columns</span></span>
<span id="cb64-254"><a href="#cb64-254" aria-hidden="true" tabindex="-1"></a><span class="co"># gtd_USA_monthly &lt;- gtd_USA_monthly[, new_order]# create a matrix from the three time series columns</span></span>
<span id="cb64-255"><a href="#cb64-255" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-256"><a href="#cb64-256" aria-hidden="true" tabindex="-1"></a><span class="co"># # convert to matrix</span></span>
<span id="cb64-257"><a href="#cb64-257" aria-hidden="true" tabindex="-1"></a><span class="co"># ts_matrix &lt;- as.matrix(gtd_USA_monthly[, 2:100])</span></span>
<span id="cb64-258"><a href="#cb64-258" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-259"><a href="#cb64-259" aria-hidden="true" tabindex="-1"></a><span class="co"># # convert the matrix to a time series object with a monthly frequency of 12</span></span>
<span id="cb64-260"><a href="#cb64-260" aria-hidden="true" tabindex="-1"></a><span class="co"># arimax_ts &lt;- ts(ts_matrix, frequency = 12,</span></span>
<span id="cb64-261"><a href="#cb64-261" aria-hidden="true" tabindex="-1"></a><span class="co">#                  start = c(year(gtd_USA_monthly$Date[1]), month(gtd_USA_monthly$Date[1])))</span></span>
<span id="cb64-262"><a href="#cb64-262" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-263"><a href="#cb64-263" aria-hidden="true" tabindex="-1"></a><span class="co"># # ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories</span></span>
<span id="cb64-264"><a href="#cb64-264" aria-hidden="true" tabindex="-1"></a><span class="co"># (fit.state &lt;- auto.arima(arimax_ts[,1],</span></span>
<span id="cb64-265"><a href="#cb64-265" aria-hidden="true" tabindex="-1"></a><span class="co">#   xreg=arimax_ts[,2:55]))</span></span>
<span id="cb64-266"><a href="#cb64-266" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-267"><a href="#cb64-267" aria-hidden="true" tabindex="-1"></a><span class="co"># (fit.cat.ny &lt;- auto.arima(arimax_ts[,1],</span></span>
<span id="cb64-268"><a href="#cb64-268" aria-hidden="true" tabindex="-1"></a><span class="co">#   xreg=arimax_ts[,c(2, 35, 59)]))</span></span>
<span id="cb64-269"><a href="#cb64-269" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-270"><a href="#cb64-270" aria-hidden="true" tabindex="-1"></a><span class="co"># (fit.cat.ca &lt;- auto.arima(arimax_ts[,1],</span></span>
<span id="cb64-271"><a href="#cb64-271" aria-hidden="true" tabindex="-1"></a><span class="co">#   xreg=arimax_ts[,c(2, 8, 56:99)]))</span></span>
<span id="cb64-272"><a href="#cb64-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-273"><a href="#cb64-273" aria-hidden="true" tabindex="-1"></a><span class="co"># ts_matrix &lt;- as.matrix(gtd_dhs_sipri[, 2:7])</span></span>
<span id="cb64-274"><a href="#cb64-274" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-275"><a href="#cb64-275" aria-hidden="true" tabindex="-1"></a><span class="co"># # convert the matrix to a time series object with a yearly frequency </span></span>
<span id="cb64-276"><a href="#cb64-276" aria-hidden="true" tabindex="-1"></a><span class="co"># arimax_ts &lt;- ts(ts_matrix, frequency = 1,</span></span>
<span id="cb64-277"><a href="#cb64-277" aria-hidden="true" tabindex="-1"></a><span class="co">#                  start = 1970)</span></span>
<span id="cb64-278"><a href="#cb64-278" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-279"><a href="#cb64-279" aria-hidden="true" tabindex="-1"></a><span class="co"># # ARIMAX For num_attacks ~ num_casualties + all 54 US states/territories</span></span>
<span id="cb64-280"><a href="#cb64-280" aria-hidden="true" tabindex="-1"></a><span class="co"># (fit &lt;- auto.arima(arimax_ts[,1],</span></span>
<span id="cb64-281"><a href="#cb64-281" aria-hidden="true" tabindex="-1"></a><span class="co">#   xreg=arimax_ts[,2:6]))</span></span>
<span id="cb64-282"><a href="#cb64-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-283"><a href="#cb64-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-284"><a href="#cb64-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cleanvar,include=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-285"><a href="#cb64-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter country_txt==USA</span></span>
<span id="cb64-286"><a href="#cb64-286" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd <span class="sc">%&gt;%</span> </span>
<span id="cb64-287"><a href="#cb64-287" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(country_txt<span class="sc">==</span><span class="st">"United States"</span>)</span>
<span id="cb64-288"><a href="#cb64-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-289"><a href="#cb64-289" aria-hidden="true" tabindex="-1"></a><span class="co"># drop 33 observations from a total of 3121 observations (if taking for '70)</span></span>
<span id="cb64-290"><a href="#cb64-290" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd_USA_2[<span class="fu">complete.cases</span>(gtd_USA_2<span class="sc">$</span>Date),]</span>
<span id="cb64-291"><a href="#cb64-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-292"><a href="#cb64-292" aria-hidden="true" tabindex="-1"></a><span class="co"># impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0</span></span>
<span id="cb64-293"><a href="#cb64-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-294"><a href="#cb64-294" aria-hidden="true" tabindex="-1"></a>gtd_USA_2<span class="sc">$</span>nkill[<span class="fu">is.na</span>(gtd_USA_2<span class="sc">$</span>nkill)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb64-295"><a href="#cb64-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-296"><a href="#cb64-296" aria-hidden="true" tabindex="-1"></a><span class="co"># select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )</span></span>
<span id="cb64-297"><a href="#cb64-297" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(gtd_USA_2, <span class="at">select=</span><span class="fu">c</span>(Date, nkill))</span>
<span id="cb64-298"><a href="#cb64-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-299"><a href="#cb64-299" aria-hidden="true" tabindex="-1"></a><span class="co"># new dataframe for monthly number of attacks 1970-2020</span></span>
<span id="cb64-300"><a href="#cb64-300" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_USA_2 <span class="sc">%&gt;%</span> </span>
<span id="cb64-301"><a href="#cb64-301" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(<span class="fu">year</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-302"><a href="#cb64-302" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise</span>(<span class="at">nkill=</span><span class="fu">sum</span>(nkill),</span>
<span id="cb64-303"><a href="#cb64-303" aria-hidden="true" tabindex="-1"></a>                            <span class="at">num_attacks =</span> <span class="fu">n</span>())</span>
<span id="cb64-304"><a href="#cb64-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-305"><a href="#cb64-305" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">1</span>] <span class="ot">=</span><span class="st">"Year"</span></span>
<span id="cb64-306"><a href="#cb64-306" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">2</span>] <span class="ot">=</span><span class="st">"num_fatal"</span></span>
<span id="cb64-307"><a href="#cb64-307" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">3</span>] <span class="ot">=</span><span class="st">"num_attacks"</span></span>
<span id="cb64-308"><a href="#cb64-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-309"><a href="#cb64-309" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(gtd_yearly_attacks_deaths<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb64-310"><a href="#cb64-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-311"><a href="#cb64-311" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates (0 attacks for those dates)</span></span>
<span id="cb64-312"><a href="#cb64-312" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_yearly_attacks_deaths <span class="sc">%&gt;%</span> </span>
<span id="cb64-313"><a href="#cb64-313" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb64-314"><a href="#cb64-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-315"><a href="#cb64-315" aria-hidden="true" tabindex="-1"></a><span class="co"># impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD</span></span>
<span id="cb64-316"><a href="#cb64-316" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">28</span></span>
<span id="cb64-317"><a href="#cb64-317" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">21</span></span>
<span id="cb64-318"><a href="#cb64-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-319"><a href="#cb64-319" aria-hidden="true" tabindex="-1"></a><span class="co"># CLEAN DHS df</span></span>
<span id="cb64-320"><a href="#cb64-320" aria-hidden="true" tabindex="-1"></a><span class="do">## convert year to date time</span></span>
<span id="cb64-321"><a href="#cb64-321" aria-hidden="true" tabindex="-1"></a>dhs<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(dhs<span class="sc">$</span>Year, <span class="st">"-12-31"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-322"><a href="#cb64-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-323"><a href="#cb64-323" aria-hidden="true" tabindex="-1"></a><span class="do">## subset</span></span>
<span id="cb64-324"><a href="#cb64-324" aria-hidden="true" tabindex="-1"></a>dhs <span class="ot">&lt;-</span> <span class="fu">subset</span>(dhs, <span class="at">select =</span> <span class="fu">c</span>(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))</span>
<span id="cb64-325"><a href="#cb64-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-326"><a href="#cb64-326" aria-hidden="true" tabindex="-1"></a><span class="co"># join with aggregated GTD df </span></span>
<span id="cb64-327"><a href="#cb64-327" aria-hidden="true" tabindex="-1"></a>gtd_dhs <span class="ot">&lt;-</span> <span class="fu">merge</span>(gtd_yearly_attacks_deaths, dhs, <span class="at">by =</span> <span class="st">"Year"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-328"><a href="#cb64-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-329"><a href="#cb64-329" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)</span></span>
<span id="cb64-330"><a href="#cb64-330" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">4</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">4</span>])</span>
<span id="cb64-331"><a href="#cb64-331" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">5</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">5</span>])</span>
<span id="cb64-332"><a href="#cb64-332" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">6</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">6</span>])</span>
<span id="cb64-333"><a href="#cb64-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-334"><a href="#cb64-334" aria-hidden="true" tabindex="-1"></a><span class="co"># join sipri dataset -&gt; military expenditure as % of GDP</span></span>
<span id="cb64-335"><a href="#cb64-335" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> sipri_gdp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">'United States of America'</span>)</span>
<span id="cb64-336"><a href="#cb64-336" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">melt</span>(milexp.gdp, <span class="at">id.vars =</span> <span class="st">'Country'</span>, <span class="at">variable.name =</span> <span class="st">'Year'</span>, <span class="at">value.name =</span> <span class="st">'GDP'</span>) </span>
<span id="cb64-337"><a href="#cb64-337" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(milexp.gdp[<span class="dv">22</span><span class="sc">:</span><span class="dv">72</span>, <span class="dv">3</span>])</span>
<span id="cb64-338"><a href="#cb64-338" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs, milexp.gdp) </span>
<span id="cb64-339"><a href="#cb64-339" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,2] &lt;- 10 # subtracting 3004 number of casualties (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb64-340"><a href="#cb64-340" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,3] &lt;- 43 # subtracting 4 attacks (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb64-341"><a href="#cb64-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-342"><a href="#cb64-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting Raytheon Tech Stock Price (only one active since 70's)</span></span>
<span id="cb64-343"><a href="#cb64-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-344"><a href="#cb64-344" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.warning4.0"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-345"><a href="#cb64-345" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.yahoo.warning"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-346"><a href="#cb64-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-347"><a href="#cb64-347" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"RTX"</span>)</span>
<span id="cb64-348"><a href="#cb64-348" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tickers){</span>
<span id="cb64-349"><a href="#cb64-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(i,</span>
<span id="cb64-350"><a href="#cb64-350" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"1970-01-01"</span>,</span>
<span id="cb64-351"><a href="#cb64-351" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2021-12-31"</span>)}</span>
<span id="cb64-352"><a href="#cb64-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-353"><a href="#cb64-353" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(RTX<span class="sc">$</span>RTX.Adjusted)</span>
<span id="cb64-354"><a href="#cb64-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-355"><a href="#cb64-355" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rtx,<span class="fu">rownames</span>(rtx))</span>
<span id="cb64-356"><a href="#cb64-356" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rtx) <span class="ot">&lt;-</span> <span class="fu">append</span>(tickers,<span class="st">'Dates'</span>)</span>
<span id="cb64-357"><a href="#cb64-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-358"><a href="#cb64-358" aria-hidden="true" tabindex="-1"></a>rtx<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(rtx<span class="sc">$</span>Dates,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-359"><a href="#cb64-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-360"><a href="#cb64-360" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx <span class="sc">%&gt;%</span> </span>
<span id="cb64-361"><a href="#cb64-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">format</span>(date, <span class="st">"%m-%d"</span>) <span class="sc">==</span> <span class="st">"12-31"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-362"><a href="#cb64-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">Year=</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-363"><a href="#cb64-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">RTX =</span> <span class="fu">last</span>(RTX))</span>
<span id="cb64-364"><a href="#cb64-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-365"><a href="#cb64-365" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(rtx_yearly<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb64-366"><a href="#cb64-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-367"><a href="#cb64-367" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates </span></span>
<span id="cb64-368"><a href="#cb64-368" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx_yearly <span class="sc">%&gt;%</span> </span>
<span id="cb64-369"><a href="#cb64-369" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb64-370"><a href="#cb64-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-371"><a href="#cb64-371" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>RTX <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(rtx_yearly<span class="sc">$</span>RTX)</span>
<span id="cb64-372"><a href="#cb64-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-373"><a href="#cb64-373" aria-hidden="true" tabindex="-1"></a><span class="co"># final join to create final VAR dataset</span></span>
<span id="cb64-374"><a href="#cb64-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-375"><a href="#cb64-375" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs_sipri, rtx_yearly<span class="sc">$</span>RTX) </span>
<span id="cb64-376"><a href="#cb64-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-377"><a href="#cb64-377" aria-hidden="true" tabindex="-1"></a><span class="co"># rename cols</span></span>
<span id="cb64-378"><a href="#cb64-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-379"><a href="#cb64-379" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_dhs_sipri_rtx)[<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Pleasure"</span>, <span class="st">"Business"</span>, <span class="st">"RTX"</span>)</span>
<span id="cb64-380"><a href="#cb64-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-381"><a href="#cb64-381" aria-hidden="true" tabindex="-1"></a><span class="co"># convert df to matrix</span></span>
<span id="cb64-382"><a href="#cb64-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-383"><a href="#cb64-383" aria-hidden="true" tabindex="-1"></a>ts_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(gtd_dhs_sipri_rtx[, <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb64-384"><a href="#cb64-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-385"><a href="#cb64-385" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the matrix to a time series object with a yearly frequency </span></span>
<span id="cb64-386"><a href="#cb64-386" aria-hidden="true" tabindex="-1"></a>var_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(ts_matrix, <span class="at">frequency =</span> <span class="dv">1</span>,</span>
<span id="cb64-387"><a href="#cb64-387" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="dv">1970</span>)</span>
<span id="cb64-388"><a href="#cb64-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-389"><a href="#cb64-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-390"><a href="#cb64-390" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time Series Plots</span></span>
<span id="cb64-391"><a href="#cb64-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-392"><a href="#cb64-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tsplots, message=FALSE, warning=FALSE, fig.height=7}</span></span>
<span id="cb64-393"><a href="#cb64-393" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(var_ts , <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb64-394"><a href="#cb64-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-395"><a href="#cb64-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-396"><a href="#cb64-396" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pair Plots</span></span>
<span id="cb64-397"><a href="#cb64-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-398"><a href="#cb64-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pairs, message=FALSE, warning=FALSE, fig.height=10}</span></span>
<span id="cb64-399"><a href="#cb64-399" aria-hidden="true" tabindex="-1"></a><span class="co"># create scatterplot matrix using plotly</span></span>
<span id="cb64-400"><a href="#cb64-400" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb64-401"><a href="#cb64-401" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(var_ts),</span>
<span id="cb64-402"><a href="#cb64-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"splom"</span>,</span>
<span id="cb64-403"><a href="#cb64-403" aria-hidden="true" tabindex="-1"></a>  <span class="at">diagonal =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">FALSE</span>),</span>
<span id="cb64-404"><a href="#cb64-404" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimensions =</span> <span class="fu">list</span>(</span>
<span id="cb64-405"><a href="#cb64-405" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"# Attacks"</span>, <span class="at">values =</span> <span class="sc">~</span>num_attacks),</span>
<span id="cb64-406"><a href="#cb64-406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"B-2 Visa"</span>, <span class="at">values =</span> <span class="sc">~</span>Pleasure),</span>
<span id="cb64-407"><a href="#cb64-407" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"B-1 Visa"</span>, <span class="at">values =</span> <span class="sc">~</span>Business),</span>
<span id="cb64-408"><a href="#cb64-408" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"F-1 Visa"</span>, <span class="at">values =</span> <span class="sc">~</span>Students),</span>
<span id="cb64-409"><a href="#cb64-409" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Military Exp"</span>, <span class="at">values =</span> <span class="sc">~</span>milexp.gdp),</span>
<span id="cb64-410"><a href="#cb64-410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"RTX"</span>, <span class="at">values =</span> <span class="sc">~</span>RTX)</span>
<span id="cb64-411"><a href="#cb64-411" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-412"><a href="#cb64-412" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb64-413"><a href="#cb64-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">hovermode =</span> <span class="st">"x"</span>)</span>
<span id="cb64-414"><a href="#cb64-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-415"><a href="#cb64-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-416"><a href="#cb64-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-417"><a href="#cb64-417" aria-hidden="true" tabindex="-1"></a><span class="co"># customize layout</span></span>
<span id="cb64-418"><a href="#cb64-418" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> </span>
<span id="cb64-419"><a href="#cb64-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb64-420"><a href="#cb64-420" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Scatterplot Matrix of VAR Model Variables (Pre and Post-9/11)"</span>,</span>
<span id="cb64-421"><a href="#cb64-421" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb64-422"><a href="#cb64-422" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb64-423"><a href="#cb64-423" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-424"><a href="#cb64-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-425"><a href="#cb64-425" aria-hidden="true" tabindex="-1"></a><span class="co"># display plot</span></span>
<span id="cb64-426"><a href="#cb64-426" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb64-427"><a href="#cb64-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-428"><a href="#cb64-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-429"><a href="#cb64-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r corr, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-430"><a href="#cb64-430" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri_rtx &lt;- subset(gtd_dhs_sipri_rtx, select=-c(Business, Pleasure, Students))</span></span>
<span id="cb64-431"><a href="#cb64-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-432"><a href="#cb64-432" aria-hidden="true" tabindex="-1"></a><span class="co"># convert df back to matrix</span></span>
<span id="cb64-433"><a href="#cb64-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-434"><a href="#cb64-434" aria-hidden="true" tabindex="-1"></a>ts_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(gtd_dhs_sipri_rtx[, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb64-435"><a href="#cb64-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-436"><a href="#cb64-436" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the matrix to a time series object with a yearly frequency</span></span>
<span id="cb64-437"><a href="#cb64-437" aria-hidden="true" tabindex="-1"></a>var_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(ts_matrix, <span class="at">frequency =</span> <span class="dv">1</span>,</span>
<span id="cb64-438"><a href="#cb64-438" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="dv">1970</span>)</span>
<span id="cb64-439"><a href="#cb64-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-440"><a href="#cb64-440" aria-hidden="true" tabindex="-1"></a><span class="co"># split into train and test sets</span></span>
<span id="cb64-441"><a href="#cb64-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-442"><a href="#cb64-442" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">29830</span>)</span>
<span id="cb64-443"><a href="#cb64-443" aria-hidden="true" tabindex="-1"></a>train_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(var_ts), <span class="fl">0.9</span> <span class="sc">*</span> <span class="fu">nrow</span>(var_ts))</span>
<span id="cb64-444"><a href="#cb64-444" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> var_ts[train_idx, ]</span>
<span id="cb64-445"><a href="#cb64-445" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> var_ts[<span class="sc">-</span>train_idx, ]</span>
<span id="cb64-446"><a href="#cb64-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-447"><a href="#cb64-447" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Lasso regression model with cross-validation</span></span>
<span id="cb64-448"><a href="#cb64-448" aria-hidden="true" tabindex="-1"></a><span class="co"># cv_fit &lt;- cv.glmnet(train[, 2], train[, 1], alpha = 1)</span></span>
<span id="cb64-449"><a href="#cb64-449" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-450"><a href="#cb64-450" aria-hidden="true" tabindex="-1"></a><span class="co"># # Extract selected variables</span></span>
<span id="cb64-451"><a href="#cb64-451" aria-hidden="true" tabindex="-1"></a><span class="co"># cv_fits &lt;- as.data.frame(as.matrix(coef(cv_fit)))</span></span>
<span id="cb64-452"><a href="#cb64-452" aria-hidden="true" tabindex="-1"></a><span class="co"># to_include &lt;- rownames(cv_fits)[cv_fits$s1 != 0]</span></span>
<span id="cb64-453"><a href="#cb64-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-454"><a href="#cb64-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-455"><a href="#cb64-455" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting VAR Model</span></span>
<span id="cb64-456"><a href="#cb64-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-457"><a href="#cb64-457" aria-hidden="true" tabindex="-1"></a>Here we use the <span class="in">`VARselect()`</span> function to find the best <span class="in">`p`</span> to fit <span class="in">`VAR(p)`</span>. We will choose a maximum lag of 10 and check which <span class="in">`p`</span> value returns lowest AIC.</span>
<span id="cb64-458"><a href="#cb64-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-459"><a href="#cb64-459" aria-hidden="true" tabindex="-1"></a><span class="in">```{r varsel, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-460"><a href="#cb64-460" aria-hidden="true" tabindex="-1"></a>(var_result <span class="ot">&lt;-</span> <span class="fu">VARselect</span>(var_ts, <span class="at">lag.max =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"both"</span>))</span>
<span id="cb64-461"><a href="#cb64-461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-462"><a href="#cb64-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-463"><a href="#cb64-463" aria-hidden="true" tabindex="-1"></a>Now, we will fit VAR(1), VAR(2), and VAR(3):</span>
<span id="cb64-464"><a href="#cb64-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-465"><a href="#cb64-465" aria-hidden="true" tabindex="-1"></a>VAR(1) output:</span>
<span id="cb64-466"><a href="#cb64-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-467"><a href="#cb64-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r varsel1, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-468"><a href="#cb64-468" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">"both"</span>))</span>
<span id="cb64-469"><a href="#cb64-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-470"><a href="#cb64-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-471"><a href="#cb64-471" aria-hidden="true" tabindex="-1"></a>VAR(2) output:</span>
<span id="cb64-472"><a href="#cb64-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-473"><a href="#cb64-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r varsel2, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-474"><a href="#cb64-474" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">"both"</span>))</span>
<span id="cb64-475"><a href="#cb64-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-476"><a href="#cb64-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-477"><a href="#cb64-477" aria-hidden="true" tabindex="-1"></a>VAR(3) output:</span>
<span id="cb64-478"><a href="#cb64-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-479"><a href="#cb64-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r varsel3, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-480"><a href="#cb64-480" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">"both"</span>))</span>
<span id="cb64-481"><a href="#cb64-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-482"><a href="#cb64-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-483"><a href="#cb64-483" aria-hidden="true" tabindex="-1"></a><span class="fu">### K-Fold Cross Validation and Model Diagnostics</span></span>
<span id="cb64-484"><a href="#cb64-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-485"><a href="#cb64-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r crossval, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-486"><a href="#cb64-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-487"><a href="#cb64-487" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of folds for cross-validation</span></span>
<span id="cb64-488"><a href="#cb64-488" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb64-489"><a href="#cb64-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-490"><a href="#cb64-490" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the p values to test</span></span>
<span id="cb64-491"><a href="#cb64-491" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb64-492"><a href="#cb64-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-493"><a href="#cb64-493" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into k folds</span></span>
<span id="cb64-494"><a href="#cb64-494" aria-hidden="true" tabindex="-1"></a>cv_folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(var_ts)), <span class="at">breaks =</span> k, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb64-495"><a href="#cb64-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-496"><a href="#cb64-496" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors to store RMSE and AIC values for each p value</span></span>
<span id="cb64-497"><a href="#cb64-497" aria-hidden="true" tabindex="-1"></a>rmse_vec <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(p_values))</span>
<span id="cb64-498"><a href="#cb64-498" aria-hidden="true" tabindex="-1"></a>aic_vec <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(p_values))</span>
<span id="cb64-499"><a href="#cb64-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-500"><a href="#cb64-500" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over p values and perform cross-validation</span></span>
<span id="cb64-501"><a href="#cb64-501" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(p_values)) {</span>
<span id="cb64-502"><a href="#cb64-502" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p_values[i]</span>
<span id="cb64-503"><a href="#cb64-503" aria-hidden="true" tabindex="-1"></a>  rmse_cv <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb64-504"><a href="#cb64-504" aria-hidden="true" tabindex="-1"></a>  aic_cv <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb64-505"><a href="#cb64-505" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb64-506"><a href="#cb64-506" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the data into training and testing sets</span></span>
<span id="cb64-507"><a href="#cb64-507" aria-hidden="true" tabindex="-1"></a>    train <span class="ot">&lt;-</span> var_ts[cv_folds <span class="sc">!=</span> j, ]</span>
<span id="cb64-508"><a href="#cb64-508" aria-hidden="true" tabindex="-1"></a>    test <span class="ot">&lt;-</span> var_ts[cv_folds <span class="sc">==</span> j, ]</span>
<span id="cb64-509"><a href="#cb64-509" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-510"><a href="#cb64-510" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the VAR model with the current p value</span></span>
<span id="cb64-511"><a href="#cb64-511" aria-hidden="true" tabindex="-1"></a>    var_fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(train, <span class="at">p =</span> p)</span>
<span id="cb64-512"><a href="#cb64-512" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-513"><a href="#cb64-513" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make predictions for the testing set</span></span>
<span id="cb64-514"><a href="#cb64-514" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(var_fit, <span class="at">n.ahead =</span> <span class="fu">nrow</span>(test))<span class="sc">$</span>fcst</span>
<span id="cb64-515"><a href="#cb64-515" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-516"><a href="#cb64-516" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate RMSE and AIC for the current fold</span></span>
<span id="cb64-517"><a href="#cb64-517" aria-hidden="true" tabindex="-1"></a>    rmse_cv[j] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((pred<span class="sc">$</span>num_attacks <span class="sc">-</span> test[,<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb64-518"><a href="#cb64-518" aria-hidden="true" tabindex="-1"></a>    aic_cv[j] <span class="ot">&lt;-</span> <span class="fu">AIC</span>(var_fit)</span>
<span id="cb64-519"><a href="#cb64-519" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-520"><a href="#cb64-520" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the mean RMSE and AIC across all folds for the current p value</span></span>
<span id="cb64-521"><a href="#cb64-521" aria-hidden="true" tabindex="-1"></a>  rmse_vec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rmse_cv)</span>
<span id="cb64-522"><a href="#cb64-522" aria-hidden="true" tabindex="-1"></a>  aic_vec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(aic_cv)</span>
<span id="cb64-523"><a href="#cb64-523" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-524"><a href="#cb64-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-525"><a href="#cb64-525" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table of RMSE and AIC values for each p value</span></span>
<span id="cb64-526"><a href="#cb64-526" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(p_values, rmse_vec, aic_vec)</span>
<span id="cb64-527"><a href="#cb64-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-528"><a href="#cb64-528" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results table</span></span>
<span id="cb64-529"><a href="#cb64-529" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(results_table, <span class="at">format =</span> <span class="st">"markdown"</span>, </span>
<span id="cb64-530"><a href="#cb64-530" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"P Values"</span>, <span class="st">"Mean RMSE (5 Folds)"</span>, <span class="st">"Mean AIC (5 Folds)"</span>), <span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb64-531"><a href="#cb64-531" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb64-532"><a href="#cb64-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-533"><a href="#cb64-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-534"><a href="#cb64-534" aria-hidden="true" tabindex="-1"></a>The <span class="in">`VAR(1)`</span> model outputs the lowest Mean RMSE of <span class="in">`r results_table$rmse_vec[1]`</span> attacks from the 5-fold cross validation. However, it has the highest AIC score. Because test set performance is best and it is the simplest model, we shall choose the <span class="in">`VAR(1)`</span> model as the best option.</span>
<span id="cb64-535"><a href="#cb64-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-536"><a href="#cb64-536" aria-hidden="true" tabindex="-1"></a><span class="fu">### Forecasting Chosen Model (p=1)</span></span>
<span id="cb64-537"><a href="#cb64-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-538"><a href="#cb64-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r forc2, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-539"><a href="#cb64-539" aria-hidden="true" tabindex="-1"></a>final_var <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p =</span> <span class="dv">1</span>)</span>
<span id="cb64-540"><a href="#cb64-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-541"><a href="#cb64-541" aria-hidden="true" tabindex="-1"></a>(<span class="at">fit.pr =</span> <span class="fu">predict</span>(final_var, <span class="at">n.ahead =</span> <span class="dv">5</span>, <span class="at">ci =</span> <span class="fl">0.95</span>)) <span class="co"># 5 years ahead </span></span>
<span id="cb64-542"><a href="#cb64-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-543"><a href="#cb64-543" aria-hidden="true" tabindex="-1"></a><span class="fu">fanchart</span>(fit.pr) <span class="co"># plot prediction + error</span></span>
<span id="cb64-544"><a href="#cb64-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-545"><a href="#cb64-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-546"><a href="#cb64-546" aria-hidden="true" tabindex="-1"></a>The above plot showcases the forecasts for each variable present in the <span class="in">`VAR(1)`</span> model, <span class="in">`Number of Yearly Attacks`</span>, <span class="in">`US Military Expenditure as a % of US GDP`</span>, and Closing Price of <span class="in">`Raytheon Technologies Stock`</span>. The predicted forecast, from the years 2021 to 2025, for <span class="in">`Number of Yearly Attacks`</span> is a good sign for the US due to the decreasing and plateauing trend, although the actual observations from 2015 onward suggest an increasing trend. The same forecast trend is discerned for <span class="in">`US Military Expenditure as a % of US GDP`</span>, with <span class="in">`Raytheon Technologies Stock`</span> being the only variable with a predicted increasing trend.</span>
<span id="cb64-547"><a href="#cb64-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-548"><a href="#cb64-548" aria-hidden="true" tabindex="-1"></a>Let us visualize more closely the forecasts for the <span class="in">`Number of Yearly Attacks`</span> from 2021 to 2025, corresponding to the VAR(1) model fitted on all years (1970-2020):</span>
<span id="cb64-549"><a href="#cb64-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-550"><a href="#cb64-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r forcattacks2, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-551"><a href="#cb64-551" aria-hidden="true" tabindex="-1"></a><span class="co"># create df of attack forecasts</span></span>
<span id="cb64-552"><a href="#cb64-552" aria-hidden="true" tabindex="-1"></a>df_fvar_attack <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fit.pr<span class="sc">$</span>fcst<span class="sc">$</span>num_attacks)</span>
<span id="cb64-553"><a href="#cb64-553" aria-hidden="true" tabindex="-1"></a><span class="co"># add year column</span></span>
<span id="cb64-554"><a href="#cb64-554" aria-hidden="true" tabindex="-1"></a>df_fvar_attack<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>)</span>
<span id="cb64-555"><a href="#cb64-555" aria-hidden="true" tabindex="-1"></a>(var_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>df_fvar_attack, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>fcst, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb64-556"><a href="#cb64-556" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Forecast"</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-557"><a href="#cb64-557" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span><span class="st">"Confidence Interval"</span>), <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb64-558"><a href="#cb64-558" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"VAR(1) Forecasts for Number of Yearly Attacks from 2021 to 2025"</span>,</span>
<span id="cb64-559"><a href="#cb64-559" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Number of Terrorist Attacks"</span>,</span>
<span id="cb64-560"><a href="#cb64-560" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="st">""</span>, <span class="at">fill=</span><span class="st">""</span>,</span>
<span id="cb64-561"><a href="#cb64-561" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Data Sources: Global Terrorism Database, SIPRI Military Expenditure Database, Yahoo Finance"</span>) <span class="sc">+</span></span>
<span id="cb64-562"><a href="#cb64-562" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span><span class="ot">=</span><span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb64-563"><a href="#cb64-563" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"95% Confidence Interval"</span><span class="ot">=</span><span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb64-564"><a href="#cb64-564" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb64-565"><a href="#cb64-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption.position =</span> <span class="st">"plot"</span>))</span>
<span id="cb64-566"><a href="#cb64-566" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplotly(var_plot)</span></span>
<span id="cb64-567"><a href="#cb64-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-568"><a href="#cb64-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-569"><a href="#cb64-569" aria-hidden="true" tabindex="-1"></a><span class="fu">## Building the VAR Model (2001-2020: Post-9/11 Attacks)</span></span>
<span id="cb64-570"><a href="#cb64-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-571"><a href="#cb64-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cleanvar2,include=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-572"><a href="#cb64-572" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"LMT"</span>)</span>
<span id="cb64-573"><a href="#cb64-573" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tickers){</span>
<span id="cb64-574"><a href="#cb64-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(i,</span>
<span id="cb64-575"><a href="#cb64-575" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"2001-09-11"</span>,</span>
<span id="cb64-576"><a href="#cb64-576" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2021-12-31"</span>)}</span>
<span id="cb64-577"><a href="#cb64-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-578"><a href="#cb64-578" aria-hidden="true" tabindex="-1"></a>lmt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(LMT<span class="sc">$</span>LMT.Adjusted)</span>
<span id="cb64-579"><a href="#cb64-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-580"><a href="#cb64-580" aria-hidden="true" tabindex="-1"></a>lmt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(lmt,<span class="fu">rownames</span>(lmt))</span>
<span id="cb64-581"><a href="#cb64-581" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lmt) <span class="ot">&lt;-</span> <span class="fu">append</span>(tickers,<span class="st">'Dates'</span>)</span>
<span id="cb64-582"><a href="#cb64-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-583"><a href="#cb64-583" aria-hidden="true" tabindex="-1"></a>lmt<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(lmt<span class="sc">$</span>Dates,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-584"><a href="#cb64-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-585"><a href="#cb64-585" aria-hidden="true" tabindex="-1"></a>lmt_yearly <span class="ot">&lt;-</span> lmt <span class="sc">%&gt;%</span> </span>
<span id="cb64-586"><a href="#cb64-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">format</span>(date, <span class="st">"%m-%d"</span>) <span class="sc">==</span> <span class="st">"12-31"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-587"><a href="#cb64-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">Year=</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-588"><a href="#cb64-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">LMT =</span> <span class="fu">last</span>(LMT))</span>
<span id="cb64-589"><a href="#cb64-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-590"><a href="#cb64-590" aria-hidden="true" tabindex="-1"></a>lmt_yearly<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(lmt_yearly<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb64-591"><a href="#cb64-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-592"><a href="#cb64-592" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates </span></span>
<span id="cb64-593"><a href="#cb64-593" aria-hidden="true" tabindex="-1"></a>lmt_yearly <span class="ot">&lt;-</span> lmt_yearly <span class="sc">%&gt;%</span> </span>
<span id="cb64-594"><a href="#cb64-594" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb64-595"><a href="#cb64-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-596"><a href="#cb64-596" aria-hidden="true" tabindex="-1"></a>lmt_yearly<span class="sc">$</span>LMT <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(lmt_yearly<span class="sc">$</span>LMT)</span>
<span id="cb64-597"><a href="#cb64-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-598"><a href="#cb64-598" aria-hidden="true" tabindex="-1"></a><span class="co"># filter gtd_hds_sipri_rtx</span></span>
<span id="cb64-599"><a href="#cb64-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-600"><a href="#cb64-600" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx <span class="ot">&lt;-</span> gtd_dhs_sipri_rtx <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">32</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb64-601"><a href="#cb64-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-602"><a href="#cb64-602" aria-hidden="true" tabindex="-1"></a><span class="co"># final join to create final VAR dataset</span></span>
<span id="cb64-603"><a href="#cb64-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-604"><a href="#cb64-604" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx_lmt <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs_sipri_rtx, lmt_yearly<span class="sc">$</span>LMT) </span>
<span id="cb64-605"><a href="#cb64-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-606"><a href="#cb64-606" aria-hidden="true" tabindex="-1"></a><span class="co"># rename cols</span></span>
<span id="cb64-607"><a href="#cb64-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-608"><a href="#cb64-608" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_dhs_sipri_rtx_lmt)[<span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"LMT"</span>)</span>
<span id="cb64-609"><a href="#cb64-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-610"><a href="#cb64-610" aria-hidden="true" tabindex="-1"></a>ts_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(gtd_dhs_sipri_rtx_lmt[, <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>)])</span>
<span id="cb64-611"><a href="#cb64-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-612"><a href="#cb64-612" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the matrix to a time series object with a yearly frequency</span></span>
<span id="cb64-613"><a href="#cb64-613" aria-hidden="true" tabindex="-1"></a>var_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(ts_matrix, <span class="at">frequency =</span> <span class="dv">1</span>,</span>
<span id="cb64-614"><a href="#cb64-614" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="dv">2001</span>)</span>
<span id="cb64-615"><a href="#cb64-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-616"><a href="#cb64-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-617"><a href="#cb64-617" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time Series Plots</span></span>
<span id="cb64-618"><a href="#cb64-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-619"><a href="#cb64-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tsplots2, message=FALSE, warning=FALSE, fig.height=7}</span></span>
<span id="cb64-620"><a href="#cb64-620" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(var_ts , <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb64-621"><a href="#cb64-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-622"><a href="#cb64-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-623"><a href="#cb64-623" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pair Plots</span></span>
<span id="cb64-624"><a href="#cb64-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-625"><a href="#cb64-625" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pairs2, message=FALSE, warning=FALSE, fig.height=10}</span></span>
<span id="cb64-626"><a href="#cb64-626" aria-hidden="true" tabindex="-1"></a><span class="co"># create scatterplot matrix using plotly</span></span>
<span id="cb64-627"><a href="#cb64-627" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb64-628"><a href="#cb64-628" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(var_ts), </span>
<span id="cb64-629"><a href="#cb64-629" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"splom"</span>,</span>
<span id="cb64-630"><a href="#cb64-630" aria-hidden="true" tabindex="-1"></a>  <span class="at">diagonal =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">FALSE</span>),</span>
<span id="cb64-631"><a href="#cb64-631" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimensions =</span> <span class="fu">list</span>(</span>
<span id="cb64-632"><a href="#cb64-632" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"# Attacks"</span>, <span class="at">values =</span> <span class="sc">~</span>num_attacks),</span>
<span id="cb64-633"><a href="#cb64-633" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Military Exp"</span>, <span class="at">values =</span> <span class="sc">~</span>milexp.gdp),</span>
<span id="cb64-634"><a href="#cb64-634" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"RTX"</span>, <span class="at">values =</span> <span class="sc">~</span>RTX),</span>
<span id="cb64-635"><a href="#cb64-635" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"LMT"</span>, <span class="at">values =</span> <span class="sc">~</span>LMT)</span>
<span id="cb64-636"><a href="#cb64-636" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-637"><a href="#cb64-637" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb64-638"><a href="#cb64-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">hovermode =</span> <span class="st">"x"</span>)</span>
<span id="cb64-639"><a href="#cb64-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-640"><a href="#cb64-640" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> </span>
<span id="cb64-641"><a href="#cb64-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb64-642"><a href="#cb64-642" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Scatterplot Matrix of VAR Model Variables (Post-9/11)"</span>,</span>
<span id="cb64-643"><a href="#cb64-643" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb64-644"><a href="#cb64-644" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb64-645"><a href="#cb64-645" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-646"><a href="#cb64-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-647"><a href="#cb64-647" aria-hidden="true" tabindex="-1"></a><span class="co"># display plot</span></span>
<span id="cb64-648"><a href="#cb64-648" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb64-649"><a href="#cb64-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-650"><a href="#cb64-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-651"><a href="#cb64-651" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting VAR Model</span></span>
<span id="cb64-652"><a href="#cb64-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-653"><a href="#cb64-653" aria-hidden="true" tabindex="-1"></a>Here we use the <span class="in">`VARselect()`</span> function to find the best <span class="in">`p`</span> to fit <span class="in">`VAR(p)`</span>. We will choose a maximum lag of 10 and check which <span class="in">`p`</span> value returns lowest AIC.</span>
<span id="cb64-654"><a href="#cb64-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-655"><a href="#cb64-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r varp, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-656"><a href="#cb64-656" aria-hidden="true" tabindex="-1"></a>(var_result <span class="ot">&lt;-</span> <span class="fu">VARselect</span>(var_ts, <span class="at">lag.max =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"both"</span>))</span>
<span id="cb64-657"><a href="#cb64-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-658"><a href="#cb64-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-659"><a href="#cb64-659" aria-hidden="true" tabindex="-1"></a>Now, we will fit VAR(1), VAR(2), and VAR(3):</span>
<span id="cb64-660"><a href="#cb64-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-661"><a href="#cb64-661" aria-hidden="true" tabindex="-1"></a>VAR(1) output:</span>
<span id="cb64-662"><a href="#cb64-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-663"><a href="#cb64-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r varp1, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-664"><a href="#cb64-664" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">"both"</span>))</span>
<span id="cb64-665"><a href="#cb64-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-666"><a href="#cb64-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-667"><a href="#cb64-667" aria-hidden="true" tabindex="-1"></a>VAR(2) output:</span>
<span id="cb64-668"><a href="#cb64-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-669"><a href="#cb64-669" aria-hidden="true" tabindex="-1"></a><span class="in">```{r varp2, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-670"><a href="#cb64-670" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p=</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">"both"</span>))</span>
<span id="cb64-671"><a href="#cb64-671" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-672"><a href="#cb64-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-673"><a href="#cb64-673" aria-hidden="true" tabindex="-1"></a>VAR(3) output: <span class="in">`System is computationally singular!`</span></span>
<span id="cb64-674"><a href="#cb64-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-675"><a href="#cb64-675" aria-hidden="true" tabindex="-1"></a><span class="fu">### K-Fold Cross Validation and Model Diagnostics</span></span>
<span id="cb64-676"><a href="#cb64-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-677"><a href="#cb64-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r crossval2, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-678"><a href="#cb64-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-679"><a href="#cb64-679" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of folds for cross-validation</span></span>
<span id="cb64-680"><a href="#cb64-680" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb64-681"><a href="#cb64-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-682"><a href="#cb64-682" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the p values to test</span></span>
<span id="cb64-683"><a href="#cb64-683" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb64-684"><a href="#cb64-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-685"><a href="#cb64-685" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into k folds</span></span>
<span id="cb64-686"><a href="#cb64-686" aria-hidden="true" tabindex="-1"></a>cv_folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(var_ts)), <span class="at">breaks =</span> k, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb64-687"><a href="#cb64-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-688"><a href="#cb64-688" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors to store RMSE and AIC values for each p value</span></span>
<span id="cb64-689"><a href="#cb64-689" aria-hidden="true" tabindex="-1"></a>rmse_vec <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(p_values))</span>
<span id="cb64-690"><a href="#cb64-690" aria-hidden="true" tabindex="-1"></a>aic_vec <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(p_values))</span>
<span id="cb64-691"><a href="#cb64-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-692"><a href="#cb64-692" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over p values and perform cross-validation</span></span>
<span id="cb64-693"><a href="#cb64-693" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(p_values)) {</span>
<span id="cb64-694"><a href="#cb64-694" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p_values[i]</span>
<span id="cb64-695"><a href="#cb64-695" aria-hidden="true" tabindex="-1"></a>  rmse_cv <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb64-696"><a href="#cb64-696" aria-hidden="true" tabindex="-1"></a>  aic_cv <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb64-697"><a href="#cb64-697" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb64-698"><a href="#cb64-698" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the data into training and testing sets</span></span>
<span id="cb64-699"><a href="#cb64-699" aria-hidden="true" tabindex="-1"></a>    train <span class="ot">&lt;-</span> var_ts[cv_folds <span class="sc">!=</span> j, ]</span>
<span id="cb64-700"><a href="#cb64-700" aria-hidden="true" tabindex="-1"></a>    test <span class="ot">&lt;-</span> var_ts[cv_folds <span class="sc">==</span> j, ]</span>
<span id="cb64-701"><a href="#cb64-701" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-702"><a href="#cb64-702" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the VAR model with the current p value</span></span>
<span id="cb64-703"><a href="#cb64-703" aria-hidden="true" tabindex="-1"></a>    var_fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(train, <span class="at">p =</span> p)</span>
<span id="cb64-704"><a href="#cb64-704" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-705"><a href="#cb64-705" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make predictions for the testing set</span></span>
<span id="cb64-706"><a href="#cb64-706" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(var_fit, <span class="at">n.ahead =</span> <span class="fu">nrow</span>(test))<span class="sc">$</span>fcst</span>
<span id="cb64-707"><a href="#cb64-707" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-708"><a href="#cb64-708" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate RMSE and AIC for the current fold</span></span>
<span id="cb64-709"><a href="#cb64-709" aria-hidden="true" tabindex="-1"></a>    rmse_cv[j] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((pred<span class="sc">$</span>num_attacks <span class="sc">-</span> test[,<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb64-710"><a href="#cb64-710" aria-hidden="true" tabindex="-1"></a>    aic_cv[j] <span class="ot">&lt;-</span> <span class="fu">AIC</span>(var_fit)</span>
<span id="cb64-711"><a href="#cb64-711" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-712"><a href="#cb64-712" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the mean RMSE and AIC across all folds for the current p value</span></span>
<span id="cb64-713"><a href="#cb64-713" aria-hidden="true" tabindex="-1"></a>  rmse_vec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rmse_cv)</span>
<span id="cb64-714"><a href="#cb64-714" aria-hidden="true" tabindex="-1"></a>  aic_vec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(aic_cv)</span>
<span id="cb64-715"><a href="#cb64-715" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-716"><a href="#cb64-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-717"><a href="#cb64-717" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table of RMSE and AIC values for each p value</span></span>
<span id="cb64-718"><a href="#cb64-718" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(p_values, rmse_vec, aic_vec)</span>
<span id="cb64-719"><a href="#cb64-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-720"><a href="#cb64-720" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results table</span></span>
<span id="cb64-721"><a href="#cb64-721" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(results_table, <span class="at">format =</span> <span class="st">"markdown"</span>, </span>
<span id="cb64-722"><a href="#cb64-722" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"P Values"</span>, <span class="st">"Mean RMSE (5 Folds)"</span>, <span class="st">"Mean AIC (5 Folds)"</span>), <span class="at">align =</span> <span class="st">"c"</span>, <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb64-723"><a href="#cb64-723" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb64-724"><a href="#cb64-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-725"><a href="#cb64-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-726"><a href="#cb64-726" aria-hidden="true" tabindex="-1"></a>The <span class="in">`VAR(1)`</span> model outputs the lowest Mean RMSE of <span class="in">`r results_table$rmse_vec[1]`</span> attacks from the 5-fold cross validation. However, it has the highest AIC score. Because predictive performance is best and it is the simplest model, we shall choose the <span class="in">`VAR(1)`</span> model as the best option.</span>
<span id="cb64-727"><a href="#cb64-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-728"><a href="#cb64-728" aria-hidden="true" tabindex="-1"></a><span class="fu">### Forecasting Chosen Model (p=1)</span></span>
<span id="cb64-729"><a href="#cb64-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-730"><a href="#cb64-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r forc, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-731"><a href="#cb64-731" aria-hidden="true" tabindex="-1"></a>final_var <span class="ot">&lt;-</span> <span class="fu">VAR</span>(var_ts, <span class="at">p =</span> <span class="dv">1</span>)</span>
<span id="cb64-732"><a href="#cb64-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-733"><a href="#cb64-733" aria-hidden="true" tabindex="-1"></a>(<span class="at">fit.pr =</span> <span class="fu">predict</span>(final_var, <span class="at">n.ahead =</span> <span class="dv">5</span>, <span class="at">ci =</span> <span class="fl">0.95</span>)) <span class="co"># 5 years ahead </span></span>
<span id="cb64-734"><a href="#cb64-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-735"><a href="#cb64-735" aria-hidden="true" tabindex="-1"></a><span class="fu">fanchart</span>(fit.pr) <span class="co"># plot prediction + error</span></span>
<span id="cb64-736"><a href="#cb64-736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-737"><a href="#cb64-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-738"><a href="#cb64-738" aria-hidden="true" tabindex="-1"></a>The above plot showcases the forecasts for each variable present in the <span class="in">`VAR(1)`</span> model, <span class="in">`Number of Yearly Attacks`</span>, <span class="in">`US Military Expenditure as a % of US GDP`</span>, and Closing Price of <span class="in">`Raytheon Technologies Stock`</span>. The predicted forecast, from the years 2021 to 2025, for <span class="in">`Number of Yearly Attacks`</span> is a good sign for the US due to the decreasing and plateauing trend, although the latest observations from 2015 onwards suggest an increasing trend. The same forecasted trend is discerned for <span class="in">`US Military Expenditure as a % of US GDP`</span>, with <span class="in">`Raytheon Technologies Stock`</span> being the only variable with a predicted increasing trend.</span>
<span id="cb64-739"><a href="#cb64-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-740"><a href="#cb64-740" aria-hidden="true" tabindex="-1"></a>Let us visualize more closely the forecasts for the <span class="in">`Number of Yearly Attacks`</span> from 2021 to 2025, corresponding to the VAR(1) model fitted on 9/11 and post-9/11 years (2001-2020):</span>
<span id="cb64-741"><a href="#cb64-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-742"><a href="#cb64-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r forcattacks, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-743"><a href="#cb64-743" aria-hidden="true" tabindex="-1"></a><span class="co"># create df of attack forecasts</span></span>
<span id="cb64-744"><a href="#cb64-744" aria-hidden="true" tabindex="-1"></a>df_fvar_attack <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fit.pr<span class="sc">$</span>fcst<span class="sc">$</span>num_attacks)</span>
<span id="cb64-745"><a href="#cb64-745" aria-hidden="true" tabindex="-1"></a><span class="co"># add year column</span></span>
<span id="cb64-746"><a href="#cb64-746" aria-hidden="true" tabindex="-1"></a>df_fvar_attack<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>, <span class="st">"2024"</span>, <span class="st">"2025"</span>)</span>
<span id="cb64-747"><a href="#cb64-747" aria-hidden="true" tabindex="-1"></a>(var_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>df_fvar_attack, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>fcst, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb64-748"><a href="#cb64-748" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Forecast"</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-749"><a href="#cb64-749" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span><span class="st">"Confidence Interval"</span>), <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb64-750"><a href="#cb64-750" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"VAR(1) Forecasts for Number of Yearly Attacks from 2021 to 2025"</span>,</span>
<span id="cb64-751"><a href="#cb64-751" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Number of Terrorist Attacks"</span>,</span>
<span id="cb64-752"><a href="#cb64-752" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="st">""</span>, <span class="at">fill=</span><span class="st">""</span>,</span>
<span id="cb64-753"><a href="#cb64-753" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Data Sources: Global Terrorism Database, SIPRI Military Expenditure Database, Yahoo Finance"</span>) <span class="sc">+</span></span>
<span id="cb64-754"><a href="#cb64-754" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span><span class="ot">=</span><span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb64-755"><a href="#cb64-755" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"95% Confidence Interval"</span><span class="ot">=</span><span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb64-756"><a href="#cb64-756" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb64-757"><a href="#cb64-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption.position =</span> <span class="st">"plot"</span>))</span>
<span id="cb64-758"><a href="#cb64-758" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplotly(var_plot)</span></span>
<span id="cb64-759"><a href="#cb64-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-760"><a href="#cb64-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-761"><a href="#cb64-761" aria-hidden="true" tabindex="-1"></a><span class="fu">## Manual ARIMAX Modeling (1970-2020: Pre and Post-9/11 Attacks)</span></span>
<span id="cb64-762"><a href="#cb64-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-763"><a href="#cb64-763" aria-hidden="true" tabindex="-1"></a>The ARIMAX model being analyzed in this section is:</span>
<span id="cb64-764"><a href="#cb64-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-765"><a href="#cb64-765" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span>Number of yearly terrorist attacks in the US \~ Number of yearly B-1 visa entrants + Number of yearly B-2 visa entrants + Number of yearly F-1 visa entrants + Yearly US Military Expenditure as Percentage of US GDP + Raytheon Technologies' Last Yearly Closing Price<span class="kw">&lt;/center&gt;</span></span>
<span id="cb64-766"><a href="#cb64-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-767"><a href="#cb64-767" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb64-768"><a href="#cb64-768" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span></span>
<span id="cb64-769"><a href="#cb64-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-770"><a href="#cb64-770" aria-hidden="true" tabindex="-1"></a>Its output is as follows:</span>
<span id="cb64-771"><a href="#cb64-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-772"><a href="#cb64-772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fitresid, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-773"><a href="#cb64-773" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd <span class="sc">%&gt;%</span> </span>
<span id="cb64-774"><a href="#cb64-774" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(country_txt<span class="sc">==</span><span class="st">"United States"</span>)</span>
<span id="cb64-775"><a href="#cb64-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-776"><a href="#cb64-776" aria-hidden="true" tabindex="-1"></a><span class="co"># drop 33 observations from a total of 3121 observations (if taking for '70)</span></span>
<span id="cb64-777"><a href="#cb64-777" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd_USA_2[<span class="fu">complete.cases</span>(gtd_USA_2<span class="sc">$</span>Date),]</span>
<span id="cb64-778"><a href="#cb64-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-779"><a href="#cb64-779" aria-hidden="true" tabindex="-1"></a><span class="co"># impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0</span></span>
<span id="cb64-780"><a href="#cb64-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-781"><a href="#cb64-781" aria-hidden="true" tabindex="-1"></a>gtd_USA_2<span class="sc">$</span>nkill[<span class="fu">is.na</span>(gtd_USA_2<span class="sc">$</span>nkill)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb64-782"><a href="#cb64-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-783"><a href="#cb64-783" aria-hidden="true" tabindex="-1"></a><span class="co"># select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )</span></span>
<span id="cb64-784"><a href="#cb64-784" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(gtd_USA_2, <span class="at">select=</span><span class="fu">c</span>(Date, nkill))</span>
<span id="cb64-785"><a href="#cb64-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-786"><a href="#cb64-786" aria-hidden="true" tabindex="-1"></a><span class="co"># new dataframe for monthly number of attacks 1970-2020</span></span>
<span id="cb64-787"><a href="#cb64-787" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_USA_2 <span class="sc">%&gt;%</span> </span>
<span id="cb64-788"><a href="#cb64-788" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(<span class="fu">year</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-789"><a href="#cb64-789" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise</span>(<span class="at">nkill=</span><span class="fu">sum</span>(nkill),</span>
<span id="cb64-790"><a href="#cb64-790" aria-hidden="true" tabindex="-1"></a>                            <span class="at">num_attacks =</span> <span class="fu">n</span>())</span>
<span id="cb64-791"><a href="#cb64-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-792"><a href="#cb64-792" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">1</span>] <span class="ot">=</span><span class="st">"Year"</span></span>
<span id="cb64-793"><a href="#cb64-793" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">2</span>] <span class="ot">=</span><span class="st">"num_fatal"</span></span>
<span id="cb64-794"><a href="#cb64-794" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">3</span>] <span class="ot">=</span><span class="st">"num_attacks"</span></span>
<span id="cb64-795"><a href="#cb64-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-796"><a href="#cb64-796" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(gtd_yearly_attacks_deaths<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb64-797"><a href="#cb64-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-798"><a href="#cb64-798" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates (0 attacks for those dates)</span></span>
<span id="cb64-799"><a href="#cb64-799" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_yearly_attacks_deaths <span class="sc">%&gt;%</span> </span>
<span id="cb64-800"><a href="#cb64-800" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb64-801"><a href="#cb64-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-802"><a href="#cb64-802" aria-hidden="true" tabindex="-1"></a><span class="co"># impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD</span></span>
<span id="cb64-803"><a href="#cb64-803" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">28</span></span>
<span id="cb64-804"><a href="#cb64-804" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">21</span></span>
<span id="cb64-805"><a href="#cb64-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-806"><a href="#cb64-806" aria-hidden="true" tabindex="-1"></a><span class="co"># CLEAN DHS df</span></span>
<span id="cb64-807"><a href="#cb64-807" aria-hidden="true" tabindex="-1"></a><span class="do">## convert year to date time</span></span>
<span id="cb64-808"><a href="#cb64-808" aria-hidden="true" tabindex="-1"></a>dhs<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(dhs<span class="sc">$</span>Year, <span class="st">"-12-31"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-809"><a href="#cb64-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-810"><a href="#cb64-810" aria-hidden="true" tabindex="-1"></a><span class="do">## subset</span></span>
<span id="cb64-811"><a href="#cb64-811" aria-hidden="true" tabindex="-1"></a>dhs <span class="ot">&lt;-</span> <span class="fu">subset</span>(dhs, <span class="at">select =</span> <span class="fu">c</span>(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))</span>
<span id="cb64-812"><a href="#cb64-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-813"><a href="#cb64-813" aria-hidden="true" tabindex="-1"></a><span class="co"># join with aggregated GTD df </span></span>
<span id="cb64-814"><a href="#cb64-814" aria-hidden="true" tabindex="-1"></a>gtd_dhs <span class="ot">&lt;-</span> <span class="fu">merge</span>(gtd_yearly_attacks_deaths, dhs, <span class="at">by =</span> <span class="st">"Year"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-815"><a href="#cb64-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-816"><a href="#cb64-816" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)</span></span>
<span id="cb64-817"><a href="#cb64-817" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">4</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">4</span>])</span>
<span id="cb64-818"><a href="#cb64-818" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">5</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">5</span>])</span>
<span id="cb64-819"><a href="#cb64-819" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">6</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">6</span>])</span>
<span id="cb64-820"><a href="#cb64-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-821"><a href="#cb64-821" aria-hidden="true" tabindex="-1"></a><span class="co"># join sipri dataset -&gt; military expenditure as % of GDP</span></span>
<span id="cb64-822"><a href="#cb64-822" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> sipri_gdp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">'United States of America'</span>)</span>
<span id="cb64-823"><a href="#cb64-823" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">melt</span>(milexp.gdp, <span class="at">id.vars =</span> <span class="st">'Country'</span>, <span class="at">variable.name =</span> <span class="st">'Year'</span>, <span class="at">value.name =</span> <span class="st">'GDP'</span>) </span>
<span id="cb64-824"><a href="#cb64-824" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(milexp.gdp[<span class="dv">22</span><span class="sc">:</span><span class="dv">72</span>, <span class="dv">3</span>])</span>
<span id="cb64-825"><a href="#cb64-825" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs, milexp.gdp) </span>
<span id="cb64-826"><a href="#cb64-826" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,2] &lt;- 10 # subtracting 3004 number of casualties (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb64-827"><a href="#cb64-827" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,3] &lt;- 43 # subtracting 4 attacks (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb64-828"><a href="#cb64-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-829"><a href="#cb64-829" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting Raytheon Tech Stock Price (only one active since 70's)</span></span>
<span id="cb64-830"><a href="#cb64-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-831"><a href="#cb64-831" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.warning4.0"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-832"><a href="#cb64-832" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.yahoo.warning"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-833"><a href="#cb64-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-834"><a href="#cb64-834" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"RTX"</span>)</span>
<span id="cb64-835"><a href="#cb64-835" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tickers){</span>
<span id="cb64-836"><a href="#cb64-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(i,</span>
<span id="cb64-837"><a href="#cb64-837" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"1970-01-01"</span>,</span>
<span id="cb64-838"><a href="#cb64-838" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2021-12-31"</span>)}</span>
<span id="cb64-839"><a href="#cb64-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-840"><a href="#cb64-840" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(RTX<span class="sc">$</span>RTX.Adjusted)</span>
<span id="cb64-841"><a href="#cb64-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-842"><a href="#cb64-842" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rtx,<span class="fu">rownames</span>(rtx))</span>
<span id="cb64-843"><a href="#cb64-843" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rtx) <span class="ot">&lt;-</span> <span class="fu">append</span>(tickers,<span class="st">'Dates'</span>)</span>
<span id="cb64-844"><a href="#cb64-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-845"><a href="#cb64-845" aria-hidden="true" tabindex="-1"></a>rtx<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(rtx<span class="sc">$</span>Dates,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-846"><a href="#cb64-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-847"><a href="#cb64-847" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx <span class="sc">%&gt;%</span> </span>
<span id="cb64-848"><a href="#cb64-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">format</span>(date, <span class="st">"%m-%d"</span>) <span class="sc">==</span> <span class="st">"12-31"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-849"><a href="#cb64-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">Year=</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-850"><a href="#cb64-850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">RTX =</span> <span class="fu">last</span>(RTX))</span>
<span id="cb64-851"><a href="#cb64-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-852"><a href="#cb64-852" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(rtx_yearly<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb64-853"><a href="#cb64-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-854"><a href="#cb64-854" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates </span></span>
<span id="cb64-855"><a href="#cb64-855" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx_yearly <span class="sc">%&gt;%</span> </span>
<span id="cb64-856"><a href="#cb64-856" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb64-857"><a href="#cb64-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-858"><a href="#cb64-858" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>RTX <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(rtx_yearly<span class="sc">$</span>RTX)</span>
<span id="cb64-859"><a href="#cb64-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-860"><a href="#cb64-860" aria-hidden="true" tabindex="-1"></a><span class="co"># final join to create final VAR dataset</span></span>
<span id="cb64-861"><a href="#cb64-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-862"><a href="#cb64-862" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs_sipri, rtx_yearly<span class="sc">$</span>RTX) </span>
<span id="cb64-863"><a href="#cb64-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-864"><a href="#cb64-864" aria-hidden="true" tabindex="-1"></a><span class="co"># rename cols</span></span>
<span id="cb64-865"><a href="#cb64-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-866"><a href="#cb64-866" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_dhs_sipri_rtx)[<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Pleasure"</span>, <span class="st">"Business"</span>, <span class="st">"RTX"</span>)</span>
<span id="cb64-867"><a href="#cb64-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-868"><a href="#cb64-868" aria-hidden="true" tabindex="-1"></a><span class="co"># convert df to matrix</span></span>
<span id="cb64-869"><a href="#cb64-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-870"><a href="#cb64-870" aria-hidden="true" tabindex="-1"></a>ts_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(gtd_dhs_sipri_rtx[, <span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb64-871"><a href="#cb64-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-872"><a href="#cb64-872" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the matrix to a time series object with a yearly frequency </span></span>
<span id="cb64-873"><a href="#cb64-873" aria-hidden="true" tabindex="-1"></a>var_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(ts_matrix, <span class="at">frequency =</span> <span class="dv">1</span>,</span>
<span id="cb64-874"><a href="#cb64-874" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="dv">1970</span>)</span>
<span id="cb64-875"><a href="#cb64-875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-876"><a href="#cb64-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-877"><a href="#cb64-877" aria-hidden="true" tabindex="-1"></a><span class="fu">### Regression Summary and Fitting ARIMA to Residuals</span></span>
<span id="cb64-878"><a href="#cb64-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-879"><a href="#cb64-879" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fitregcval, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-880"><a href="#cb64-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-881"><a href="#cb64-881" aria-hidden="true" tabindex="-1"></a>fit.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(num_attacks <span class="sc">~</span> . <span class="sc">-</span> num_fatal, <span class="at">data =</span>var_ts)</span>
<span id="cb64-882"><a href="#cb64-882" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.reg)</span>
<span id="cb64-883"><a href="#cb64-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-884"><a href="#cb64-884" aria-hidden="true" tabindex="-1"></a>res.fit<span class="ot">&lt;-</span><span class="fu">ts</span>(<span class="fu">residuals</span>(fit.reg),<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-01"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb64-885"><a href="#cb64-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-886"><a href="#cb64-886" aria-hidden="true" tabindex="-1"></a><span class="do">############## Then look at the residuals ############</span></span>
<span id="cb64-887"><a href="#cb64-887" aria-hidden="true" tabindex="-1"></a>res.fit <span class="sc">%&gt;%</span> <span class="fu">ggtsdisplay</span>() <span class="co"># no need to difference</span></span>
<span id="cb64-888"><a href="#cb64-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-889"><a href="#cb64-889" aria-hidden="true" tabindex="-1"></a><span class="co">#q=1,3 Q=1 , p=1,2, P=1,2</span></span>
<span id="cb64-890"><a href="#cb64-890" aria-hidden="true" tabindex="-1"></a><span class="co">#write a funtion</span></span>
<span id="cb64-891"><a href="#cb64-891" aria-hidden="true" tabindex="-1"></a>SARIMA.c<span class="ot">=</span><span class="cf">function</span>(p1,p2,q1,q2,P1,P2,Q1,Q2,d1,d2,data){</span>
<span id="cb64-892"><a href="#cb64-892" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-893"><a href="#cb64-893" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb64-894"><a href="#cb64-894" aria-hidden="true" tabindex="-1"></a>  d<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb64-895"><a href="#cb64-895" aria-hidden="true" tabindex="-1"></a>  D<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb64-896"><a href="#cb64-896" aria-hidden="true" tabindex="-1"></a>  s<span class="ot">=</span><span class="dv">12</span></span>
<span id="cb64-897"><a href="#cb64-897" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-898"><a href="#cb64-898" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb64-899"><a href="#cb64-899" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb64-900"><a href="#cb64-900" aria-hidden="true" tabindex="-1"></a>  ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">9</span><span class="sc">*</span><span class="dv">44</span>),<span class="at">nrow=</span><span class="dv">44</span>)</span>
<span id="cb64-901"><a href="#cb64-901" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-902"><a href="#cb64-902" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-903"><a href="#cb64-903" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> p1<span class="sc">:</span>p2)</span>
<span id="cb64-904"><a href="#cb64-904" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb64-905"><a href="#cb64-905" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(q <span class="cf">in</span> q1<span class="sc">:</span>q2)</span>
<span id="cb64-906"><a href="#cb64-906" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb64-907"><a href="#cb64-907" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(P <span class="cf">in</span> P1<span class="sc">:</span>P2)</span>
<span id="cb64-908"><a href="#cb64-908" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb64-909"><a href="#cb64-909" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(Q <span class="cf">in</span> Q1<span class="sc">:</span>Q2)</span>
<span id="cb64-910"><a href="#cb64-910" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb64-911"><a href="#cb64-911" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(d <span class="cf">in</span> d1<span class="sc">:</span>d2)</span>
<span id="cb64-912"><a href="#cb64-912" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb64-913"><a href="#cb64-913" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb64-914"><a href="#cb64-914" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(p<span class="sc">+</span>d<span class="sc">+</span>q<span class="sc">+</span>P<span class="sc">+</span>D<span class="sc">+</span>Q<span class="sc">&lt;=</span><span class="dv">8</span>)</span>
<span id="cb64-915"><a href="#cb64-915" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb64-916"><a href="#cb64-916" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb64-917"><a href="#cb64-917" aria-hidden="true" tabindex="-1"></a>            model<span class="ot">&lt;-</span> <span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>),<span class="at">seasonal=</span><span class="fu">c</span>(P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>))</span>
<span id="cb64-918"><a href="#cb64-918" aria-hidden="true" tabindex="-1"></a>            ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>,P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb64-919"><a href="#cb64-919" aria-hidden="true" tabindex="-1"></a>            i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb64-920"><a href="#cb64-920" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print(i)</span></span>
<span id="cb64-921"><a href="#cb64-921" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb64-922"><a href="#cb64-922" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb64-923"><a href="#cb64-923" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb64-924"><a href="#cb64-924" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb64-925"><a href="#cb64-925" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb64-926"><a href="#cb64-926" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb64-927"><a href="#cb64-927" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-928"><a href="#cb64-928" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-929"><a href="#cb64-929" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-930"><a href="#cb64-930" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-931"><a href="#cb64-931" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb64-932"><a href="#cb64-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(temp)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"P"</span>,<span class="st">"D"</span>,<span class="st">"Q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb64-933"><a href="#cb64-933" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-934"><a href="#cb64-934" aria-hidden="true" tabindex="-1"></a>  temp</span>
<span id="cb64-935"><a href="#cb64-935" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-936"><a href="#cb64-936" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-937"><a href="#cb64-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-938"><a href="#cb64-938" aria-hidden="true" tabindex="-1"></a><span class="do">##q=1,3 Q=0 p=1,2 P=0 d=0</span></span>
<span id="cb64-939"><a href="#cb64-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-940"><a href="#cb64-940" aria-hidden="true" tabindex="-1"></a>output<span class="ot">=</span><span class="fu">SARIMA.c</span>(<span class="at">p1=</span><span class="dv">1</span>,<span class="at">p2=</span><span class="dv">3</span>,<span class="at">q1=</span><span class="dv">1</span>,<span class="at">q2=</span><span class="dv">4</span>,<span class="at">P1=</span><span class="dv">1</span>,<span class="at">P2=</span><span class="dv">3</span>,<span class="at">Q1=</span><span class="dv">1</span>,<span class="at">Q2=</span><span class="dv">2</span>,<span class="at">d1=</span><span class="dv">0</span>,<span class="at">d2=</span><span class="dv">0</span>,<span class="at">data=</span>res.fit)</span>
<span id="cb64-941"><a href="#cb64-941" aria-hidden="true" tabindex="-1"></a>output</span>
<span id="cb64-942"><a href="#cb64-942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-943"><a href="#cb64-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-944"><a href="#cb64-944" aria-hidden="true" tabindex="-1"></a><span class="fu">### ARIMA(2,0,0) or AR(2) Forecasting</span></span>
<span id="cb64-945"><a href="#cb64-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-946"><a href="#cb64-946" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fcast2, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-947"><a href="#cb64-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-948"><a href="#cb64-948" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AIC),] </span>
<span id="cb64-949"><a href="#cb64-949" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>BIC),]</span>
<span id="cb64-950"><a href="#cb64-950" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AICc),]</span>
<span id="cb64-951"><a href="#cb64-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-952"><a href="#cb64-952" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb64-953"><a href="#cb64-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-954"><a href="#cb64-954" aria-hidden="true" tabindex="-1"></a>model_outputar2 <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">sarima</span>(res.fit, <span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb64-955"><a href="#cb64-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-956"><a href="#cb64-956" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(model_outputar2[<span class="dv">30</span><span class="sc">:</span><span class="dv">62</span>], model_outputar2[<span class="fu">length</span>(model_outputar2)], <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb64-957"><a href="#cb64-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-958"><a href="#cb64-958" aria-hidden="true" tabindex="-1"></a>arimaModel_1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(res.fit, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb64-959"><a href="#cb64-959" aria-hidden="true" tabindex="-1"></a>forecast1<span class="ot">=</span><span class="fu">predict</span>(arimaModel_1, <span class="dv">5</span>)</span>
<span id="cb64-960"><a href="#cb64-960" aria-hidden="true" tabindex="-1"></a><span class="co"># create df with fcast preds and +-1.96 SE for 95% CI Bands</span></span>
<span id="cb64-961"><a href="#cb64-961" aria-hidden="true" tabindex="-1"></a>farimax_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb64-962"><a href="#cb64-962" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="dv">2021</span><span class="sc">:</span><span class="dv">2025</span>,</span>
<span id="cb64-963"><a href="#cb64-963" aria-hidden="true" tabindex="-1"></a>  <span class="at">fcst =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred),</span>
<span id="cb64-964"><a href="#cb64-964" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> forecast1<span class="sc">$</span>se),</span>
<span id="cb64-965"><a href="#cb64-965" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> forecast1<span class="sc">$</span>se)</span>
<span id="cb64-966"><a href="#cb64-966" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-967"><a href="#cb64-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-968"><a href="#cb64-968" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(forecast1$pred, main = "ARIMA(2,0,0) Forecast For 5 Years", xlab = "Time", ylab = "Values", col = "red")</span></span>
<span id="cb64-969"><a href="#cb64-969" aria-hidden="true" tabindex="-1"></a>(arimax_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>farimax_df, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>fcst, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb64-970"><a href="#cb64-970" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Forecast"</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-971"><a href="#cb64-971" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span><span class="st">"Confidence Interval"</span>), <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb64-972"><a href="#cb64-972" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"ARIMA(2,0,0) Forecasts for Number of Yearly Attacks from 2021 to 2025"</span>,</span>
<span id="cb64-973"><a href="#cb64-973" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Number of Terrorist Attacks"</span>,</span>
<span id="cb64-974"><a href="#cb64-974" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="st">""</span>, <span class="at">fill=</span><span class="st">""</span>,</span>
<span id="cb64-975"><a href="#cb64-975" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Data Sources: Global Terrorism Database, Department of Homeland Security, SIPRI Military Expenditure Database, Yahoo Finance"</span>) <span class="sc">+</span></span>
<span id="cb64-976"><a href="#cb64-976" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span><span class="ot">=</span><span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb64-977"><a href="#cb64-977" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"95% Confidence Interval"</span><span class="ot">=</span><span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb64-978"><a href="#cb64-978" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb64-979"><a href="#cb64-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption.position =</span> <span class="st">"plot"</span>, <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>)))</span>
<span id="cb64-980"><a href="#cb64-980" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-981"><a href="#cb64-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-982"><a href="#cb64-982" aria-hidden="true" tabindex="-1"></a><span class="fu">## Manual ARIMAX Modeling (2001-2020: Post-9/11 Attacks)</span></span>
<span id="cb64-983"><a href="#cb64-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-984"><a href="#cb64-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-985"><a href="#cb64-985" aria-hidden="true" tabindex="-1"></a>The ARIMAX model being analyzed in this section is:</span>
<span id="cb64-986"><a href="#cb64-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-987"><a href="#cb64-987" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span>Number of yearly terrorist attacks in the US \~ Number of yearly B-1 visa entrants + Number of yearly B-2 visa entrants + Number of yearly F-1 visa entrants + Yearly US Military Expenditure as Percentage of US GDP + Raytheon Technologies' Last Yearly Closing Price + Lockheed Martin's Last Yearly Closing Price<span class="kw">&lt;/center&gt;</span></span>
<span id="cb64-988"><a href="#cb64-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-989"><a href="#cb64-989" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb64-990"><a href="#cb64-990" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span></span>
<span id="cb64-991"><a href="#cb64-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-992"><a href="#cb64-992" aria-hidden="true" tabindex="-1"></a>Its output is as follows:</span>
<span id="cb64-993"><a href="#cb64-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-994"><a href="#cb64-994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fitresid2, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-995"><a href="#cb64-995" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd <span class="sc">%&gt;%</span> </span>
<span id="cb64-996"><a href="#cb64-996" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(country_txt<span class="sc">==</span><span class="st">"United States"</span>)</span>
<span id="cb64-997"><a href="#cb64-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-998"><a href="#cb64-998" aria-hidden="true" tabindex="-1"></a><span class="co"># drop 33 observations from a total of 3121 observations (if taking for '70)</span></span>
<span id="cb64-999"><a href="#cb64-999" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> gtd_USA_2[<span class="fu">complete.cases</span>(gtd_USA_2<span class="sc">$</span>Date),]</span>
<span id="cb64-1000"><a href="#cb64-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1001"><a href="#cb64-1001" aria-hidden="true" tabindex="-1"></a><span class="co"># impute missing values for nkill (Total Number of Fatalities: victims and attackers) as 0</span></span>
<span id="cb64-1002"><a href="#cb64-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1003"><a href="#cb64-1003" aria-hidden="true" tabindex="-1"></a>gtd_USA_2<span class="sc">$</span>nkill[<span class="fu">is.na</span>(gtd_USA_2<span class="sc">$</span>nkill)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb64-1004"><a href="#cb64-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1005"><a href="#cb64-1005" aria-hidden="true" tabindex="-1"></a><span class="co"># select desired columns for analysis (num_casualties ~ num_attacks, state, attack_type, weapon_type, victim_type, )</span></span>
<span id="cb64-1006"><a href="#cb64-1006" aria-hidden="true" tabindex="-1"></a>gtd_USA_2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(gtd_USA_2, <span class="at">select=</span><span class="fu">c</span>(Date, nkill))</span>
<span id="cb64-1007"><a href="#cb64-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1008"><a href="#cb64-1008" aria-hidden="true" tabindex="-1"></a><span class="co"># new dataframe for monthly number of attacks 1970-2020</span></span>
<span id="cb64-1009"><a href="#cb64-1009" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_USA_2 <span class="sc">%&gt;%</span> </span>
<span id="cb64-1010"><a href="#cb64-1010" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(<span class="fu">year</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-1011"><a href="#cb64-1011" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise</span>(<span class="at">nkill=</span><span class="fu">sum</span>(nkill),</span>
<span id="cb64-1012"><a href="#cb64-1012" aria-hidden="true" tabindex="-1"></a>                            <span class="at">num_attacks =</span> <span class="fu">n</span>())</span>
<span id="cb64-1013"><a href="#cb64-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1014"><a href="#cb64-1014" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">1</span>] <span class="ot">=</span><span class="st">"Year"</span></span>
<span id="cb64-1015"><a href="#cb64-1015" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">2</span>] <span class="ot">=</span><span class="st">"num_fatal"</span></span>
<span id="cb64-1016"><a href="#cb64-1016" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_yearly_attacks_deaths)[<span class="dv">3</span>] <span class="ot">=</span><span class="st">"num_attacks"</span></span>
<span id="cb64-1017"><a href="#cb64-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1018"><a href="#cb64-1018" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(gtd_yearly_attacks_deaths<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb64-1019"><a href="#cb64-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1020"><a href="#cb64-1020" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates (0 attacks for those dates)</span></span>
<span id="cb64-1021"><a href="#cb64-1021" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths <span class="ot">&lt;-</span> gtd_yearly_attacks_deaths <span class="sc">%&gt;%</span> </span>
<span id="cb64-1022"><a href="#cb64-1022" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb64-1023"><a href="#cb64-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1024"><a href="#cb64-1024" aria-hidden="true" tabindex="-1"></a><span class="co"># impute 28 ATTACKS in 1993 and 21 casualties in 1993 as per GTD</span></span>
<span id="cb64-1025"><a href="#cb64-1025" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">28</span></span>
<span id="cb64-1026"><a href="#cb64-1026" aria-hidden="true" tabindex="-1"></a>gtd_yearly_attacks_deaths[<span class="dv">24</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">21</span></span>
<span id="cb64-1027"><a href="#cb64-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1028"><a href="#cb64-1028" aria-hidden="true" tabindex="-1"></a><span class="co"># CLEAN DHS df</span></span>
<span id="cb64-1029"><a href="#cb64-1029" aria-hidden="true" tabindex="-1"></a><span class="do">## convert year to date time</span></span>
<span id="cb64-1030"><a href="#cb64-1030" aria-hidden="true" tabindex="-1"></a>dhs<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(dhs<span class="sc">$</span>Year, <span class="st">"-12-31"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-1031"><a href="#cb64-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1032"><a href="#cb64-1032" aria-hidden="true" tabindex="-1"></a><span class="do">## subset</span></span>
<span id="cb64-1033"><a href="#cb64-1033" aria-hidden="true" tabindex="-1"></a>dhs <span class="ot">&lt;-</span> <span class="fu">subset</span>(dhs, <span class="at">select =</span> <span class="fu">c</span>(Year, Temporaryvisitorsforpleasure, Temporaryvisitorsforbusiness, Students))</span>
<span id="cb64-1034"><a href="#cb64-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1035"><a href="#cb64-1035" aria-hidden="true" tabindex="-1"></a><span class="co"># join with aggregated GTD df </span></span>
<span id="cb64-1036"><a href="#cb64-1036" aria-hidden="true" tabindex="-1"></a>gtd_dhs <span class="ot">&lt;-</span> <span class="fu">merge</span>(gtd_yearly_attacks_deaths, dhs, <span class="at">by =</span> <span class="st">"Year"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-1037"><a href="#cb64-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1038"><a href="#cb64-1038" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolate NAs in DHS columns (1970 to 1980, 1982 to 84, 86 to 88)</span></span>
<span id="cb64-1039"><a href="#cb64-1039" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">4</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">4</span>])</span>
<span id="cb64-1040"><a href="#cb64-1040" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">5</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">5</span>])</span>
<span id="cb64-1041"><a href="#cb64-1041" aria-hidden="true" tabindex="-1"></a>gtd_dhs[,<span class="dv">6</span>] <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(gtd_dhs[,<span class="dv">6</span>])</span>
<span id="cb64-1042"><a href="#cb64-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1043"><a href="#cb64-1043" aria-hidden="true" tabindex="-1"></a><span class="co"># join sipri dataset -&gt; military expenditure as % of GDP</span></span>
<span id="cb64-1044"><a href="#cb64-1044" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> sipri_gdp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">'United States of America'</span>)</span>
<span id="cb64-1045"><a href="#cb64-1045" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">melt</span>(milexp.gdp, <span class="at">id.vars =</span> <span class="st">'Country'</span>, <span class="at">variable.name =</span> <span class="st">'Year'</span>, <span class="at">value.name =</span> <span class="st">'GDP'</span>) </span>
<span id="cb64-1046"><a href="#cb64-1046" aria-hidden="true" tabindex="-1"></a>milexp.gdp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(milexp.gdp[<span class="dv">22</span><span class="sc">:</span><span class="dv">72</span>, <span class="dv">3</span>])</span>
<span id="cb64-1047"><a href="#cb64-1047" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs, milexp.gdp) </span>
<span id="cb64-1048"><a href="#cb64-1048" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,2] &lt;- 10 # subtracting 3004 number of casualties (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb64-1049"><a href="#cb64-1049" aria-hidden="true" tabindex="-1"></a><span class="co">#gtd_dhs_sipri[32,3] &lt;- 43 # subtracting 4 attacks (9/11 attacks -&gt; outlier event)</span></span>
<span id="cb64-1050"><a href="#cb64-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1051"><a href="#cb64-1051" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting Raytheon Tech Stock Price (only one active since 70's)</span></span>
<span id="cb64-1052"><a href="#cb64-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1053"><a href="#cb64-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.warning4.0"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-1054"><a href="#cb64-1054" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.yahoo.warning"</span><span class="ot">=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-1055"><a href="#cb64-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1056"><a href="#cb64-1056" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"RTX"</span>)</span>
<span id="cb64-1057"><a href="#cb64-1057" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tickers){</span>
<span id="cb64-1058"><a href="#cb64-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(i,</span>
<span id="cb64-1059"><a href="#cb64-1059" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"1970-01-01"</span>,</span>
<span id="cb64-1060"><a href="#cb64-1060" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2021-12-31"</span>)}</span>
<span id="cb64-1061"><a href="#cb64-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1062"><a href="#cb64-1062" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(RTX<span class="sc">$</span>RTX.Adjusted)</span>
<span id="cb64-1063"><a href="#cb64-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1064"><a href="#cb64-1064" aria-hidden="true" tabindex="-1"></a>rtx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rtx,<span class="fu">rownames</span>(rtx))</span>
<span id="cb64-1065"><a href="#cb64-1065" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rtx) <span class="ot">&lt;-</span> <span class="fu">append</span>(tickers,<span class="st">'Dates'</span>)</span>
<span id="cb64-1066"><a href="#cb64-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1067"><a href="#cb64-1067" aria-hidden="true" tabindex="-1"></a>rtx<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(rtx<span class="sc">$</span>Dates,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-1068"><a href="#cb64-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1069"><a href="#cb64-1069" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx <span class="sc">%&gt;%</span> </span>
<span id="cb64-1070"><a href="#cb64-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">format</span>(date, <span class="st">"%m-%d"</span>) <span class="sc">==</span> <span class="st">"12-31"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-1071"><a href="#cb64-1071" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">Year=</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-1072"><a href="#cb64-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">RTX =</span> <span class="fu">last</span>(RTX))</span>
<span id="cb64-1073"><a href="#cb64-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1074"><a href="#cb64-1074" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(rtx_yearly<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb64-1075"><a href="#cb64-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1076"><a href="#cb64-1076" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates </span></span>
<span id="cb64-1077"><a href="#cb64-1077" aria-hidden="true" tabindex="-1"></a>rtx_yearly <span class="ot">&lt;-</span> rtx_yearly <span class="sc">%&gt;%</span> </span>
<span id="cb64-1078"><a href="#cb64-1078" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb64-1079"><a href="#cb64-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1080"><a href="#cb64-1080" aria-hidden="true" tabindex="-1"></a>rtx_yearly<span class="sc">$</span>RTX <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(rtx_yearly<span class="sc">$</span>RTX)</span>
<span id="cb64-1081"><a href="#cb64-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1082"><a href="#cb64-1082" aria-hidden="true" tabindex="-1"></a><span class="co"># join </span></span>
<span id="cb64-1083"><a href="#cb64-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1084"><a href="#cb64-1084" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs_sipri, rtx_yearly<span class="sc">$</span>RTX) </span>
<span id="cb64-1085"><a href="#cb64-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1086"><a href="#cb64-1086" aria-hidden="true" tabindex="-1"></a><span class="co"># LMT </span></span>
<span id="cb64-1087"><a href="#cb64-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1088"><a href="#cb64-1088" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"LMT"</span>)</span>
<span id="cb64-1089"><a href="#cb64-1089" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tickers){</span>
<span id="cb64-1090"><a href="#cb64-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(i,</span>
<span id="cb64-1091"><a href="#cb64-1091" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"2001-09-11"</span>,</span>
<span id="cb64-1092"><a href="#cb64-1092" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2021-12-31"</span>)}</span>
<span id="cb64-1093"><a href="#cb64-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1094"><a href="#cb64-1094" aria-hidden="true" tabindex="-1"></a>lmt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(LMT<span class="sc">$</span>LMT.Adjusted)</span>
<span id="cb64-1095"><a href="#cb64-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1096"><a href="#cb64-1096" aria-hidden="true" tabindex="-1"></a>lmt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(lmt,<span class="fu">rownames</span>(lmt))</span>
<span id="cb64-1097"><a href="#cb64-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lmt) <span class="ot">&lt;-</span> <span class="fu">append</span>(tickers,<span class="st">'Dates'</span>)</span>
<span id="cb64-1098"><a href="#cb64-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1099"><a href="#cb64-1099" aria-hidden="true" tabindex="-1"></a>lmt<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(lmt<span class="sc">$</span>Dates,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb64-1100"><a href="#cb64-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1101"><a href="#cb64-1101" aria-hidden="true" tabindex="-1"></a>lmt_yearly <span class="ot">&lt;-</span> lmt <span class="sc">%&gt;%</span> </span>
<span id="cb64-1102"><a href="#cb64-1102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">format</span>(date, <span class="st">"%m-%d"</span>) <span class="sc">==</span> <span class="st">"12-31"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-1103"><a href="#cb64-1103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">Year=</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-1104"><a href="#cb64-1104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">LMT =</span> <span class="fu">last</span>(LMT))</span>
<span id="cb64-1105"><a href="#cb64-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1106"><a href="#cb64-1106" aria-hidden="true" tabindex="-1"></a>lmt_yearly<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(lmt_yearly<span class="sc">$</span>Year, <span class="st">"-12-31"</span>))</span>
<span id="cb64-1107"><a href="#cb64-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1108"><a href="#cb64-1108" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing dates </span></span>
<span id="cb64-1109"><a href="#cb64-1109" aria-hidden="true" tabindex="-1"></a>lmt_yearly <span class="ot">&lt;-</span> lmt_yearly <span class="sc">%&gt;%</span> </span>
<span id="cb64-1110"><a href="#cb64-1110" aria-hidden="true" tabindex="-1"></a>              <span class="fu">complete</span>(<span class="at">Year =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Year), <span class="fu">max</span>(Year), <span class="at">by=</span><span class="st">"year"</span>)) </span>
<span id="cb64-1111"><a href="#cb64-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1112"><a href="#cb64-1112" aria-hidden="true" tabindex="-1"></a>lmt_yearly<span class="sc">$</span>LMT <span class="ot">&lt;-</span> imputeTS<span class="sc">::</span><span class="fu">na.interpolation</span>(lmt_yearly<span class="sc">$</span>LMT)</span>
<span id="cb64-1113"><a href="#cb64-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1114"><a href="#cb64-1114" aria-hidden="true" tabindex="-1"></a><span class="co"># filter gtd_hds_sipri_rtx</span></span>
<span id="cb64-1115"><a href="#cb64-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1116"><a href="#cb64-1116" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx <span class="ot">&lt;-</span> gtd_dhs_sipri_rtx <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">32</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb64-1117"><a href="#cb64-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1118"><a href="#cb64-1118" aria-hidden="true" tabindex="-1"></a><span class="co"># final join to create final arimax dataset</span></span>
<span id="cb64-1119"><a href="#cb64-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1120"><a href="#cb64-1120" aria-hidden="true" tabindex="-1"></a>gtd_dhs_sipri_rtx_lmt <span class="ot">&lt;-</span> <span class="fu">cbind</span>(gtd_dhs_sipri_rtx, lmt_yearly<span class="sc">$</span>LMT) </span>
<span id="cb64-1121"><a href="#cb64-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1122"><a href="#cb64-1122" aria-hidden="true" tabindex="-1"></a><span class="co"># rename cols</span></span>
<span id="cb64-1123"><a href="#cb64-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1124"><a href="#cb64-1124" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gtd_dhs_sipri_rtx_lmt)[<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">9</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Pleasure"</span>, <span class="st">"Business"</span>, <span class="st">"RTX"</span>, <span class="st">"LMT"</span>)</span>
<span id="cb64-1125"><a href="#cb64-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1126"><a href="#cb64-1126" aria-hidden="true" tabindex="-1"></a><span class="co"># convert df to matrix</span></span>
<span id="cb64-1127"><a href="#cb64-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1128"><a href="#cb64-1128" aria-hidden="true" tabindex="-1"></a>ts_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(gtd_dhs_sipri_rtx_lmt[, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>])</span>
<span id="cb64-1129"><a href="#cb64-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1130"><a href="#cb64-1130" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the matrix to a time series object with a yearly frequency </span></span>
<span id="cb64-1131"><a href="#cb64-1131" aria-hidden="true" tabindex="-1"></a>var_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(ts_matrix, <span class="at">frequency =</span> <span class="dv">1</span>,</span>
<span id="cb64-1132"><a href="#cb64-1132" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="dv">2001</span>)</span>
<span id="cb64-1133"><a href="#cb64-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1134"><a href="#cb64-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1135"><a href="#cb64-1135" aria-hidden="true" tabindex="-1"></a><span class="fu">### Regression Summary and Fitting ARIMA to Residuals</span></span>
<span id="cb64-1136"><a href="#cb64-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1137"><a href="#cb64-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r regres, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-1138"><a href="#cb64-1138" aria-hidden="true" tabindex="-1"></a>fit.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(num_attacks <span class="sc">~</span> . <span class="sc">-</span> num_fatal, <span class="at">data =</span> var_ts)</span>
<span id="cb64-1139"><a href="#cb64-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1140"><a href="#cb64-1140" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.reg)</span>
<span id="cb64-1141"><a href="#cb64-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1142"><a href="#cb64-1142" aria-hidden="true" tabindex="-1"></a>res.fit<span class="ot">&lt;-</span><span class="fu">ts</span>(<span class="fu">residuals</span>(fit.reg),<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-01"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb64-1143"><a href="#cb64-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1144"><a href="#cb64-1144" aria-hidden="true" tabindex="-1"></a><span class="do">############## Then look at the residuals ############</span></span>
<span id="cb64-1145"><a href="#cb64-1145" aria-hidden="true" tabindex="-1"></a>res.fit <span class="sc">%&gt;%</span> <span class="fu">ggtsdisplay</span>() <span class="co"># no need to difference</span></span>
<span id="cb64-1146"><a href="#cb64-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1147"><a href="#cb64-1147" aria-hidden="true" tabindex="-1"></a><span class="co">#q=1,3 Q=1 , p=1,2, P=1,2</span></span>
<span id="cb64-1148"><a href="#cb64-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#write a funtion</span></span>
<span id="cb64-1149"><a href="#cb64-1149" aria-hidden="true" tabindex="-1"></a>SARIMA.c<span class="ot">=</span><span class="cf">function</span>(p1,p2,q1,q2,P1,P2,Q1,Q2,d1,d2,data){</span>
<span id="cb64-1150"><a href="#cb64-1150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-1151"><a href="#cb64-1151" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb64-1152"><a href="#cb64-1152" aria-hidden="true" tabindex="-1"></a>  d<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb64-1153"><a href="#cb64-1153" aria-hidden="true" tabindex="-1"></a>  D<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb64-1154"><a href="#cb64-1154" aria-hidden="true" tabindex="-1"></a>  s<span class="ot">=</span><span class="dv">12</span></span>
<span id="cb64-1155"><a href="#cb64-1155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-1156"><a href="#cb64-1156" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb64-1157"><a href="#cb64-1157" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb64-1158"><a href="#cb64-1158" aria-hidden="true" tabindex="-1"></a>  ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">9</span><span class="sc">*</span><span class="dv">44</span>),<span class="at">nrow=</span><span class="dv">44</span>)</span>
<span id="cb64-1159"><a href="#cb64-1159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-1160"><a href="#cb64-1160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-1161"><a href="#cb64-1161" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> p1<span class="sc">:</span>p2)</span>
<span id="cb64-1162"><a href="#cb64-1162" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb64-1163"><a href="#cb64-1163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(q <span class="cf">in</span> q1<span class="sc">:</span>q2)</span>
<span id="cb64-1164"><a href="#cb64-1164" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb64-1165"><a href="#cb64-1165" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(P <span class="cf">in</span> P1<span class="sc">:</span>P2)</span>
<span id="cb64-1166"><a href="#cb64-1166" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb64-1167"><a href="#cb64-1167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(Q <span class="cf">in</span> Q1<span class="sc">:</span>Q2)</span>
<span id="cb64-1168"><a href="#cb64-1168" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb64-1169"><a href="#cb64-1169" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(d <span class="cf">in</span> d1<span class="sc">:</span>d2)</span>
<span id="cb64-1170"><a href="#cb64-1170" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb64-1171"><a href="#cb64-1171" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb64-1172"><a href="#cb64-1172" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(p<span class="sc">+</span>d<span class="sc">+</span>q<span class="sc">+</span>P<span class="sc">+</span>D<span class="sc">+</span>Q<span class="sc">&lt;=</span><span class="dv">8</span>)</span>
<span id="cb64-1173"><a href="#cb64-1173" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb64-1174"><a href="#cb64-1174" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb64-1175"><a href="#cb64-1175" aria-hidden="true" tabindex="-1"></a>            model<span class="ot">&lt;-</span> <span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>),<span class="at">seasonal=</span><span class="fu">c</span>(P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>))</span>
<span id="cb64-1176"><a href="#cb64-1176" aria-hidden="true" tabindex="-1"></a>            ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>,P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb64-1177"><a href="#cb64-1177" aria-hidden="true" tabindex="-1"></a>            i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb64-1178"><a href="#cb64-1178" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print(i)</span></span>
<span id="cb64-1179"><a href="#cb64-1179" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb64-1180"><a href="#cb64-1180" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb64-1181"><a href="#cb64-1181" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb64-1182"><a href="#cb64-1182" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb64-1183"><a href="#cb64-1183" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb64-1184"><a href="#cb64-1184" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb64-1185"><a href="#cb64-1185" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-1186"><a href="#cb64-1186" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-1187"><a href="#cb64-1187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-1188"><a href="#cb64-1188" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-1189"><a href="#cb64-1189" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb64-1190"><a href="#cb64-1190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(temp)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"P"</span>,<span class="st">"D"</span>,<span class="st">"Q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb64-1191"><a href="#cb64-1191" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-1192"><a href="#cb64-1192" aria-hidden="true" tabindex="-1"></a>  temp</span>
<span id="cb64-1193"><a href="#cb64-1193" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-1194"><a href="#cb64-1194" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-1195"><a href="#cb64-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1196"><a href="#cb64-1196" aria-hidden="true" tabindex="-1"></a><span class="do">##q=1,2 Q=0 , p=1,2 P=0 d=0</span></span>
<span id="cb64-1197"><a href="#cb64-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1198"><a href="#cb64-1198" aria-hidden="true" tabindex="-1"></a>output<span class="ot">=</span><span class="fu">SARIMA.c</span>(<span class="at">p1=</span><span class="dv">1</span>,<span class="at">p2=</span><span class="dv">3</span>,<span class="at">q1=</span><span class="dv">1</span>,<span class="at">q2=</span><span class="dv">4</span>,<span class="at">P1=</span><span class="dv">1</span>,<span class="at">P2=</span><span class="dv">3</span>,<span class="at">Q1=</span><span class="dv">1</span>,<span class="at">Q2=</span><span class="dv">2</span>,<span class="at">d1=</span><span class="dv">0</span>,<span class="at">d2=</span><span class="dv">0</span>,<span class="at">data=</span>res.fit)</span>
<span id="cb64-1199"><a href="#cb64-1199" aria-hidden="true" tabindex="-1"></a>output</span>
<span id="cb64-1200"><a href="#cb64-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1201"><a href="#cb64-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1202"><a href="#cb64-1202" aria-hidden="true" tabindex="-1"></a><span class="fu">### ARIMA(0,0,1) or MA(1) Forecasting</span></span>
<span id="cb64-1203"><a href="#cb64-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1204"><a href="#cb64-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fcast, message=FALSE, warning=FALSE}</span></span>
<span id="cb64-1205"><a href="#cb64-1205" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AIC),] </span>
<span id="cb64-1206"><a href="#cb64-1206" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>BIC),]</span>
<span id="cb64-1207"><a href="#cb64-1207" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AICc),]</span>
<span id="cb64-1208"><a href="#cb64-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1209"><a href="#cb64-1209" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb64-1210"><a href="#cb64-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1211"><a href="#cb64-1211" aria-hidden="true" tabindex="-1"></a>model_outputma2 <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">sarima</span>(res.fit, <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb64-1212"><a href="#cb64-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1213"><a href="#cb64-1213" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(model_outputma2[<span class="dv">115</span><span class="sc">:</span><span class="dv">143</span>], model_outputma2[<span class="fu">length</span>(model_outputar2)], <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb64-1214"><a href="#cb64-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1215"><a href="#cb64-1215" aria-hidden="true" tabindex="-1"></a>arimaModel_1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(res.fit, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb64-1216"><a href="#cb64-1216" aria-hidden="true" tabindex="-1"></a>forecast1<span class="ot">=</span><span class="fu">predict</span>(arimaModel_1, <span class="dv">5</span>)</span>
<span id="cb64-1217"><a href="#cb64-1217" aria-hidden="true" tabindex="-1"></a><span class="co"># create df with fcast preds and +-1.96 SE for 95% CI Bands</span></span>
<span id="cb64-1218"><a href="#cb64-1218" aria-hidden="true" tabindex="-1"></a>farimax_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb64-1219"><a href="#cb64-1219" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="dv">2021</span><span class="sc">:</span><span class="dv">2025</span>,</span>
<span id="cb64-1220"><a href="#cb64-1220" aria-hidden="true" tabindex="-1"></a>  <span class="at">fcst =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred),</span>
<span id="cb64-1221"><a href="#cb64-1221" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> forecast1<span class="sc">$</span>se),</span>
<span id="cb64-1222"><a href="#cb64-1222" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">as.numeric</span>(forecast1<span class="sc">$</span>pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> forecast1<span class="sc">$</span>se)</span>
<span id="cb64-1223"><a href="#cb64-1223" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-1224"><a href="#cb64-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1225"><a href="#cb64-1225" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(forecast1$pred, main = "ARIMA(2,0,0) Forecast For 5 Years", xlab = "Time", ylab = "Values", col = "red")</span></span>
<span id="cb64-1226"><a href="#cb64-1226" aria-hidden="true" tabindex="-1"></a>(arimax_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>farimax_df, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>fcst, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb64-1227"><a href="#cb64-1227" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">"Forecast"</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-1228"><a href="#cb64-1228" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span><span class="st">"Confidence Interval"</span>), <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb64-1229"><a href="#cb64-1229" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"ARIMA(0,0,1) Forecasts for Number of Yearly Attacks from 2021 to 2025"</span>,</span>
<span id="cb64-1230"><a href="#cb64-1230" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Number of Terrorist Attacks"</span>,</span>
<span id="cb64-1231"><a href="#cb64-1231" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="st">""</span>, <span class="at">fill=</span><span class="st">""</span>,</span>
<span id="cb64-1232"><a href="#cb64-1232" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Data Sources: Global Terrorism Database, Department of Homeland Security, SIPRI Military Expenditure Database, Yahoo Finance"</span>) <span class="sc">+</span></span>
<span id="cb64-1233"><a href="#cb64-1233" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span><span class="ot">=</span><span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb64-1234"><a href="#cb64-1234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"95% Confidence Interval"</span><span class="ot">=</span><span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb64-1235"><a href="#cb64-1235" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb64-1236"><a href="#cb64-1236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption.position =</span> <span class="st">"plot"</span>, <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>)))</span>
<span id="cb64-1237"><a href="#cb64-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1238"><a href="#cb64-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1239"><a href="#cb64-1239" aria-hidden="true" tabindex="-1"></a><span class="fu">## Final Results</span></span>
<span id="cb64-1240"><a href="#cb64-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1241"><a href="#cb64-1241" aria-hidden="true" tabindex="-1"></a>The VAR(1) Model trained on Post-9/11 Attacks data is the best performing model in terms of the predicted forecast. It is the only model that took into account the latter observations in its prediction and predicted based on that increasing trend. Our hypothesis that non-immigrants do not significantly affect the number of yearly terrorist attacks in the US is, therefore, proven through the above analyses. </span>
<span id="cb64-1242"><a href="#cb64-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1243"><a href="#cb64-1243" aria-hidden="true" tabindex="-1"></a>The ARIMAX model trained on all the years performed significantly worse than the ARIMAX model trained on only Post-9/11 Attacks years. In fact, when adding in Lockheed Martin's stock price in segment 2 of the analysis (Post-9/11 Attacks), $Adjusted.R^2$ increases by more than 60% from segment 1 of the analysis, which includes all years (1970-2020) and not Lockheed Martin's stock price! Although that is the case, none of the predicted forecasts from the ARIMAX models are not as convincing as the VAR models. Moreover, in the ARIMAX models, all the non-immigration variables collected from DHS are non-significant, apart from Pleasure or B-2 Visa entrants in segment 1 (all years included) of the analysis.</span>
<span id="cb64-1244"><a href="#cb64-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1245"><a href="#cb64-1245" aria-hidden="true" tabindex="-1"></a>In summary, the years prior to the 9/11 Attacks have little to no effect on the forecasts for 2021 to 2025. To gain more accurate forecasts from the VAR model, it is imperative to focus on data post-9/11. The variables that do imply high correlation (determining causation is out of scope of this analysis) to forecasting the yearly number of terrorist attacks in the US are US Military Expenditure both directly on armed forces and weapons contractors, Lockheed Martin and Raytheon Technologies.  </span>
<span id="cb64-1246"><a href="#cb64-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1247"><a href="#cb64-1247" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section Code</span></span>
<span id="cb64-1248"><a href="#cb64-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1249"><a href="#cb64-1249" aria-hidden="true" tabindex="-1"></a>**Code for this section can be found [here](https://github.com/TegveerG/Time-Series-Project/blob/main/Time%20Series%20Analysis/ARIMAX-SARIMAX-VAR.qmd)**</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>